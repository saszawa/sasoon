function drawStar(e,t,a,o,n,r){var l=Math.PI,i=l/a,c=0;a*=2,l/=2,r.moveTo(e,-o+t);for(var s=1;a>s;s++)c=s*i-l,r.lineTo(n*Math.cos(c)+e,n*Math.sin(c)+t),c=++s*i-l,r.lineTo(o*Math.cos(c)+e,o*Math.sin(c)+t)}function browserLanguage(){try{return(navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2)}catch(e){return void 0}}function StageBuilder(e){switch(e.name){case"block":return new Block(e.color);case"start":return new Start;case"goal":return new Goal;case"star":return new Star;case"count":return new CountBlock(e.color,e.count);case"diffusioner":return new Diffusioner;case"slanter":return new Slanter;case"pipe":return new Pipe(e.color,e.pipeStatus);case"linker":return new Linker(e.color);case"tutoGoal":return new TutoGoal;case"tutoBlock":return new TutoBlock(e.color)}}function initTutorialScene(){tutorialScene=createTutorialScene()}function createPointerArrow1(){var e=new Sprite;return e.x=65,e.y=290,e._element=document.createElement("div"),e._element.className="pointerArrow",e.width=30,e.rotate(300),e}function createBacktoTopLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].backToTop,3*BOX_SIZE,BOX_SIZE);return e.setClassName("backToTopText"),e.x=32,e.y=544,e}function createStartTutorialLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].startTutorial);return e.setClassName("tuto_white_msg"),e.x=90,e.y=170,e}function createSirotamaLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].sirotama);return e.setClassName("tuto_white_msg"),e.x=90,e.y=170,e}function createLoseMsg(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].loseMsg);return e.x=200,e.y=200,e.setClassName("tuto_black_msg"),e}function createTitleLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].title);return e.setClassName("titleText"),e.y=140,e}function createTouchStartLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].touchStart,640,60);return e.setClassName("touchStart"),e.x=0,e.y=400,e}function createGameStartLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].gameStart,320,60);return e.setClassName("gameStart"),e.x=160,e.y=360,e}function createTutorialLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].howToPlay,320,60);return e.setClassName("tutorial"),e.x=160,e.y=440,e}function createOptionMenuButton(){var e=new Sprite(BOX_SIZE,BOX_SIZE);return e._element=document.createElement("div"),e._element.className="optionMenuButton",e.x=8.5*BOX_SIZE,e.y=8.5*BOX_SIZE,e.menuOpen=!1,e}function createOptionMenu(){function e(e){for(var t=0;3>t;t++)c[t].quality===e?c[t].setClassName("effectSwitch optionLayer active"):c[t].setClassName("effectSwitch optionLayer")}var t=new Group;t._element=document.createElement("div"),t._element.className="optionMenu";var a=new Sprite(640,640);a._element=document.createElement("div"),a._element.className="optionBackground optionLayer",t.addChild(a);var o=new ExLabel("Option");o.setClassName("optionLayer"),o.y=20,t.addChild(o);var n=new ExLabel(LANGUAGE[COUNTRYCODE].optionTitle);n.setClassName("optionLayer effectLabel"),n.y=140,t.addChild(n);var r=new ExLabel('<button id="low">'+LANGUAGE[COUNTRYCODE].optionEffect[0]+"</button>",160);r.setClassName("effectSwitch optionLayer"),r.quality="low",r.x=80,r.y=192,r.on("touchend",function(){e(this.quality),effectLevel=0}),t.addChild(r);var l=new ExLabel('<button id="med">'+LANGUAGE[COUNTRYCODE].optionEffect[1]+"</button>",160);l.setClassName("effectSwitch optionLayer active"),l.quality="med",l.x=240,l.y=192,l.on("touchend",function(){e(this.quality),effectLevel=1}),t.addChild(l);var i=new ExLabel('<button id="high">'+LANGUAGE[COUNTRYCODE].optionEffect[2]+"</button>",160);i.setClassName("effectSwitch optionLayer"),i.quality="high",i.x=400,i.y=192,i.on("touchend",function(){e(this.quality),effectLevel=2}),t.addChild(i);var c=[r,l,i],s=new ExLabel('<button id="deleteButton" class="btn-long">'+LANGUAGE[COUNTRYCODE].optionDeleteData+"</button>");s.setClassName("deleteData optionLayer"),s.y=320,s.on("touchend",function(){window.confirm(LANGUAGE[COUNTRYCODE].optionDeleteConf)&&(localStorage.clear(),alert(LANGUAGE[COUNTRYCODE].optionDeleteComp))}),t.addChild(s);var m=new ExLabel('<button id="allStage" class="btn-long">'+LANGUAGE[COUNTRYCODE].optionAllStage+"</button>");return m.setClassName("openAllStage optionLayer"),m.on("touchend",function(){for(var e=[],t=0;STAGES.length>t;t++)e.push(0);localStorage.setItem("hal",JSON.stringify(e)),alert(LANGUAGE[COUNTRYCODE].optionAllStageUnlock)}),m.y=448,t.addChild(m),t}function createPlayerStatus(e){for(var t=0,a=0;e.length>a;a++)t+=e[a];var o=new Group;o._element=document.createElement("div"),o.x=480,o.y=544;var n=new ExLabel(" × "+t,2*BOX_SIZE,BOX_SIZE);n.setClassName("playerStars"),o.addChild(n);var r=new Sprite(BOX_SIZE,BOX_SIZE);return r.image=YELLOW_STAR,r.scale(.8,.8),o.addChild(r),o}function createRetryLabelOnGame(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].gameRetry,3*BOX_SIZE,BOX_SIZE);return e.setClassName("retryLabelOnGame"),e.x=416,e.y=544,e}function createPointerArrow(){var e=new PointerArrow;return e.x=428,e.y=276,e._element=document.createElement("div"),e._element.className="pointerArrow",e.width=30,e.rotate(300),e.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT).loop(),e}function createEndLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].tutoClearMsg);return e.x=100,e.y=150,e.setClassName("tuto_clear_msg"),e}function createLosePatternText(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].losePattern);return e.x=180,e.y=200,e.setClassName("msg"),e}function createPointerArrow2(e,t){var a=new Sprite;return a.x=e-30,a.y=t+30,a._element=document.createElement("div"),a._element.className="pointerArrow",a.width=30,a.rotate(300),a}function createPrevGoalLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].prevGoal);return e.setClassName("tuto_white_msg"),e.x=120,e.y=170,e}function createEndChainLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].endChain);return e.setClassName("tuto_black_msg"),e.x=110,e.y=170,e}function createAotamaLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].aotama);return e.setClassName("tuto_black_msg"),e.x=110,e.y=170,e}function createSurfaces(){WHITE_STAR=new Surface(BOX_SIZE,BOX_SIZE);var e=WHITE_STAR.context;e.beginPath(),e.fillStyle=COLORS.white,e.strokeStyle=COLORS.yellow,e.lineWidth=2,drawStar(BOX_SIZE/2,BOX_SIZE/2,5,BOX_SIZE/2,BOX_SIZE/3,e),e.closePath(),e.fill(),e.stroke(),YELLOW_STAR=new Surface(BOX_SIZE,BOX_SIZE);var t=YELLOW_STAR.context;t.beginPath(),t.fillStyle=COLORS.yellow,drawStar(BOX_SIZE/2,BOX_SIZE/2,5,BOX_SIZE/2,BOX_SIZE/3,t),t.closePath(),t.fill(),SCORE_STARS[0]=new Surface(2*BOX_SIZE,2*BOX_SIZE),SCORE_STARS[1]=new Surface(2*BOX_SIZE,2*BOX_SIZE);var a=SCORE_STARS[1].context;a.beginPath(),a.fillStyle=COLORS.yellow,a.strokeStyle=COLORS.white,a.lineWidth=3,drawStar(BOX_SIZE,1.6*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,a),a.closePath(),a.fill(),a.stroke(),SCORE_STARS[2]=new Surface(2*BOX_SIZE,2*BOX_SIZE);var o=SCORE_STARS[2].context;o.fillStyle=COLORS.yellow,o.strokeStyle=COLORS.white,o.lineWidth=3,o.beginPath(),drawStar(.5*BOX_SIZE,1.5*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,o),o.fill(),o.stroke(),o.closePath(),o.beginPath(),drawStar(1.5*BOX_SIZE,1.5*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,o),o.fill(),o.stroke(),o.closePath(),SCORE_STARS[3]=new Surface(2*BOX_SIZE,2*BOX_SIZE);var n=SCORE_STARS[3].context;n.fillStyle=COLORS.yellow,n.strokeStyle=COLORS.white,n.lineWidth=3,n.beginPath(),drawStar(1.5*BOX_SIZE,1.6*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,n),n.fill(),n.stroke(),n.closePath(),n.beginPath(),drawStar(.5*BOX_SIZE,1.6*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,n),n.fill(),n.stroke(),n.closePath(),n.beginPath(),drawStar(BOX_SIZE,1.5*BOX_SIZE,5,BOX_SIZE/2,BOX_SIZE/3,n),n.fill(),n.stroke(),n.closePath(),ORANGE=new Surface(BOX_SIZE,BOX_SIZE);var r=ORANGE.context;r.fillStyle=COLORS.orange,r.strokeStyle=COLORS.yellow,r.lineWidth=3,r.beginPath(),r.moveTo(BOX_HALF,0),r.lineTo(BOX_SIZE,BOX_HALF),r.lineTo(BOX_HALF,BOX_SIZE),r.lineTo(0,BOX_HALF),r.lineTo(BOX_HALF,0),r.fill(),r.stroke(),r.closePath(),r.beginPath(),r.fillStyle=COLORS.yellow,r.strokeStyle=COLORS.orange,r.moveTo(BOX_HALF,0),r.lineTo(1.5*BOX_HALF,.5*BOX_HALF),r.lineTo(BOX_HALF+6,.5*BOX_HALF),r.lineTo(BOX_HALF+6,1.5*BOX_HALF),r.lineTo(1.5*BOX_HALF,1.5*BOX_HALF),r.lineTo(BOX_HALF,BOX_SIZE),r.lineTo(.5*BOX_HALF,1.5*BOX_HALF),r.lineTo(BOX_HALF-6,1.5*BOX_HALF),r.lineTo(BOX_HALF-6,.5*BOX_HALF),r.lineTo(.5*BOX_HALF,.5*BOX_HALF),r.lineTo(BOX_HALF,0),r.fill(),r.stroke(),r.closePath(),PURPLE=new Surface(BOX_SIZE,BOX_SIZE);var l=PURPLE.context;l.fillStyle=COLORS.purple,l.strokeStyle=COLORS.yellow,l.lineWidth=3,l.beginPath(),l.moveTo(BOX_HALF,0),l.lineTo(BOX_SIZE,BOX_HALF),l.lineTo(BOX_HALF,BOX_SIZE),l.lineTo(0,BOX_HALF),l.lineTo(BOX_HALF,0),l.fill(),l.stroke(),l.closePath(),l.beginPath(),l.fillStyle=COLORS.yellow,l.strokeStyle=COLORS.purple,l.moveTo(0,BOX_HALF),l.lineTo(.5*BOX_HALF,1.5*BOX_HALF),l.lineTo(.5*BOX_HALF,BOX_HALF+6),l.lineTo(1.5*BOX_HALF,BOX_HALF+6),l.lineTo(1.5*BOX_HALF,1.5*BOX_HALF),l.lineTo(BOX_SIZE,BOX_HALF),l.lineTo(1.5*BOX_HALF,.5*BOX_HALF),l.lineTo(1.5*BOX_HALF,BOX_HALF-6),l.lineTo(.5*BOX_HALF,BOX_HALF-6),l.lineTo(.5*BOX_HALF,.5*BOX_HALF),l.lineTo(0,BOX_HALF),l.fill(),l.stroke(),l.closePath(),DIFFUSIONER=new Surface(BOX_SIZE,BOX_SIZE);var i=DIFFUSIONER.context;i.fillStyle=COLORS.red,i.strokeStyle=COLORS.yellow,i.lineWidth=3,i.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,8,BOX_SIZE/2,BOX_SIZE/3,i),i.fill(),i.stroke(),i.closePath(),SLANTER=new Surface(BOX_SIZE,BOX_SIZE);var c=SLANTER.context;c.fillStyle=COLORS.green,c.strokeStyle=COLORS.yellow,c.lineWidth=3,c.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,4,BOX_SIZE/2,BOX_SIZE/4,c),c.fill(),c.stroke(),c.closePath(),PIPE_RED=new Surface(BOX_SIZE,BOX_SIZE);var s=PIPE_RED.context;s.fillStyle=COLORS.red,s.strokeStyle=COLORS.yellow,s.lineWidth=3,s.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,s),s.fill(),s.stroke(),s.closePath(),PIPE_RED_OUT=new Surface(BOX_SIZE,BOX_SIZE);var m=PIPE_RED_OUT.context;m.fillStyle=COLORS.red,m.strokeStyle=COLORS.yellow,m.lineWidth=3,m.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,m),m.fill(),m.stroke(),m.closePath(),PIPE_GREEN=new Surface(BOX_SIZE,BOX_SIZE);var h=PIPE_GREEN.context;h.fillStyle=COLORS.green,h.strokeStyle=COLORS.yellow,h.lineWidth=3,h.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,h),h.fill(),h.stroke(),h.closePath(),PIPE_GREEN_OUT=new Surface(BOX_SIZE,BOX_SIZE);var u=PIPE_GREEN_OUT.context;u.fillStyle=COLORS.green,u.strokeStyle=COLORS.yellow,u.lineWidth=3,u.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,u),u.fill(),u.stroke(),u.closePath(),PIPE_BLUE=new Surface(BOX_SIZE,BOX_SIZE);var y=PIPE_BLUE.context;y.fillStyle=COLORS.blue,y.strokeStyle=COLORS.yellow,y.lineWidth=3,y.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,y),y.fill(),y.stroke(),y.closePath(),PIPE_BLUE_OUT=new Surface(BOX_SIZE,BOX_SIZE);var x=PIPE_BLUE_OUT.context;x.fillStyle=COLORS.blue,x.strokeStyle=COLORS.yellow,x.lineWidth=3,x.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,x),x.fill(),x.stroke(),x.closePath(),PIPE_PURPLE=new Surface(BOX_SIZE,BOX_SIZE);var d=PIPE_PURPLE.context;d.fillStyle=COLORS.purple,d.strokeStyle=COLORS.yellow,d.lineWidth=3,d.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,d),d.fill(),d.stroke(),d.closePath(),PIPE_PURPLE_OUT=new Surface(BOX_SIZE,BOX_SIZE);var S=PIPE_PURPLE_OUT.context;S.fillStyle=COLORS.purple,S.strokeStyle=COLORS.yellow,S.lineWidth=3,S.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,S),S.fill(),S.stroke(),S.closePath(),PIPE_ORANGE=new Surface(BOX_SIZE,BOX_SIZE);var p=PIPE_ORANGE.context;p.fillStyle=COLORS.purple,p.strokeStyle=COLORS.yellow,p.lineWidth=3,p.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,p),p.fill(),p.stroke(),p.closePath(),PIPE_ORANGE_OUT=new Surface(BOX_SIZE,BOX_SIZE);var E=PIPE_ORANGE_OUT.context;E.fillStyle=COLORS.purple,E.strokeStyle=COLORS.yellow,E.lineWidth=3,E.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,E),E.fill(),E.stroke(),E.closePath(),PIPE_COLORS={red:{pipe:PIPE_RED,pipeOut:PIPE_RED_OUT},green:{pipe:PIPE_GREEN,pipeOut:PIPE_GREEN_OUT},blue:{pipe:PIPE_BLUE,pipeOut:PIPE_BLUE_OUT},purple:{pipe:PIPE_PURPLE,pipeOut:PIPE_PURPLE_OUT},orange:{pipe:PIPE_ORANGE,pipeOut:PIPE_ORANGE_OUT}}}function createTutorialScene(){tutorialScene=new Scene;var e=createPointerArrow1(),t=createStartTutorialLabel();tutorialScene.addChild(t);var a=createSirotamaLabel();t.tl.delay(80).then(function(){tutorialScene.removeChild(t),tutorialScene.addChild(a),tutorialScene.addChild(e)}),tutorialScene.aotamaEndFlg=!1,tutoCurrentStage=[],TUTOSTAGES[0].forEach(function(e){var t=StageBuilder(e);t.x=e.x*BOX_SIZE,t.y=e.y*BOX_SIZE,tutoCurrentStage.push(t),tutorialScene.addChild(t)}),e.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT),e.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT),e.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT).then(function(){tutoCurrentStage[0].run(0),tutoCurrentStage.splice(0,1),tutorialScene.removeChild(a),tutorialScene.removeChild(e)});var o=createBacktoTopLabel();return tutorialScene.addChild(o),o.on("touchend",function(){var e=createTitleScene();GAME.replaceScene(e),initTutorialScene()}),tutorialScene}function createStageScene(){stageScene=new Scene,stageScene.initStage=function(){var e=this;this.star=0,this.canTap=!0,clearTimeout(this.endTimer),this.endTimer=null,this.cleared=!1,this.removeChild(this.retryLabel);for(var t=0;currentStage.length>t;t++)this.removeChild(currentStage[t]),delete currentStage[t];if(currentStage=[],this.stars)for(var t=0;this.stars.length>t;t++)this.removeChild(this.stars[t]),delete this.stars[t];this.stars=[];var a=new Timer;stageScene.addChild(a),STAGES[LEVEL].forEach(function(t){var a=StageBuilder(t);a.x=t.x*BOX_SIZE,a.y=t.y*BOX_SIZE,currentStage.push(a),e.addChild(a)})},stageScene.showResult=function(){var e=new Result;this.addChild(e),clearTimeout(this.endTimer),(userData[LEVEL]===void 0||userData[LEVEL]<this.star)&&(userData[LEVEL]=this.star),localStorage.setItem("hal",JSON.stringify(userData))},stageScene.gameOver=function(){var e=new GameOver;this.addChild(e)};for(var e=0;10>e;e++)for(var t=0;10>t;t++){var a=new Box;a.x=e*BOX_SIZE,a.y=t*BOX_SIZE,stageScene.addChild(a)}return stageScene}function createTitleScene(){function e(){document[n]?clearInterval(t.loopTimer):GAME.currentScene===t&&o.startAnim()}var t=new Scene,a=createTitleLabel();t.addChild(a),t.on("enter",function(){o.startAnim()}),t.on("exit",function(){clearInterval(t.loopTimer)}),t.on("touchend",function(){t.removeChild(l),t.addChild(i),t.addChild(c),t.addChild(s)});var o=new TitleBackAnim;t.addChild(o);var n,r;document.hidden!==void 0?(n="hidden",r="visibilitychange"):document.mozHidden!==void 0?(n="mozHidden",r="mozvisibilitychange"):document.msHidden!==void 0?(n="msHidden",r="msvisibilitychange"):document.webkitHidden!==void 0&&(n="webkitHidden",r="webkitvisibilitychange"),void 0!==document.addEventListener&&void 0!==n&&document.addEventListener(r,e,!1);var l=createTouchStartLabel();l.on("addedtoscene",function(){this.tl.fadeTo(0,30).fadeTo(1,30).loop()}),t.addChild(l);var i=createGameStartLabel();i.on("touchend",function(){GAME.replaceScene(h)});var c=createTutorialLabel();c.on("touchend",function(){GAME.replaceScene(tutorialScene)});var s=createOptionMenuButton(),m=createOptionMenu();s.on("touchend",function(){if(this.menuOpen){try{t.removeChild(m)}catch(e){}this.menuOpen=!1}else t.addChild(m),this.menuOpen=!0});var h=createSelectScene();return h.backToTop=function(){h.initSelect(),GAME.replaceScene(t)},t}function createSelectScene(){var e=new Scene;e.on("touchstart",function(t){e.startY=t.y}),e.on("touchmove",function(t){stageGroup.moveBy(0,t.y-e.startY),e.startY=t.y}),e.on("touchend",function(){var e=-160*Math.floor(stageGroup.childNodes.length/4)+320;stageGroup.y>0?stageGroup.tl.moveTo(0,0,10,SIN_EASEOUT):e>stageGroup.y&&stageGroup.tl.moveTo(0,e,10,SIN_EASEOUT)}),e.on("enter",function(){userData=JSON.parse(localStorage.getItem("hal")),null===userData&&(userData=[]),stageGroup=new StageGroup,e.addChild(stageGroup);for(var t=1.5,a=0,o=0,n=0,r=1.5;STAGES.length>o;o++){var l=0,i=!0,c="stageBox lock";userData.length>o?(l=userData[o],c="stageBox",i=!1):userData.length===o&&(c="stageBox nextStage",i=!1);var s=new StageBox(o,l,i);s._element.className=c,s.x=BOX_SIZE/4+2.5*n*BOX_SIZE,s.y=1.25*r*BOX_SIZE,stageGroup.addChild(s),stageBoxes.push(s),n++,4===n&&(n=0),3===o%4&&(r+=2),a=n,t=r}var m=new ExLabel("STAGE SELECT",640,110);m.setClassName("stageSelectText"),e.addChild(m)}),e.selectedStage=function(e){LEVEL=e,GAME.replaceScene(t),t.initStage()},e.initSelect=function(){for(var e=stageBoxes.length,t=0;e>t;t++)stageGroup.removeChild(stageBoxes[t]);stageBoxes=[]};var t=createStageScene();return t.stageSelect=function(){for(var t=stageBoxes.length,a=0;t>a;a++)stageGroup.removeChild(stageBoxes[a]);stageBoxes=[],GAME.replaceScene(e)},t.retryLabel=createRetryLabelOnGame(),t.retryLabel.on("touchend",function(){e.selectedStage(LEVEL)}),e}var GAME,MOVE_PX=4,BOX_SIZE=64,BOX_HALF=BOX_SIZE/2,BEAM_SIZE=32,BEAM_LENGTH=3,LOW_SPECTRUM=MOVE_PX,HIGH_SPECTRUM=24,LEVEL=0,DIRECTIONS={black:[!0,!0,!0,!0],white:[!0,!0,!0,!0],red:[!0,!0,!0,!0],green:[!0,!0,!0,!0],blue:[!0,!0,!0,!0],orange:[!0,!1,!0,!1],purple:[!1,!0,!1,!0]},TUTODIRECTIONS={start:[!0,!0,!0,!0],black:[!0,!0,!0,!0],white:[!0,!0,!0,!0],red:[!0,!0,!0,!0],green:[!0,!0,!0,!0],blue:[!0,!0,!0,!0],orange:[!0,!1,!0,!1],purple:[!1,!0,!1,!0]},COLORS={black:"#555555",white:"#ecf0f1",blue:"#38B5FE",green:"#36D7B7",red:"#ff6666",purple:"#BF77EC",yellow:"#F4D03F",orange:"#FFA533",pink:"#FFCCFF",pureWhite:"#fff"},BACKGROUND_ARC=null,WHITE_STAR=null,YELLOW_STAR=null,SCORE_STARS=[],DIFFUSIONER=null,SLANTER=null,LINKER=null,ORANGE=null,PURPLE=null,PIPE_RED=null,PIPE_GREEN=null,PIPE_BLUE=null,PIPE_PURPLE=null,PIPE_ORANGE=null,PIPE_RED_OUT=null,PIPE_GREEN_OUT=null,PIPE_BLUE_OUT=null,PIPE_PURPLE_OUT=null,PIPE_ORANGE_OUT=null,PIPE_COLORS=null,currentStage=[],STAGES=[[{x:0,y:4,name:"start"},{x:3,y:4,name:"block",color:"red"},{x:3,y:2,name:"star"},{x:3,y:6,name:"star"},{x:6,y:2,name:"star"},{x:9,y:4,name:"goal"}],[{x:3,y:1,name:"start"},{x:3,y:4,name:"block",color:"green"},{x:0,y:4,name:"star"},{x:3,y:7,name:"star"},{x:6,y:2,name:"star"},{x:9,y:4,name:"goal"}],[{x:0,y:4,name:"start"},{x:3,y:4,name:"block",color:"red"},{x:6,y:4,name:"block",color:"blue"},{x:3,y:2,name:"star"},{x:6,y:2,name:"star"},{x:8,y:2,name:"star"},{x:8,y:7,name:"goal"}],[{x:0,y:1,name:"start"},{x:0,y:4,name:"block",color:"red"},{x:3,y:4,name:"block",color:"blue"},{x:6,y:1,name:"star"},{x:6,y:7,name:"star"},{x:9,y:2,name:"star"},{x:9,y:4,name:"block",color:"red"},{x:9,y:7,name:"goal"}],[{x:0,y:1,name:"start"},{x:3,y:1,name:"block",color:"red"},{x:3,y:4,name:"block",color:"blue"},{x:6,y:4,name:"block",color:"green"},{x:9,y:7,name:"block",color:"green"},{x:4,y:1,name:"star"},{x:6,y:9,name:"star"},{x:3,y:5,name:"star"},{x:9,y:9,name:"goal"}],[{x:0,y:4,name:"start"},{x:2,y:4,name:"block",color:"purple"},{x:5,y:4,name:"block",color:"purple"},{x:6,y:7,name:"block",color:"purple"},{x:9,y:4,name:"star"},{x:6,y:1,name:"star"},{x:3,y:7,name:"star"},{x:9,y:7,name:"goal"}],[{x:0,y:4,name:"start"},{x:9,y:3,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"red"},{x:6,y:2,name:"star"},{x:3,y:3,name:"star"},{x:3,y:4,name:"block",color:"purple"},{x:6,y:4,name:"block",color:"purple"},{x:9,y:5,name:"block",color:"purple"},{x:6,y:5,name:"block",color:"blue"},{x:6,y:6,name:"star"},{x:3,y:5,name:"goal"}],[{x:0,y:4,name:"start"},{x:9,y:1,name:"block",color:"blue"},{x:6,y:1,name:"star"},{x:9,y:0,name:"star"},{x:3,y:4,name:"block",color:"purple"},{x:6,y:4,name:"block",color:"purple"},{x:6,y:7,name:"block",color:"purple"},{x:9,y:7,name:"block",color:"red"},{x:9,y:9,name:"star"},{x:3,y:7,name:"goal"}],[{x:0,y:1,name:"start"},{x:3,y:1,name:"block",color:"purple"},{x:9,y:1,name:"star"},{x:9,y:7,name:"star"},{x:3,y:4,name:"block",color:"blue"},{x:9,y:4,name:"block",color:"red"},{x:3,y:7,name:"block",color:"green"},{x:6,y:4,name:"block",color:"purple"},{x:6,y:7,name:"star"},{x:0,y:7,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"orange"},{x:3,y:6,name:"block",color:"orange"},{x:6,y:3,name:"block",color:"orange"},{x:3,y:0,name:"star"},{x:0,y:3,name:"star"},{x:6,y:0,name:"star"},{x:6,y:6,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"purple"},{x:0,y:3,name:"star"},{x:9,y:6,name:"star"},{x:6,y:9,name:"block",color:"blue"},{x:3,y:6,name:"block",color:"red"},{x:6,y:6,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"green"},{x:3,y:3,name:"block",color:"purple"},{x:3,y:0,name:"star"},{x:9,y:0,name:"goal"}],[{x:2,y:4,name:"start"},{x:3,y:5,name:"block",color:"purple"},{x:4,y:4,name:"block",color:"purple"},{x:6,y:2,name:"block",color:"purple"},{x:6,y:6,name:"block",color:"purple"},{x:3,y:2,name:"block",color:"orange"},{x:5,y:5,name:"block",color:"orange"},{x:7,y:4,name:"block",color:"orange"},{x:7,y:2,name:"star"},{x:4,y:6,name:"star"},{x:0,y:5,name:"star"},{x:5,y:3,name:"goal"}],[{x:0,y:3,name:"start"},{x:5,y:0,name:"star"},{x:9,y:2,name:"star"},{x:3,y:3,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"purple"},{x:9,y:3,name:"block",color:"red"},{x:5,y:6,name:"block",color:"blue"},{x:3,y:6,name:"block",color:"purple"},{x:9,y:4,name:"star"},{x:1,y:6,name:"goal"}],[{x:1,y:3,name:"start"},{x:0,y:4,name:"star"},{x:5,y:1,name:"block",color:"red"},{x:7,y:1,name:"star"},{x:3,y:3,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"purple"},{x:8,y:3,name:"block",color:"red"},{x:5,y:6,name:"block",color:"blue"},{x:3,y:6,name:"block",color:"purple"},{x:0,y:6,name:"block",color:"green"},{x:8,y:9,name:"star"},{x:5,y:9,name:"block",color:"purple"},{x:0,y:9,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"blue"},{x:6,y:9,name:"block",color:"orange"},{x:6,y:6,name:"block",color:"red"},{x:9,y:6,name:"block",color:"orange"},{x:9,y:3,name:"block",color:"orange"},{x:3,y:6,name:"star"},{x:3,y:3,name:"star"},{x:6,y:0,name:"star"},{x:9,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:3,y:0,name:"block",color:"purple"},{x:6,y:0,name:"block",color:"purple"},{x:9,y:0,name:"block",color:"red"},{x:4,y:3,name:"star"},{x:0,y:3,name:"block",color:"blue"},{x:5,y:3,name:"star"},{x:3,y:3,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"purple"},{x:9,y:6,name:"block",color:"green"},{x:0,y:6,name:"block",color:"green"},{x:3,y:6,name:"star"},{x:6,y:6,name:"goal"}],[{x:0,y:4,name:"start"},{x:2,y:4,name:"block",color:"green"},{x:5,y:4,name:"block",color:"green"},{x:5,y:2,name:"block",color:"red"},{x:5,y:6,name:"block",color:"blue"},{x:2,y:1,name:"block",color:"purple"},{x:2,y:7,name:"block",color:"purple"},{x:4,y:7,name:"block",color:"red"},{x:4,y:1,name:"block",color:"blue"},{x:8,y:3,name:"block",color:"purple"},{x:8,y:5,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"blue"},{x:6,y:5,name:"block",color:"red"},{x:3,y:2,name:"star"},{x:3,y:6,name:"star"},{x:3,y:3,name:"star"},{x:3,y:5,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:0,name:"block",color:"purple"},{x:6,y:0,name:"block",color:"purple"},{x:9,y:0,name:"block",color:"purple"},{x:9,y:3,name:"block",color:"blue"},{x:4,y:0,name:"block",color:"blue"},{x:5,y:0,name:"star"},{x:6,y:3,name:"block",color:"purple"},{x:3,y:3,name:"block",color:"purple"},{x:0,y:3,name:"block",color:"purple"},{x:0,y:6,name:"block",color:"red"},{x:3,y:6,name:"block",color:"purple"},{x:4,y:6,name:"star"},{x:5,y:6,name:"star"},{x:6,y:6,name:"block",color:"purple"},{x:9,y:6,name:"block",color:"purple"},{x:9,y:9,name:"block",color:"green"},{x:6,y:9,name:"block",color:"purple"},{x:3,y:9,name:"block",color:"purple"},{x:0,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:0,y:3,name:"block",color:"orange"},{x:0,y:6,name:"block",color:"orange"},{x:0,y:9,name:"block",color:"purple"},{x:3,y:9,name:"block",color:"red"},{x:9,y:6,name:"block",color:"blue"},{x:9,y:9,name:"block",color:"orange"},{x:3,y:6,name:"block",color:"orange"},{x:3,y:3,name:"block",color:"orange"},{x:3,y:1,name:"block",color:"purple"},{x:6,y:1,name:"block",color:"orange"},{x:6,y:3,name:"block",color:"orange"},{x:9,y:1,name:"block",color:"purple"},{x:6,y:8,name:"star"},{x:6,y:0,name:"star"},{x:8,y:6,name:"star"},{x:9,y:3,name:"goal"}],[{x:0,y:4,name:"start"},{x:3,y:4,name:"block",color:"purple"},{x:6,y:4,name:"block",color:"orange"},{x:6,y:1,name:"block",color:"purple"},{x:6,y:7,name:"block",color:"purple"},{x:9,y:1,name:"block",color:"purple"},{x:3,y:7,name:"block",color:"red"},{x:9,y:7,name:"block",color:"orange"},{x:7,y:3,name:"block",color:"blue"},{x:3,y:9,name:"star"},{x:3,y:1,name:"star"},{x:5,y:3,name:"star"},{x:9,y:3,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"blue"},{x:6,y:9,name:"block",color:"orange"},{x:6,y:6,name:"block",color:"red"},{x:9,y:6,name:"block",color:"orange"},{x:9,y:3,name:"block",color:"orange"},{x:0,y:2,name:"block",color:"orange"},{x:9,y:0,name:"block",color:"purple"},{x:3,y:3,name:"block",color:"purple"},{x:3,y:4,name:"block",color:"red"},{x:0,y:3,name:"block",color:"green"},{x:6,y:0,name:"block",color:"blue"},{x:4,y:0,name:"block",color:"purple"},{x:3,y:5,name:"star"},{x:9,y:9,name:"star"},{x:6,y:2,name:"star"},{x:0,y:0,name:"goal"}],[{x:0,y:9,name:"start"},{x:0,y:6,name:"block",color:"purple"},{x:3,y:6,name:"block",color:"orange"},{x:3,y:3,name:"block",color:"purple"},{x:2,y:8,name:"block",color:"blue"},{x:6,y:0,name:"block",color:"purple"},{x:5,y:5,name:"block",color:"blue"},{x:5,y:8,name:"star"},{x:6,y:7,name:"star"},{x:8,y:5,name:"star"},{x:6,y:3,name:"block",color:"orange"},{x:9,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:3,y:0,name:"block",color:"purple"},{x:6,y:0,name:"block",color:"red"},{x:6,y:3,name:"block",color:"purple"},{x:3,y:6,name:"slanter"},{x:1,y:4,name:"star"},{x:5,y:4,name:"star"},{x:1,y:8,name:"star"},{x:5,y:8,name:"goal"}],[{x:0,y:6,name:"start"},{x:3,y:1,name:"block",color:"red"},{x:3,y:4,name:"slanter"},{x:3,y:6,name:"block",color:"orange"},{x:5,y:6,name:"block",color:"orange"},{x:5,y:4,name:"slanter"},{x:5,y:1,name:"block",color:"blue"},{x:0,y:2,name:"star"},{x:7,y:2,name:"star"},{x:7,y:6,name:"star"},{x:8,y:1,name:"goal"}],[{x:1,y:4,name:"start"},{x:3,y:4,name:"block",color:"orange"},{x:3,y:3,name:"block",color:"purple"},{x:3,y:6,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"orange"},{x:5,y:6,name:"block",color:"orange"},{x:2,y:6,name:"slanter"},{x:6,y:6,name:"slanter"},{x:4,y:8,name:"block",color:"orange"},{x:5,y:2,name:"star"},{x:6,y:0,name:"star"},{x:4,y:5,name:"star"},{x:7,y:4,name:"goal"}],[{x:1,y:9,name:"start"},{x:4,y:9,name:"block",color:"orange"},{x:4,y:6,name:"slanter"},{x:3,y:5,name:"slanter"},{x:1,y:3,name:"slanter"},{x:2,y:2,name:"slanter"},{x:4,y:0,name:"slanter"},{x:5,y:1,name:"slanter"},{x:7,y:3,name:"slanter"},{x:8,y:4,name:"slanter"},{x:7,y:5,name:"slanter"},{x:6,y:3,name:"slanter"},{x:0,y:0,name:"star"},{x:9,y:1,name:"star"},{x:9,y:7,name:"star"},{x:5,y:4,name:"goal"}],[{x:0,y:4,name:"start"},{x:2,y:4,name:"block",color:"purple"},{x:5,y:4,name:"slanter"},{x:1,y:2,name:"block",color:"purple"},{x:3,y:0,name:"block",color:"orange"},{x:1,y:6,name:"block",color:"purple"},{x:3,y:8,name:"block",color:"orange"},{x:9,y:2,name:"block",color:"blue"},{x:7,y:0,name:"block",color:"red"},{x:9,y:6,name:"block",color:"green"},{x:7,y:8,name:"block",color:"blue"},{x:7,y:3,name:"block",color:"red"},{x:5,y:8,name:"star"},{x:9,y:3,name:"star"},{x:4,y:6,name:"star"},{x:3,y:3,name:"block",color:"purple"},{x:5,y:3,name:"goal"}],[{x:0,y:5,name:"start"},{x:3,y:3,name:"slanter"},{x:0,y:3,name:"block",color:"blue"},{x:5,y:8,name:"block",color:"green"},{x:8,y:8,name:"block",color:"blue"},{x:8,y:6,name:"block",color:"red"},{x:5,y:6,name:"block",color:"orange"},{x:6,y:4,name:"block",color:"orange"},{x:1,y:4,name:"star"},{x:5,y:3,name:"star"},{x:5,y:1,name:"star"},{x:3,y:6,name:"slanter"},{x:6,y:6,name:"slanter"},{x:6,y:3,name:"slanter"},{x:8,y:4,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"orange"},{x:9,y:6,name:"block",color:"purple"},{x:9,y:1,name:"block",color:"purple"},{x:3,y:6,name:"slanter"},{x:5,y:4,name:"slanter"},{x:3,y:2,name:"slanter"},{x:5,y:0,name:"slanter"},{x:7,y:2,name:"slanter"},{x:6,y:3,name:"star"},{x:6,y:6,name:"star"},{x:6,y:4,name:"star"},{x:7,y:1,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"orange"},{x:3,y:6,name:"slanter"},{x:2,y:5,name:"slanter"},{x:0,y:3,name:"slanter"},{x:1,y:2,name:"slanter"},{x:3,y:0,name:"slanter"},{x:4,y:1,name:"slanter"},{x:6,y:3,name:"slanter"},{x:7,y:4,name:"slanter"},{x:5,y:6,name:"slanter"},{x:3,y:5,name:"slanter"},{x:7,y:5,name:"block",color:"purple"},{x:5,y:3,name:"block",color:"purple"},{x:5,y:5,name:"block",color:"orange"},{x:3,y:3,name:"block",color:"blue"},{x:1,y:3,name:"star"},{x:3,y:1,name:"star"},{x:7,y:3,name:"star"},{x:4,y:4,name:"goal"}],[{x:0,y:5,name:"start"},{x:3,y:5,name:"block",color:"red"},{x:3,y:2,name:"block",color:"purple"},{x:3,y:8,name:"block",color:"purple"},{x:6,y:2,name:"block",color:"red"},{x:9,y:1,name:"block",color:"red"},{x:8,y:0,name:"block",color:"blue"},{x:9,y:4,name:"block",color:"green"},{x:9,y:6,name:"star"},{x:5,y:8,name:"block",color:"purple"},{x:5,y:0,name:"block",color:"purple"},{x:8,y:3,name:"block",color:"purple"},{x:9,y:0,name:"star"},{x:7,y:8,name:"block",color:"blue"},{x:7,y:1,name:"block",color:"red"},{x:7,y:6,name:"block",color:"green"},{x:6,y:5,name:"star"},{x:9,y:5,name:"goal"}],[{x:1,y:1,name:"start"},{x:6,y:3,name:"block",color:"purple"},{x:4,y:0,name:"block",color:"red"},{x:7,y:0,name:"block",color:"blue"},{x:4,y:3,name:"block",color:"green"},{x:9,y:3,name:"block",color:"red"},{x:6,y:5,name:"block",color:"red"},{x:5,y:5,name:"block",color:"blue"},{x:3,y:1,name:"block",color:"purple"},{x:6,y:1,name:"block",color:"purple"},{x:9,y:4,name:"block",color:"blue"},{x:3,y:5,name:"block",color:"purple"},{x:7,y:4,name:"star"},{x:9,y:7,name:"block",color:"red"},{x:7,y:7,name:"star"},{x:5,y:7,name:"block",color:"blue"},{x:3,y:4,name:"block",color:"green"},{x:9,y:9,name:"block",color:"green"},{x:6,y:9,name:"block",color:"blue"},{x:2,y:9,name:"block",color:"red"},{x:2,y:7,name:"block",color:"green"},{x:9,y:2,name:"star"},{x:0,y:9,name:"goal"}],[{x:1,y:8,name:"start"},{x:3,y:8,name:"block",color:"purple"},{x:5,y:8,name:"block",color:"purple"},{x:8,y:8,name:"block",color:"orange"},{x:8,y:6,name:"block",color:"blue"},{x:5,y:4,name:"diffusioner"},{x:4,y:4,name:"block",color:"red"},{x:4,y:3,name:"slanter"},{x:6,y:4,name:"block",color:"orange"},{x:5,y:3,name:"block",color:"orange"},{x:6,y:3,name:"block",color:"orange"},{x:6,y:5,name:"block",color:"purple"},{x:4,y:5,name:"block",color:"purple"},{x:6,y:1,name:"star"},{x:2,y:1,name:"star"},{x:2,y:5,name:"star"},{x:5,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:2,y:4,name:"diffusioner"},{x:8,y:4,name:"diffusioner"},{x:0,y:3,name:"block",color:"purple"},{x:3,y:4,name:"block",color:"blue"},{x:2,y:3,name:"block",color:"green"},{x:8,y:5,name:"block",color:"orange"},{x:5,y:1,name:"star"},{x:5,y:7,name:"star"},{x:8,y:2,name:"star"},{x:8,y:8,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:2,name:"diffusioner"},{x:7,y:2,name:"diffusioner"},{x:7,y:6,name:"diffusioner"},{x:3,y:6,name:"diffusioner"},{x:5,y:4,name:"slanter"},{x:2,y:7,name:"slanter"},{x:8,y:7,name:"slanter"},{x:3,y:3,name:"slanter"},{x:5,y:7,name:"block",color:"orange"},{x:5,y:9,name:"block",color:"orange"},{x:2,y:9,name:"block",color:"purple"},{x:5,y:0,name:"block",color:"purple"},{x:5,y:2,name:"block",color:"red"},{x:1,y:2,name:"block",color:"orange"},{x:1,y:8,name:"star"},{x:9,y:8,name:"star"},{x:1,y:0,name:"star"},{x:7,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:2,y:4,name:"diffusioner"},{x:8,y:4,name:"diffusioner"},{x:0,y:3,name:"block",color:"purple"},{x:3,y:3,name:"block",color:"purple"},{x:2,y:5,name:"block",color:"purple"},{x:3,y:4,name:"block",color:"blue"},{x:2,y:3,name:"block",color:"green"},{x:7,y:3,name:"slanter"},{x:8,y:5,name:"block",color:"orange"},{x:5,y:1,name:"star"},{x:6,y:7,name:"star"},{x:9,y:1,name:"star"},{x:8,y:8,name:"goal"}],[{x:0,y:8,name:"start"},{x:3,y:1,name:"diffusioner"},{x:7,y:1,name:"diffusioner"},{x:7,y:5,name:"diffusioner"},{x:3,y:5,name:"diffusioner"},{x:5,y:3,name:"slanter"},{x:2,y:5,name:"slanter"},{x:5,y:6,name:"block",color:"orange"},{x:7,y:6,name:"block",color:"orange"},{x:5,y:8,name:"block",color:"orange"},{x:4,y:1,name:"block",color:"orange"},{x:2,y:8,name:"block",color:"purple"},{x:8,y:1,name:"block",color:"purple"},{x:3,y:2,name:"block",color:"purple"},{x:3,y:4,name:"block",color:"purple"},{x:7,y:4,name:"block",color:"purple"},{x:2,y:2,name:"block",color:"blue"},{x:6,y:1,name:"block",color:"orange"},{x:2,y:4,name:"block",color:"red"},{x:5,y:1,name:"star"},{x:3,y:3,name:"star"},{x:7,y:3,name:"star"},{x:0,y:0,name:"goal"}],[{x:0,y:8,name:"start"},{x:1,y:6,name:"diffusioner"},{x:3,y:8,name:"slanter"},{x:2,y:5,name:"slanter"},{x:4,y:3,name:"diffusioner"},{x:5,y:2,name:"slanter"},{x:8,y:4,name:"slanter"},{x:3,y:5,name:"block",color:"purple"},{x:5,y:5,name:"block",color:"orange"},{x:5,y:5,name:"block",color:"orange"},{x:7,y:7,name:"block",color:"orange"},{x:5,y:7,name:"slanter"},{x:3,y:9,name:"block",color:"red"},{x:4,y:6,name:"star"},{x:6,y:4,name:"star"},{x:3,y:2,name:"star"},{x:3,y:7,name:"goal"}],[{x:1,y:2,name:"start"},{x:7,y:2,name:"pipe",color:"blue",pipeStatus:{x:4,y:7,direction:"right"}},{x:6,y:7,name:"block",color:"red"},{x:4,y:4,name:"star"},{x:6,y:9,name:"star"},{x:9,y:7,name:"star"},{x:6,y:4,name:"goal"}],[{x:1,y:1,name:"start"},{x:7,y:1,name:"pipe",color:"red",pipeStatus:{x:1,y:8,direction:"right"}},{x:4,y:4,name:"pipe",color:"green",pipeStatus:{x:8,y:6,direction:"left"}},{x:4,y:1,name:"block",color:"red"},{x:5,y:6,name:"block",color:"red"},{x:4,y:8,name:"block",color:"red"},{x:5,y:0,name:"star"},{x:8,y:3,name:"star"},{x:2,y:6,name:"star"},{x:2,y:3,name:"goal"}],[{x:0,y:4,name:"start"},{x:2,y:3,name:"block",color:"red"},{x:2,y:5,name:"block",color:"blue"},{x:5,y:3,name:"block",color:"green"},{x:3,y:4,name:"diffusioner"},{x:4,y:3,name:"star"},{x:4,y:4,name:"star"},{x:4,y:5,name:"star"},{x:8,y:0,name:"goal"}],[{x:0,y:4,name:"start"},{x:4,y:1,name:"pipe",color:"blue",pipeStatus:{x:0,y:5,direction:"right"}},{x:3,y:4,name:"block",color:"red"},{x:6,y:4,name:"block",color:"blue"},{x:9,y:1,name:"block",color:"green"},{x:9,y:5,name:"block",color:"green"},{x:7,y:5,name:"block",color:"purple"},{x:7,y:1,name:"block",color:"red"},{x:6,y:5,name:"star"},{x:4,y:5,name:"star"},{x:7,y:3,name:"star"},{x:1,y:5,name:"goal"}],[{x:1,y:4,name:"start"},{x:3,y:7,name:"pipe",color:"red",pipeStatus:{x:0,y:0,direction:"down"}},{x:3,y:3,name:"pipe",color:"green",pipeStatus:{x:0,y:9,direction:"right"}},{x:6,y:3,name:"pipe",color:"blue",pipeStatus:{x:9,y:0,direction:"left"}},{x:6,y:7,name:"pipe",color:"orange",pipeStatus:{x:9,y:9,direction:"up"}},{x:0,y:3,name:"block",color:"purple"},{x:1,y:7,name:"block",color:"purple"},{x:9,y:6,name:"block",color:"green"},{x:6,y:9,name:"block",color:"orange"},{x:2,y:5,name:"block",color:"blue"},{x:3,y:9,name:"block",color:"red"},{x:9,y:3,name:"block",color:"purple"},{x:5,y:5,name:"star"},{x:2,y:0,name:"star"},{x:6,y:6,name:"star"},{x:6,y:0,name:"goal"}],[{x:0,y:5,name:"start"},{x:0,y:0,name:"pipe",color:"red",pipeStatus:{x:2,y:4,direction:"right"}},{x:3,y:2,name:"pipe",color:"green",pipeStatus:{x:8,y:4,direction:"left"}},{x:0,y:6,name:"block",color:"blue"},{x:3,y:6,name:"block",color:"red"},{x:6,y:6,name:"block",color:"purple"},{x:5,y:7,name:"block",color:"orange"},{x:9,y:3,name:"block",color:"orange"},{x:9,y:6,name:"block",color:"red"},{x:5,y:9,name:"block",color:"blue"},{x:9,y:0,name:"block",color:"green"},{x:6,y:0,name:"block",color:"purple"},{x:5,y:4,name:"slanter"},{x:4,y:4,name:"slanter"},{x:6,y:4,name:"slanter"},{x:5,y:3,name:"slanter"},{x:5,y:5,name:"slanter"},{x:4,y:3,name:"star"},{x:6,y:3,name:"star"},{x:4,y:5,name:"star"},{x:6,y:5,name:"goal"}],[{x:0,y:4,name:"start"},{x:0,y:5,name:"block",color:"red"},{x:2,y:5,name:"block",color:"blue"},{x:2,y:3,name:"block",color:"orange"},{x:2,y:1,name:"block",color:"purple"},{x:1,y:1,name:"slanter"},{x:3,y:7,name:"slanter"},{x:2,y:0,name:"pipe",color:"red",pipeStatus:{x:3,y:8,direction:"right"}},{x:4,y:2,name:"pipe",color:"green",pipeStatus:{x:2,y:8,direction:"right"}},{x:6,y:2,name:"pipe",color:"blue",pipeStatus:{x:3,y:9,direction:"up"}},{x:3,y:3,name:"block",color:"purple"},{x:6,y:3,name:"diffusioner"},{x:4,y:8,name:"block",color:"orange"},{x:5,y:8,name:"slanter"},{x:7,y:6,name:"slanter"},{x:6,y:8,name:"block",color:"orange"},{x:0,y:0,name:"star"},{x:5,y:9,name:"star"},{x:4,y:6,name:"star"},{x:6,y:5,name:"goal"}],[{x:4,y:5,name:"start"},{x:6,y:5,name:"block",color:"blue"},{x:6,y:3,name:"pipe",color:"green",pipeStatus:{x:3,y:6,direction:"right"}},{x:5,y:6,name:"block",color:"purple"},{x:7,y:6,name:"block",color:"red"},{x:7,y:4,name:"block",color:"orange"},{x:7,y:2,name:"block",color:"green"},{x:5,y:1,name:"slanter"},{x:5,y:2,name:"block",color:"purple"},{x:3,y:2,name:"pipe",color:"red",pipeStatus:{x:0,y:9,direction:"right"}},{x:5,y:4,name:"pipe",color:"blue",pipeStatus:{x:0,y:2,direction:"down"}},{x:3,y:9,name:"block",color:"blue"},{x:6,y:9,name:"block",color:"red"},{x:9,y:9,name:"block",color:"green"},{x:9,y:7,name:"block",color:"blue"},{x:9,y:4,name:"block",color:"orange"},{x:8,y:4,name:"block",color:"red"},{x:9,y:1,name:"block",color:"green"},{x:9,y:0,name:"block",color:"blue"},{x:6,y:0,name:"block",color:"red"},{x:3,y:0,name:"block",color:"green"},{x:0,y:0,name:"block",color:"blue"},{x:0,y:4,name:"block",color:"green"},{x:0,y:6,name:"block",color:"red"},{x:3,y:4,name:"star"},{x:3,y:3,name:"star"},{x:3,y:5,name:"star"},{x:0,y:8,name:"goal"}],[{x:5,y:5,name:"start"},{x:5,y:7,name:"slanter"},{x:7,y:5,name:"pipe",color:"red",pipeStatus:{x:3,y:7,direction:"right"}},{x:3,y:5,name:"diffusioner"},{x:5,y:3,name:"block",color:"blue"},{x:3,y:3,name:"slanter"},{x:7,y:6,name:"slanter"},{x:5,y:1,name:"pipe",color:"blue",pipeStatus:{x:7,y:7,direction:"right"}},{x:7,y:3,name:"diffusioner"},{x:9,y:6,name:"star"},{x:9,y:4,name:"block",color:"orange"},{x:4,y:9,name:"pipe",color:"green",pipeStatus:{x:7,y:9,direction:"up"}},{x:9,y:1,name:"block",color:"purple"},{x:1,y:4,name:"block",color:"orange"},{x:7,y:1,name:"block",color:"blue"},{x:4,y:1,name:"slanter"},{x:1,y:7,name:"star"},{x:5,y:8,name:"star"},{x:5,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:0,y:3,name:"block",color:"orange"},{x:0,y:6,name:"block",color:"blue"},{x:2,y:6,name:"pipe",color:"red",pipeStatus:{x:3,y:1,direction:"right"}},{x:0,y:8,name:"pipe",color:"blue",pipeStatus:{x:3,y:5,direction:"up"}},{x:3,y:3,name:"block",color:"purple"},{x:5,y:1,name:"block",color:"orange"},{x:5,y:3,name:"diffusioner"},{x:6,y:3,name:"block",color:"purple"},{x:5,y:4,name:"block",color:"orange"},{x:5,y:5,name:"block",color:"purple"},{x:7,y:5,name:"star"},{x:7,y:3,name:"diffusioner"},{x:7,y:2,name:"diffusioner"},{x:7,y:1,name:"star"},{x:2,y:8,name:"star"},{x:2,y:2,name:"pipe",color:"green",pipeStatus:{x:3,y:7,direction:"right"}},{x:8,y:2,name:"block",color:"orange"},{x:8,y:5,name:"block",color:"orange"},{x:5,y:7,name:"block",color:"purple"},{x:7,y:7,name:"goal"}],[{x:0,y:9,name:"start"},{x:0,y:7,name:"block",color:"purple"},{x:2,y:7,name:"block",color:"orange"},{x:2,y:5,name:"block",color:"orange"},{x:2,y:2,name:"diffusioner"},{x:1,y:1,name:"slanter"},{x:3,y:1,name:"slanter"},{x:1,y:3,name:"slanter"},{x:3,y:3,name:"slanter"},{x:5,y:5,name:"block",color:"orange"},{x:5,y:2,name:"diffusioner"},{x:4,y:1,name:"slanter"},{x:6,y:1,name:"slanter"},{x:4,y:3,name:"slanter"},{x:6,y:3,name:"slanter"},{x:8,y:5,name:"block",color:"orange"},{x:8,y:2,name:"diffusioner"},{x:7,y:1,name:"slanter"},{x:9,y:1,name:"slanter"},{x:7,y:3,name:"slanter"},{x:9,y:3,name:"slanter"},{x:8,y:0,name:"pipe",color:"green",pipeStatus:{x:3,y:9,direction:"right"}},{x:2,y:0,name:"pipe",color:"red",pipeStatus:{x:9,y:4,direction:"down"}},{x:9,y:6,name:"block",color:"orange"},{x:8,y:9,name:"star"},{x:6,y:9,name:"block",color:"purple"},{x:9,y:8,name:"star"},{x:5,y:0,name:"star"},{x:9,y:9,name:"goal"}]],TUTOSTAGES=[[{x:1,y:4,name:"tutoBlock",color:"start"},{x:4,y:4,name:"tutoBlock",color:"blue"},{x:7,y:4,name:"tutoGoal",color:"green"}],[{x:1,y:4,name:"tutoBlock",color:"start"},{x:4,y:4,name:"tutoBlock",color:"blue"},{x:7,y:7,name:"tutoGoal",color:"green"}],[{x:0,y:4,name:"tutoBlock",color:"start"},{x:4,y:4,name:"tutoBlock",color:"blue"},{x:7,y:7,name:"tutoGoal",color:"green"}]],tutoCurrentStage=[],COUNTRYCODE=browserLanguage(),userData,stageBoxes=[],stageGroup,effectLevel=1,LANGUAGE={ja:{title:"Touch<br /><span>Bloomy</span>",touchStart:"画面をタッチ",optionTitle:"エフェクト",optionEffect:["控えめ","普通","ど派手"],optionDeleteData:"セーブデータを削除",optionDeleteConf:"本当に削除しますか？",optionDeleteComp:"セーブデータを削除しました",optionAllStage:"全ステージを解放(大会用)",optionAllStageUnlock:"全てのステージで遊べるようになりました！",gameStart:"ゲーム開始",gameOver:"Game Over",gameRetry:"リトライ",howToPlay:"遊び方",startTutorial:"今からこのゲームのチュートリアルを始めます",sirotama:"ゲーム開始時このオブジェクトが四散します",aotama:"破片が他のオブジェクトに当たると誘爆します",prevGoal:"黄色いゴールオブジェクトに当てればクリアです",tutoClear:"このようにゴールオブジェクトを<br/>壊せばクリアです",nextLosePattern:"それでは、<br/>次は負けパターンを見てみましょう",losePattern:"負けパターンを始めます",endChain:"このままでは連鎖が途切れてしまいます",loseMsg:"これであなたの負けです",yourMission:"あなたは一つオブジェクトを置いて<br/>ゴールまで導く事が出来ます",letsWin:"さあ次はクリアしましょう",tutoThirdStartMsg:"画面をタップしてオブジェクトを置き,<br/>ゴールオブジェクトまで連鎖させましょう",tutoClearMsg:"ゲームクリアです!",tutoClearMsg2:"本番のステージでは<br/>オブジェクトを置くまでに時間制限があります",tutoClearMsg3:"それでは、ゲームをお楽しみ下さい",backToTop:"TOPへ戻る"},en:{title:"Touch<br /><span>Bloomy</span>",touchStart:"Touch Screen",optionTitle:"Effect",optionEffect:["Low","Normal","HIGH"],optionDeleteData:"Delete Save Data",optionDeleteConf:"Are you sure you want to delete?",optionDeleteComp:"Save Data was deleted",optionAllStage:"All Stage unlock (For html5jcup)",optionAllStageUnlock:"Stage of all has been unlocked!",gameStart:"Start Game",gameOver:"Game Over",gameRetry:"Retry",howToPlay:"How to play",startTutorial:"Let's start tutorial'",sirotama:"First, White Object is broken",aotama:"When Snipets touch another object,the object is broken",prevGoal:"This is Goal Object,and breaking this is Stage Clear",tutoClear:"It's Clear",nextLosePattern:"OK? <br/>Next Lose pattern!",losePattern:"This is lose pattern",endChain:"This case,chaining come to an end",loseMsg:"You lose",yourMission:"Your Mission:All break and Chain to Goal",letsWin:"Next Let's Win!",tutoThirdStartMsg:"You can put one Circle to Chain to Goal",tutoClearMsg:"You did it!",tutoClearMsg2:"If this is real game,It have a time limit",tutoClearMsg3:"Enjoy your game!",backToTop:"Back to Top"}},tutorialScene=null;
enchant(),window.onload=function(){GAME=new Game(640,640),GAME.fps=30,GAME.onload=function(){GAME.rootScene.backgroundColor="white",createSurfaces();var e=createTitleScene();initTutorialScene(),GAME.pushScene(e)},GAME.start()};var TitleBackAnim=Class.create(Group,{initialize:function(){Group.call(this),this.count=3,this.next=0,this.blocks=[new Block("red"),new Block("blue"),new Block("green")],this.positions=[{x:1,y:1},{x:8,y:1},{x:8,y:8},{x:1,y:8}]},onaddedtoscene:function(){for(var e=this,t=0;this.blocks.length>t;t++){var a=this.blocks[t];a.x=this.positions[t].x*BOX_SIZE,a.y=this.positions[t].y*BOX_SIZE,this.parentNode.addChild(a),a.run=function(){if(this.parentNode){var t=this,a=new HitArc(this.color);a.x=this.x-128,a.y=this.y-128,this.parentNode.addChild(a),e.next++,3===e.next&&(e.next=0);for(var o in this.beamStatus){var n={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,color:this.color,parentBlock:this,beamLength:BEAM_LENGTH};this.parentNode.addChild(new Beam(this.beamStatus[o],n))}t.tl.moveTo(e.positions[e.count].x*BOX_SIZE,e.positions[e.count].y*BOX_SIZE,30),e.count++,4===e.count&&(e.count=0)}}}},startAnim:function(){var e=this;this.parentNode.loopTimer=setInterval(function(){e.blocks[e.next].run()},2500)}}),StageGroup=Class.create(Group,{initialize:function(){Group.call(this),this._element=document.createElement("div")},onaddedtoscene:function(){var e=this,t=createBacktoTopLabel();t.on("touchend",function(){e.parentNode.backToTop();for(var t=e.parentNode.childNodes.length,a=0;t>a;a++)e.parentNode.removeChild(e.childNodes[t-a-1])}),this.parentNode.addChild(t);var a=createPlayerStatus(userData);this.parentNode.addChild(a)}}),StageBox=Class.create(Sprite,{initialize:function(e,t,a){Sprite.call(this,2*BOX_SIZE,2*BOX_SIZE),this._element=document.createElement("div"),this._element.innerHTML=e+1,this.image=SCORE_STARS[t],this.level=e,this.moved=!1,this.isLock=a},ontouchstart:function(e){this.startEvent=e,this.moved=!1},ontouchmove:function(e){(Math.abs(this.startEvent.x-e.x)>10||Math.abs(this.startEvent.y-e.y)>10)&&(this.moved=!0)},ontouchend:function(){this.moved||this.isLock||GAME.currentScene.selectedStage(this.level)}}),Box=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="box",this.moved=!1},ontouchstart:function(e){this.startEvent=e,this.moved=!1,this._element.className="box touched"},ontouchmove:function(e){(Math.abs(this.startEvent.x-e.x)>10||Math.abs(this.startEvent.y-e.y)>10)&&(this.moved=!0)},ontouchend:function(){if(this._element.className="box",console.log("ontouchend"),!this.parentNode.canTap)return console.log("Can not tap"),void 0;if(this.moved)return console.log("Tap cansel"),void 0;console.log("Set block"),this.parentNode.canTap=!1;var e=new Block("white");e.x=this.x,e.y=this.y,currentStage.push(e),this.parentNode.addChild(e)}}),HitArc=Class.create(Sprite,{initialize:function(e){Sprite.call(this,320,320),this.scaleX=.1,this.scaleY=.1;var t=new Surface(320,320);t.context.beginPath(),t.context.fillStyle=COLORS[e],t.context.arc(160,160,160,0,2*Math.PI,!0),t.context.fill(),this.image=t},onaddedtoscene:function(){var e=this;this.tl.scaleTo(1.5*effectLevel*effectLevel,1.5*effectLevel*effectLevel,20).delay(20*(effectLevel-1)).fadeTo(0,10*effectLevel).then(function(){GAME.currentScene.removeChild(e)})}}),Timer=Class.create(Label,{initialize:function(){Label.call(this),this.timer=20,this.text=this.timer,this.font="400px Bitter",this.color=COLORS.blue,this.width=640,this.height=640,this.originX=320,this.originY=320,this.opacity=.4,this.textAlign="center"},onaddedtoscene:function(){this.tl.scaleTo(.1,.1,600),console.log("timer add")},onenterframe:function(){0===this.age%30&&(this.text=--this.timer,5===this.timer?this.color=COLORS.yellow:3===this.timer&&(this.color=COLORS.red),this.timer>0&&!this.parentNode.canTap?(this.parentNode.addChild(this.parentNode.retryLabel),currentStage[0].run(),this.parentNode.removeChild(this),currentStage.splice(0,1)):0>=this.timer&&(this.parentNode.addChild(this.parentNode.retryLabel),console.log("Not yet tap."),this.parentNode.canTap=!1,currentStage[0].run(),this.parentNode.removeChild(this),currentStage.splice(0,1)))}}),Result=Class.create(Group,{initialize:function(){function e(){t.removeChild(t.clearLabel),t.removeChild(t.nextStage);for(var e=0;t.resultStars.length>e;e++)t.removeChild(t.resultStars[e]);t.parentNode.removeChild(t.prevStage),t.parentNode.removeChild(t.nextStage),t.parentNode.removeChild(t.stageSelect),t.parentNode.removeChild(t.retry),t.parentNode.removeChild(t)}Group.call(this);var t=this;this._element=document.createElement("div"),this.clearLabel=new ExLabel("Stage "+(LEVEL+1)+" Clear !",640,80),this.clearLabel.setClassName("clearText"),this.clearLabel.opacity=0,this.clearLabel.x=0,this.clearLabel.y=100,this.addChild(this.clearLabel),this.resultStars=[],this.resultStars[0]=new Star,this.resultStars[0].x=160,this.resultStars[0].y=320,this.resultStars[1]=new Star,this.resultStars[1].x=288,this.resultStars[1].y=288,this.resultStars[2]=new Star,this.resultStars[2].x=416,this.resultStars[2].y=320,this.resultStars.forEach(function(e){e.onaddedtoscene=null,e.scaleX=.8,e.scaleY=.8,e.opacity=0,t.addChild(e)}),this.nextStage=new Block("black"),this.nextStage._element.className="black forResultBlock",this.nextStage._element.innerHTML='<i class="icon-pageforward">',this.nextStage.x=448,this.nextStage.y=480,this.nextStage.addEventListener("touchend",function(){var a=new HitArc("black");a.x=t.nextStage.x-128,a.y=t.nextStage.y-128,t.parentNode.addChild(a),LEVEL++,t.parentNode.initStage(),e()}),this.prevStage=new Block("black"),this.prevStage._element.className="black forResultBlock",this.prevStage._element.innerHTML='<i class="icon-pageback">',this.prevStage.x=128,this.prevStage.y=480,this.prevStage.addEventListener("touchend",function(){var a=new HitArc("black");a.x=t.prevStage.x-128,a.y=t.prevStage.y-128,t.parentNode.addChild(a),LEVEL--,t.parentNode.initStage(),e()}),this.stageSelect=new Block("black"),this.stageSelect._element.className="black forResultBlock",this.stageSelect._element.innerHTML='<i class="icon-th">',this.stageSelect.x=288,this.stageSelect.y=432,this.stageSelect.addEventListener("touchend",function(){t.parentNode.removeChild(BACKGROUND_ARC),e(),GAME.currentScene.stageSelect()}),this.retry=new Block("black"),this.retry._element.className="black forResultBlock",this.retry._element.innerHTML='<i class="icon-repeat">',this.retry.x=288,this.retry.y=528,this.retry.addEventListener("touchend",function(){var a=new HitArc("black");a.x=t.retry.x-128,a.y=t.retry.y-128,t.parentNode.addChild(a),t.parentNode.initStage(),e()})},onaddedtoscene:function(){var e=this,t=0;this.clearLabel.tl.delay(10).fadeTo(1,10);for(var a=0;this.parentNode.star>a;a++)this.resultStars[a].tl.delay(25).fadeTo(1,10).delay(15).delay(15*a).scaleTo(1.3,1.3,10).and().rotateTo(144,10).then(function(){e.resultStars[t++].image=YELLOW_STAR});this.tl.delay(50+15*a).then(function(){LEVEL&&(e.parentNode.addChild(e.prevStage),e.prevStage.tl.scaleTo(0,0,0).then(function(){e.prevStage._element.className="black changeBu"}).scaleTo(1,1,15,BOUNCE_EASEOUT)),LEVEL!==STAGES.length-1&&(e.parentNode.addChild(e.nextStage),e.nextStage.tl.scaleTo(0,0,0).then(function(){e.nextStage._element.className="black changeBu"}).scaleTo(1,1,15,BOUNCE_EASEOUT)),e.parentNode.addChild(e.stageSelect),e.stageSelect.tl.scaleTo(0,0,0).then(function(){e.stageSelect._element.className="black"}).scaleTo(1,1,15,BOUNCE_EASEOUT),e.parentNode.addChild(e.retry),e.retry.tl.scaleTo(0,0,0).then(function(){e.retry._element.className="black"}).scaleTo(1,1,15,BOUNCE_EASEOUT)})}}),GameOver=Class.create(Group,{initialize:function(){Group.call(this);var e=this;this._element=document.createElement("div"),this.gameOverLabel=new ExLabel(LANGUAGE[COUNTRYCODE].gameOver,640,100),this.gameOverLabel.setClassName("gameOverText"),this.gameOverLabel.x=0,this.gameOverLabel.y=-80,this.addChild(this.gameOverLabel),this.again=new Block("black"),this.again._element.className="black",this.again._element.innerHTML='<i class="icon-repeat">',this.again.x=352,this.again.y=480,this.addChild(this.again),this.again.addEventListener("touchend",function(){var t=new HitArc("black");t.x=e.again.x-128,t.y=e.again.y-128,e.parentNode.addChild(t),e.parentNode.stars.forEach(function(t){t.run=function(){},e.parentNode.removeChild(t)}),e.parentNode.initStage(),e.removeChild(e.gameOverLabel),e.removeChild(e.again),e.removeChild(e.stageSelect),e.parentNode.removeChild(e)}),this.stageSelect=new Block("black"),this.stageSelect._element.className="black",this.stageSelect._element.innerHTML='<i class="icon-th">',this.stageSelect.x=224,this.stageSelect.y=480,this.addChild(this.stageSelect),this.stageSelect.addEventListener("touchend",function(){e.parentNode.removeChild(BACKGROUND_ARC),e.parentNode.stars.forEach(function(t){t.run=function(){},e.parentNode.removeChild(t)}),e.removeChild(e.gameOverLabel),e.removeChild(e.again),e.removeChild(e.stageSelect),e.parentNode.removeChild(e),GAME.currentScene.stageSelect(),delete e})},onaddedtoscene:function(){this.parentNode.removeChild(this.parentNode.retryLabel),this.gameOverLabel.tl.moveTo(0,230,30,BOUNCE_EASEOUT)}}),ExLabel=Class.create(Sprite,{initialize:function(e,t,a){var o=t||640,n=a||64;Sprite.call(this,o,n),this._element=document.createElement("div"),this._element.innerHTML=e},setClassName:function(e){this._element.className=e}}),Beam=Class.create(Sprite,{initialize:function(e,t){Sprite.call(this,BEAM_SIZE,BEAM_SIZE),this._element=document.createElement("div"),this._element.className="beam",this.direction=e,this.initX=t.x,this.initY=t.y,this.x=t.x,this.y=t.y,this.currentStage=currentStage,this.parentBlock=t.parentBlock,this.beamLength=t.beamLength*BOX_SIZE,this.COLORS=COLORS},onenterframe:function(){for(var e=this.currentStage.length,t=BOX_HALF+12,a=0;e>a;a++)if(this.currentStage[a]){if(this.within(this.currentStage[a],this.currentStage[a].distance||t)&&this.currentStage[a]!==this.parentBlock&&!this.parentNode.cleared)return this.currentStage[a].run(),delete this.currentStage[a],this.currentStage.splice(a,1),GAME.currentScene.removeChild(this),void 0}else GAME.currentScene.removeChild(this);Math.abs(this.initX-this.x)<this.beamLength&&Math.abs(this.initY-this.y)<this.beamLength?(this.x+=this.direction.moveX,this.y+=this.direction.moveY):(this.opacity-=.1,0>this.opacity&&GAME.currentScene.removeChild(this))}}),Block=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=e,this.color=e,"orange"===this.color?this.image=ORANGE:"purple"===this.color&&(this.image=PURPLE),this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},run:function(){if(clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500),effectLevel>0){var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e)}var t=0;for(var a in this.beamStatus){if(DIRECTIONS[this.color][t]){var o={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this,beamLength:BEAM_LENGTH};this.parentNode.addChild(new Beam(this.beamStatus[a],o))}t++}this.parentNode.removeChild(this)}}),CountBlock=Class.create(Sprite,{initialize:function(e,t){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=e+" count",this._element.innerHTML=t,this.count=t,this.color=e,this.currentStage=currentStage,this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500);var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e);for(var t in this.beamStatus){var a={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this};this.parentNode.addChild(new Beam(this.beamStatus[t],a))}this.count>1?(this._element.innerHTML=--this.count,this.currentStage.push(this)):this.parentNode.removeChild(this)}}),Start=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="start",this.backgroundColor=COLORS.white,this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},run:function(){var e=new HitArc("white");e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e);var t=0;for(var a in this.beamStatus){if(DIRECTIONS.white[t]){var o={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,color:"white",parentBlock:this,beamLength:BEAM_LENGTH};this.parentNode.addChild(new Beam(this.beamStatus[a],o))}t++}this.parentNode.removeChild(this)}}),Goal=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="goal",this.scaleX=.8,this.scaleY=.8,this.distance=1,this.tl.scaleTo(.6,.6,30,CUBIC_EASEIN).scaleTo(.8,.8,30,CUBIC_EASEOUT).loop()},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.cleared=!0,this.parentNode.removeChild(this.parentNode.retryLabel);var e=this;this.parentNode.stars.forEach(function(t){t.run=function(){},e.parentNode.removeChild(t)}),this.tl.clear().scaleTo(30,30,30).then(function(){currentStage.forEach(function(t){e.parentNode.removeChild(t)}),e.parentNode.removeChild(BACKGROUND_ARC)}).delay(30).fadeTo(0,15).then(function(){e.parentNode.showResult(),e.parentNode.removeChild(e)})}}),Star=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this.image=WHITE_STAR,this.hited=!1},onaddedtoscene:function(){this.parentNode.stars.push(this)},run:function(){var e=this;this.hited=!0,this.tl.scaleTo(.5,.5,7).scaleTo(1,1,2).then(function(){e.tl.clear(),e.tl.delay(5).rotateBy(72,40,EXPO_EASEOUT)}),this.image=YELLOW_STAR,this.parentNode.star++}}),Diffusioner=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="diffusioner",this.image=DIFFUSIONER;var e=2*MOVE_PX;this.beamStatus={top:{moveX:0,moveY:-e},topRight:{moveX:e,moveY:-e},right:{moveX:e,moveY:0},rightDown:{moveX:e,moveY:e},down:{moveX:0,moveY:e},downLeft:{moveX:-e,moveY:e},left:{moveX:-e,moveY:0},leftTop:{moveX:-e,moveY:-e}},this.color="red"},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500);var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e);var t=0;for(var a in this.beamStatus){var o={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this,beamLength:1};this.parentNode.addChild(new Beam(this.beamStatus[a],o)),t++}this.parentNode.removeChild(this)}}),Slanter=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="slanter",this.image=SLANTER,this.rotation=45,this.beamStatus={topRight:{moveX:MOVE_PX,moveY:-MOVE_PX},rightDown:{moveX:MOVE_PX,moveY:MOVE_PX},downLeft:{moveX:-MOVE_PX,moveY:MOVE_PX},leftTop:{moveX:-MOVE_PX,moveY:-MOVE_PX}},this.color="green"},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500);var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e);var t=0;for(var a in this.beamStatus){var o={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this,beamLength:2};this.parentNode.addChild(new Beam(this.beamStatus[a],o)),t++}this.parentNode.removeChild(this)}}),Linker=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="linker",LINKER=new Surface(BOX_SIZE,BOX_SIZE);var t=LINKER.context;t.fillStyle=COLORS[e],t.strokeStyle=COLORS.white,t.lineWidth=3,t.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,t),t.fill(),t.stroke(),t.closePath(),this.image=LINKER,this.color=e,this.currentStage=currentStage},run:function(){for(var e=this.currentStage.length,t=[],a=0;e>a;a++)this.currentStage[a].color===this.color&&this!==this.currentStage[a]&&(this.currentStage[a].run(),t.push(a));for(var a=0;t>a;a++)this.currentStage.splice(t[a],1);this.parentNode.removeChild(this)}}),Pipe=Class.create(Sprite,{initialize:function(e,t){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="pipe",this.image=PIPE_COLORS[e].pipe,this.pipeStatus=t,this.color=e,this.beamStatus={up:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},onaddedtoscene:function(){this.pipeOut=new Sprite(BOX_SIZE,BOX_SIZE),this.pipeOut._element=document.createElement("div"),this.pipeOut._element.className="pipeOut "+this.pipeStatus.direction,this.pipeOut.image=PIPE_COLORS[this.color].pipeOut,this.pipeOut.x=this.pipeStatus.x*BOX_SIZE,this.pipeOut.y=this.pipeStatus.y*BOX_SIZE,this.parentNode.addChild(this.pipeOut)},onremovedfromscene:function(){GAME.currentScene.removeChild(this.pipeOut)},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500);var e=new HitArc(this.color);e.x=this.pipeOut.x-128,e.y=this.pipeOut.y-128,this.parentNode.addChild(e);var t={x:this.pipeOut.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.pipeOut.y+BOX_SIZE/2-BEAM_SIZE/2,color:"white",parentBlock:this.pipeOut,beamLength:BEAM_LENGTH};this.parentNode.addChild(new Beam(this.beamStatus[this.pipeStatus.direction],t)),GAME.currentScene.removeChild(this.pipeOut),GAME.currentScene.removeChild(this)}}),TUTORIALBEAM=[],ARROWARRAY=[],tutoSecondScene=null,gameOverLabel=new ExLabel(LANGUAGE[COUNTRYCODE].gameOver,640,100);gameOverLabel.setClassName("gameOverText"),gameOverLabel.x=0,gameOverLabel.y=-80,gameOverLabel.tl.moveTo(0,230,30,BOUNCE_EASEOUT);var thirdStartMsg=new ExLabel(LANGUAGE[COUNTRYCODE].tutoThirdStartMsg);thirdStartMsg.x=100,thirdStartMsg.y=160,thirdStartMsg.setClassName("tuto_black_msg");var TutoBlock=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=e,this.color=e,this.arccolor="start"==this.color?"white":this.color,this.arrowFlg=!0,this.lastFlg=!1,this.thirdLastFlg=!1,this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},run:function(){var e=null,t=new HitArc(this.arccolor);t.x=this.x-128,t.y=this.y-128,this.parentNode.addChild(t);var a=0;this.parentNode.removeChild(thirdStartMsg);for(var o in this.beamStatus){if(TUTODIRECTIONS[this.color][a]){var n={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,color:this.color,parentBlock:this},o=new TutoBeam(this.beamStatus[o],n);this.parentNode.addChild(o),TUTORIALBEAM.push(o)}a++}if(this.lastFlg){var r=this.parentNode;this.parentNode.tl.delay(70).then(function(){r.addChild(gameOverLabel)});var l=createLoseMsg();gameOverLabel.tl.delay(100).then(function(){r.removeChild(gameOverLabel),r.addChild(l)}),l.tl.delay(40).then(function(){l.x=160,l._element.innerHTML=LANGUAGE[COUNTRYCODE].yourMission}),l.tl.delay(100).then(function(){l._element.innerHTML=LANGUAGE[COUNTRYCODE].letsWin}),e=new Scene;var i=createTitleScene();e.backToTop=function(){GAME.replaceScene(i)};var c=createBacktoTopLabel();c.on("touchend",function(){this.parentNode.backToTop(),initTutorialScene()}),e.addChild(c),tutoCurrentStage=[],l.tl.delay(120).then(function(){var t=0;TUTOSTAGES[1].forEach(function(a){var o=StageBuilder(a);o.x=a.x*BOX_SIZE,o.y=a.y*BOX_SIZE,1==t&&(o.arrowFlg=!1),"tutoGoal"==a.name&&(o.nextEndFlg=!0),tutoCurrentStage.push(o),e.addChild(o),t++});var a=createPointerArrow();ARROWARRAY.push(a),e.addChild(a),e.addChild(thirdStartMsg),this.parentNode.removeChild(this),GAME.replaceScene(e)})}this.parentNode.removeChild(this)}}),TutoGoal=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="goal",this.backgroundColor="#F4D03F",this.color="yellow",this.scaleX=.8,this.scaleY=.8,this.arrowFlg=!0,this.nextEndFlg=!1,this.tl.scaleTo(.6,.6,30,CUBIC_EASEIN).scaleTo(.8,.8,30,CUBIC_EASEOUT).loop()},run:function(){this.tl.scaleTo(.6,.6,30,CUBIC_EASEIN).scaleTo(.8,.8,30,CUBIC_EASEOUT).unloop();var e=this;if(!(tutoCurrentStage.length>1))if(clearTimeout(this.parentNode.endTimer),this.parentNode.cleared=!0,this.nextEndFlg){var t=createEndLabel();GAME.currentScene.addChild(t),this.tl.clear().scaleTo(30,30,30).then(function(){}).delay(30).then(function(){t.setClassName("tuto_black_msg"),t._element.innerHTML=LANGUAGE[COUNTRYCODE].tutoClearMsg2}).delay(100).then(function(){t._element.innerHTML=LANGUAGE[COUNTRYCODE].tutoClearMsg3}).delay(40).then(function(){}).delay(100).then(function(){var t=createTitleScene();e.parentNode.removeChild(this),GAME.replaceScene(t),initTutorialScene()})}else{tutoSecondScene=null;var a=null,o=null;this.tl.clear().scaleTo(30,30,30).delay(30).then(function(){a=new ExLabel(LANGUAGE[COUNTRYCODE].tutoClear),a.x=120,a.y=220,a.width=500,a.height=200,a.setClassName("TutoMessaFirst"),tutorialScene.addChild(a),o=new ExLabel(LANGUAGE[COUNTRYCODE].nextLosePattern),o.x=120,o.y=220,o.width=500,o.height=200,o.setClassName("TutoMessaFirst"),e.tl.delay(60).then(function(){tutorialScene.removeChild(a),tutorialScene.addChild(o)}),tutoSecondScene=new Scene;var t=createTitleScene(),n=createBacktoTopLabel();tutoSecondScene.backToTop=function(){GAME.replaceScene(t)},tutoSecondScene.addChild(n);var r=0;tutoCurrentStage=[],TUTOSTAGES[1].forEach(function(e){var t=StageBuilder(e);t.x=e.x*BOX_SIZE,t.y=e.y*BOX_SIZE,r==TUTOSTAGES[1].length-2&&(t.lastFlg=!0),tutoSecondScene.addChild(t),tutoCurrentStage.push(t),r++});var l=createLosePatternText();tutoSecondScene.addChild(l),tutoSecondScene.loseAotamaFlg=!0,n.on("touchend",function(){tutoSecondScene.backToTop(),initTutorialScene()}),e.tl.delay(100).then(function(){tutorialScene.removeChild(e),GAME.replaceScene(tutoSecondScene),l.tl.delay(100).then(function(){tutoCurrentStage[0].run(),tutoCurrentStage.splice(0,1),tutoSecondScene.removeChild(l)})})})}}}),TutoBeam=Class.create(Sprite,{initialize:function(e,t){Sprite.call(this,BEAM_SIZE,BEAM_SIZE),this._element=document.createElement("div"),this._element.className="beam",this.backgroundColor="#F4D03F",this.direction=e,this.initX=t.x,this.initY=t.y,this.x=t.x,this.y=t.y,this.color=t.color,this.moveFlg=!0,this.makeArrowFlg=!1,this.aotamaFlg=!0,this.tutoCurrentStage=tutoCurrentStage,this.parentBlock=t.parentBlock,this.beamLength=BEAM_LENGTH*BOX_SIZE,this.COLORS=COLORS},onenterframe:function(){this.tutoCurrentStage.length,thatCurrentStage=this.tutoCurrentStage;for(var e=0;thatCurrentStage.length>e;e++)if(this.within(this.tutoCurrentStage[e],this.tutoCurrentStage[e].width-13)&&this.tutoCurrentStage[e]!==this.parentBlock){var t=this.tutoCurrentStage[e],a=e;if(!this.makeArrowFlg)if(t.arrowFlg){var o=this;this.moveFlg=!1;var n=createPointerArrow2(o.x,o.y);if(this.parentNode.addChild(n),this.parentNode.aotamaEndFlg){var r=createPrevGoalLabel();this.parentNode.addChild(r)}else if(this.parentNode.loseAotamaFlg){var l=createEndChainLabel();this.parentNode.addChild(l),this.parentNode.endChainEndFlg=!0}else{var i=createAotamaLabel();this.parentNode.addChild(i),this.parentNode.aotamaEndFlg=!0}n.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT),n.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT),n.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT).then(function(){this.parentNode.removeChild(l),this.parentNode.removeChild(r),this.parentNode.removeChild(i),this.parentNode.removeChild(n),o.parentNode.removeChild(o),t.run(),this.moveFlg=!0,o.tutoCurrentStage.splice(a,1)}),this.makeArrowFlg=!0}else this.parentNode.removeChild(o),t.run(),this.tutoCurrentStage.splice(e,1)}this.moveFlg&&(Math.abs(this.initX-this.x)<this.beamLength&&Math.abs(this.initY-this.y)<this.beamLength?(this.x+=this.direction.moveX,this.y+=this.direction.moveY):(this.opacity-=.1,0>this.opacity&&this.parentNode.removeChild(this)))}}),TutoBox=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="box",this.scene=e},ontouchend:function(){var e=new Block("white");e.x=this.x,e.y=this.y,tutoCurrentStage.push(e),this.scene.addChild(e)}}),PointerArrow=Class.create(Sprite,{initialize:function(){Sprite.call(this)},erase:function(){this.parentNode.removeChild(this)},ontouchend:function(){var e=new TutoBlock("white");e.x=448,e.y=256,tutoCurrentStage.push(e),this.scene.addChild(e),tutoCurrentStage[2].arrowFlg=!1,tutoCurrentStage[3].arrowFlg=!1,tutoCurrentStage[0].run(),tutoCurrentStage.splice(0,1),ARROWARRAY[0].erase(),ARROWARRAY.splice(0,1)}});