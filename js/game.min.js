function drawStar(e,t,a,r,n,o){var i=Math.PI,l=i/a,s=0;a*=2,i/=2,o.moveTo(e,-r+t);for(var c=1;a>c;c++)s=c*l-i,o.lineTo(n*Math.cos(s)+e,n*Math.sin(s)+t),s=++c*l-i,o.lineTo(r*Math.cos(s)+e,r*Math.sin(s)+t)}function browserLanguage(){try{return(navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2)}catch(e){return void 0}}function StageBuilder(e){switch(e.name){case"block":return new Block(e.color);case"start":return new Start;case"goal":return new Goal;case"star":return new Star;case"count":return new CountBlock(e.color,e.count);case"diffusioner":return new Diffusioner;case"slanter":return new Slanter;case"pipe":return new Pipe(e.color,e.pipeStatus);case"linker":return new Linker(e.color);case"tutoGoal":return new TutoGoal;case"tutoBlock":return new TutoBlock(e.color)}}function initTutorialScene(){tutorialScene=createTutorialScene()}function createPointerArrow1(){var e=new Sprite;return e.x=65,e.y=290,e._element=document.createElement("div"),e._element.className="pointerArrow",e.width=30,e.rotate(300),e}function createBacktoTopLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].backToTop,3*BOX_SIZE,BOX_SIZE);return e.setClassName("backToTopText"),e.x=32,e.y=544,e}function createStartTutorialLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].startTutorial);return e.setClassName("tuto_white_msg"),e.x=90,e.y=170,e}function createSirotamaLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].sirotama);return e.setClassName("tuto_white_msg"),e.x=90,e.y=170,e}function createLoseMsg(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].loseMsg);return e.x=200,e.y=200,e.setClassName("tuto_black_msg"),e}function createTitleLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].title);return e.setClassName("titleText"),e.y=140,e}function createTouchStartLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].touchStart,640,60);return e.setClassName("touchStart"),e.x=0,e.y=400,e}function createGameStartLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].gameStart,320,60);return e.setClassName("gameStart"),e.x=160,e.y=360,e}function createTutorialLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].howToPlay,320,60);return e.setClassName("tutorial"),e.x=160,e.y=440,e}function createOptionMenuButton(){var e=new Sprite(BOX_SIZE,BOX_SIZE);return e._element=document.createElement("div"),e._element.className="optionMenuButton",e.x=8.5*BOX_SIZE,e.y=8.5*BOX_SIZE,e.menuOpen=!1,e}function createOptionMenu(){function e(e){for(var t=0;3>t;t++)s[t].quality===e?s[t].setClassName("effectSwitch optionLayer active"):s[t].setClassName("effectSwitch optionLayer")}var t=new Group;t._element=document.createElement("div"),t._element.className="optionMenu";var a=new Sprite(640,640);a._element=document.createElement("div"),a._element.className="optionBackground optionLayer",t.addChild(a);var r=new ExLabel("Option");r.setClassName("optionLayer"),r.y=20,t.addChild(r);var n=new ExLabel(LANGUAGE[COUNTRYCODE].optionTitle);n.setClassName("optionLayer effectLabel"),n.y=120,t.addChild(n);var o=new ExLabel('<button id="low">'+LANGUAGE[COUNTRYCODE].optionEffect[0]+"</button>",160);o.setClassName("effectSwitch optionLayer"),o.quality="low",o.x=80,o.y=172,o.on("touchend",function(){e(this.quality),effectLevel=0}),t.addChild(o);var i=new ExLabel('<button id="med">'+LANGUAGE[COUNTRYCODE].optionEffect[1]+"</button>",160);i.setClassName("effectSwitch optionLayer active"),i.quality="med",i.x=240,i.y=172,i.on("touchend",function(){e(this.quality),effectLevel=1}),t.addChild(i);var l=new ExLabel('<button id="high">'+LANGUAGE[COUNTRYCODE].optionEffect[2]+"</button>",160);l.setClassName("effectSwitch optionLayer"),l.quality="high",l.x=400,l.y=172,l.on("touchend",function(){e(this.quality),effectLevel=2}),t.addChild(l);var s=[o,i,l],c=new ExLabel(LANGUAGE[COUNTRYCODE].volumeOption);c.setClassName("optionLayer effectLabel"),c.y=264,t.addChild(c);var h=new VolumeSlider;t.addChild(h);var m=new ExLabel('<button id="deleteButton" class="btn-long">'+LANGUAGE[COUNTRYCODE].optionDeleteData+"</button>");m.setClassName("deleteData optionLayer"),m.y=365,m.on("touchend",function(){window.confirm(LANGUAGE[COUNTRYCODE].optionDeleteConf)&&(localStorage.clear(),alert(LANGUAGE[COUNTRYCODE].optionDeleteComp))}),t.addChild(m);var u=new ExLabel('<button id="allStage" class="btn-long">'+LANGUAGE[COUNTRYCODE].optionAllStage+"</button>");return u.setClassName("openAllStage optionLayer"),u.on("touchend",function(){for(var e=[],t=0;STAGES.length>t;t++)e.push(0);localStorage.setItem("hal",JSON.stringify(e)),alert(LANGUAGE[COUNTRYCODE].optionAllStageUnlock)}),u.y=460,t.addChild(u),t}function createPlayerStatus(e){for(var t=0,a=0;e.length>a;a++)t+=e[a];var r=new Group;r._element=document.createElement("div"),r.x=480,r.y=544;var n=new ExLabel(" × "+t,2*BOX_SIZE,BOX_SIZE);n.setClassName("playerStars"),r.addChild(n);var o=new Sprite(BOX_SIZE,BOX_SIZE);return o.image=YELLOW_STAR,o.scale(.8,.8),r.addChild(o),r}function createRetryLabelOnGame(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].gameRetry,3*BOX_SIZE,BOX_SIZE);return e.setClassName("retryLabelOnGame"),e.x=416,e.y=544,e}function createPointerArrow(){var e=new PointerArrow;return e.x=428,e.y=276,e._element=document.createElement("div"),e._element.className="pointerArrow",e.width=30,e.rotate(300),e.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT).loop(),e}function createEndLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].tutoClearMsg);return e.x=100,e.y=150,e.setClassName("tuto_clear_msg"),e}function createLosePatternText(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].losePattern);return e.x=180,e.y=200,e.setClassName("msg"),e}function createPointerArrow2(e,t){var a=new Sprite;return a.x=e-30,a.y=t+30,a._element=document.createElement("div"),a._element.className="pointerArrow",a.width=30,a.rotate(300),a}function createPrevGoalLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].prevGoal);return e.setClassName("tuto_white_msg"),e.x=120,e.y=170,e}function createEndChainLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].endChain);return e.setClassName("tuto_black_msg"),e.x=110,e.y=170,e}function createAotamaLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].aotama);return e.setClassName("tuto_black_msg"),e.x=110,e.y=170,e}function createSurfaces(){WHITE_STAR=new Surface(BOX_SIZE,BOX_SIZE);var e=WHITE_STAR.context;e.beginPath(),e.fillStyle=COLORS.white,e.strokeStyle=COLORS.yellow,e.lineWidth=2,drawStar(BOX_SIZE/2,BOX_SIZE/2,5,BOX_SIZE/2,BOX_SIZE/3,e),e.closePath(),e.fill(),e.stroke(),YELLOW_STAR=new Surface(BOX_SIZE,BOX_SIZE);var t=YELLOW_STAR.context;t.beginPath(),t.fillStyle=COLORS.yellow,drawStar(BOX_SIZE/2,BOX_SIZE/2,5,BOX_SIZE/2,BOX_SIZE/3,t),t.closePath(),t.fill(),SCORE_STARS[0]=new Surface(2*BOX_SIZE,2*BOX_SIZE),SCORE_STARS[1]=new Surface(2*BOX_SIZE,2*BOX_SIZE);var a=SCORE_STARS[1].context;a.beginPath(),a.fillStyle=COLORS.yellow,a.strokeStyle=COLORS.white,a.lineWidth=3,drawStar(BOX_SIZE,1.6*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,a),a.closePath(),a.fill(),a.stroke(),SCORE_STARS[2]=new Surface(2*BOX_SIZE,2*BOX_SIZE);var r=SCORE_STARS[2].context;r.fillStyle=COLORS.yellow,r.strokeStyle=COLORS.white,r.lineWidth=3,r.beginPath(),drawStar(.5*BOX_SIZE,1.5*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,r),r.fill(),r.stroke(),r.closePath(),r.beginPath(),drawStar(1.5*BOX_SIZE,1.5*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,r),r.fill(),r.stroke(),r.closePath(),SCORE_STARS[3]=new Surface(2*BOX_SIZE,2*BOX_SIZE);var n=SCORE_STARS[3].context;n.fillStyle=COLORS.yellow,n.strokeStyle=COLORS.white,n.lineWidth=3,n.beginPath(),drawStar(1.5*BOX_SIZE,1.6*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,n),n.fill(),n.stroke(),n.closePath(),n.beginPath(),drawStar(.5*BOX_SIZE,1.6*BOX_SIZE,5,BOX_SIZE/3,BOX_SIZE/4.5,n),n.fill(),n.stroke(),n.closePath(),n.beginPath(),drawStar(BOX_SIZE,1.5*BOX_SIZE,5,BOX_SIZE/2,BOX_SIZE/3,n),n.fill(),n.stroke(),n.closePath(),ORANGE=new Surface(BOX_SIZE,BOX_SIZE);var o=ORANGE.context;o.fillStyle=COLORS.orange,o.strokeStyle=COLORS.yellow,o.lineWidth=3,o.beginPath(),o.moveTo(BOX_HALF,0),o.lineTo(BOX_SIZE,BOX_HALF),o.lineTo(BOX_HALF,BOX_SIZE),o.lineTo(0,BOX_HALF),o.lineTo(BOX_HALF,0),o.fill(),o.stroke(),o.closePath(),o.beginPath(),o.fillStyle=COLORS.yellow,o.strokeStyle=COLORS.orange,o.moveTo(BOX_HALF,0),o.lineTo(1.5*BOX_HALF,.5*BOX_HALF),o.lineTo(BOX_HALF+6,.5*BOX_HALF),o.lineTo(BOX_HALF+6,1.5*BOX_HALF),o.lineTo(1.5*BOX_HALF,1.5*BOX_HALF),o.lineTo(BOX_HALF,BOX_SIZE),o.lineTo(.5*BOX_HALF,1.5*BOX_HALF),o.lineTo(BOX_HALF-6,1.5*BOX_HALF),o.lineTo(BOX_HALF-6,.5*BOX_HALF),o.lineTo(.5*BOX_HALF,.5*BOX_HALF),o.lineTo(BOX_HALF,0),o.fill(),o.stroke(),o.closePath(),PURPLE=new Surface(BOX_SIZE,BOX_SIZE);var i=PURPLE.context;i.fillStyle=COLORS.purple,i.strokeStyle=COLORS.yellow,i.lineWidth=3,i.beginPath(),i.moveTo(BOX_HALF,0),i.lineTo(BOX_SIZE,BOX_HALF),i.lineTo(BOX_HALF,BOX_SIZE),i.lineTo(0,BOX_HALF),i.lineTo(BOX_HALF,0),i.fill(),i.stroke(),i.closePath(),i.beginPath(),i.fillStyle=COLORS.yellow,i.strokeStyle=COLORS.purple,i.moveTo(0,BOX_HALF),i.lineTo(.5*BOX_HALF,1.5*BOX_HALF),i.lineTo(.5*BOX_HALF,BOX_HALF+6),i.lineTo(1.5*BOX_HALF,BOX_HALF+6),i.lineTo(1.5*BOX_HALF,1.5*BOX_HALF),i.lineTo(BOX_SIZE,BOX_HALF),i.lineTo(1.5*BOX_HALF,.5*BOX_HALF),i.lineTo(1.5*BOX_HALF,BOX_HALF-6),i.lineTo(.5*BOX_HALF,BOX_HALF-6),i.lineTo(.5*BOX_HALF,.5*BOX_HALF),i.lineTo(0,BOX_HALF),i.fill(),i.stroke(),i.closePath(),DIFFUSIONER=new Surface(BOX_SIZE,BOX_SIZE);var l=DIFFUSIONER.context;l.fillStyle=COLORS.red,l.strokeStyle=COLORS.yellow,l.lineWidth=3,l.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,8,BOX_SIZE/2,BOX_SIZE/3,l),l.fill(),l.stroke(),l.closePath(),SLANTER=new Surface(BOX_SIZE,BOX_SIZE);var s=SLANTER.context;s.fillStyle=COLORS.green,s.strokeStyle=COLORS.yellow,s.lineWidth=3,s.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,4,BOX_SIZE/2,BOX_SIZE/4,s),s.fill(),s.stroke(),s.closePath(),PIPE_RED=new Surface(BOX_SIZE,BOX_SIZE);var c=PIPE_RED.context;c.fillStyle=COLORS.red,c.strokeStyle=COLORS.yellow,c.lineWidth=3,c.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,c),c.fill(),c.stroke(),c.closePath(),PIPE_RED_OUT=new Surface(BOX_SIZE,BOX_SIZE);var h=PIPE_RED_OUT.context;h.fillStyle=COLORS.red,h.strokeStyle=COLORS.yellow,h.lineWidth=3,h.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,h),h.fill(),h.stroke(),h.closePath(),PIPE_GREEN=new Surface(BOX_SIZE,BOX_SIZE);var m=PIPE_GREEN.context;m.fillStyle=COLORS.green,m.strokeStyle=COLORS.yellow,m.lineWidth=3,m.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,m),m.fill(),m.stroke(),m.closePath(),PIPE_GREEN_OUT=new Surface(BOX_SIZE,BOX_SIZE);var u=PIPE_GREEN_OUT.context;u.fillStyle=COLORS.green,u.strokeStyle=COLORS.yellow,u.lineWidth=3,u.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,u),u.fill(),u.stroke(),u.closePath(),PIPE_BLUE=new Surface(BOX_SIZE,BOX_SIZE);var d=PIPE_BLUE.context;d.fillStyle=COLORS.blue,d.strokeStyle=COLORS.yellow,d.lineWidth=3,d.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,d),d.fill(),d.stroke(),d.closePath(),PIPE_BLUE_OUT=new Surface(BOX_SIZE,BOX_SIZE);var p=PIPE_BLUE_OUT.context;p.fillStyle=COLORS.blue,p.strokeStyle=COLORS.yellow,p.lineWidth=3,p.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,p),p.fill(),p.stroke(),p.closePath(),PIPE_PURPLE=new Surface(BOX_SIZE,BOX_SIZE);var y=PIPE_PURPLE.context;y.fillStyle=COLORS.purple,y.strokeStyle=COLORS.yellow,y.lineWidth=3,y.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,y),y.fill(),y.stroke(),y.closePath(),PIPE_PURPLE_OUT=new Surface(BOX_SIZE,BOX_SIZE);var S=PIPE_PURPLE_OUT.context;S.fillStyle=COLORS.purple,S.strokeStyle=COLORS.yellow,S.lineWidth=3,S.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,S),S.fill(),S.stroke(),S.closePath(),PIPE_ORANGE=new Surface(BOX_SIZE,BOX_SIZE);var x=PIPE_ORANGE.context;x.fillStyle=COLORS.purple,x.strokeStyle=COLORS.yellow,x.lineWidth=3,x.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/2,BOX_SIZE/2,x),x.fill(),x.stroke(),x.closePath(),PIPE_ORANGE_OUT=new Surface(BOX_SIZE,BOX_SIZE);var E=PIPE_ORANGE_OUT.context;E.fillStyle=COLORS.purple,E.strokeStyle=COLORS.yellow,E.lineWidth=3,E.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,E),E.fill(),E.stroke(),E.closePath(),PIPE_COLORS={red:{pipe:PIPE_RED,pipeOut:PIPE_RED_OUT},green:{pipe:PIPE_GREEN,pipeOut:PIPE_GREEN_OUT},blue:{pipe:PIPE_BLUE,pipeOut:PIPE_BLUE_OUT},purple:{pipe:PIPE_PURPLE,pipeOut:PIPE_PURPLE_OUT},orange:{pipe:PIPE_ORANGE,pipeOut:PIPE_ORANGE_OUT}}}function createStageEditLabel(){var e=new ExLabel(LANGUAGE[COUNTRYCODE].stageEdit,320,60);return e.setClassName("stageEdit"),e.x=160,e.y=520,e}function createTutorialScene(){tutorialScene=new Scene;var e=createPointerArrow1(),t=createStartTutorialLabel();tutorialScene.addChild(t);var a=createSirotamaLabel();t.tl.delay(80).then(function(){tutorialScene.removeChild(t),tutorialScene.addChild(a),tutorialScene.addChild(e)}),tutorialScene.aotamaEndFlg=!1,tutoCurrentStage=[],TUTOSTAGES[0].forEach(function(e){var t=StageBuilder(e);t.x=e.x*BOX_SIZE,t.y=e.y*BOX_SIZE,tutoCurrentStage.push(t),tutorialScene.addChild(t)}),e.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT),e.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT),e.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT).then(function(){tutoCurrentStage[0].run(0),tutoCurrentStage.splice(0,1),tutorialScene.removeChild(a),tutorialScene.removeChild(e)});var r=createBacktoTopLabel();return tutorialScene.addChild(r),r.on("touchend",function(){var e=createTitleScene();GAME.replaceScene(e),initTutorialScene()}),tutorialScene}function createStageScene(){stageScene=new Scene,stageScene.initStage=function(){var e=this;this.star=0,this.canTap=!0,clearTimeout(this.endTimer),this.endTimer=null,this.cleared=!1,this.removeChild(this.retryLabel);for(var t=0;currentStage.length>t;t++)this.removeChild(currentStage[t]),delete currentStage[t];if(currentStage=[],this.stars)for(var t=0;this.stars.length>t;t++)this.removeChild(this.stars[t]),delete this.stars[t];this.stars=[];var a=new Timer;stageScene.addChild(a),STAGES[LEVEL].forEach(function(t){var a=StageBuilder(t);a.x=t.x*BOX_SIZE,a.y=t.y*BOX_SIZE,currentStage.push(a),e.addChild(a)})},stageScene.showResult=function(){var e=new Result;this.addChild(e),clearTimeout(this.endTimer),(userData[LEVEL]===void 0||userData[LEVEL]<this.star)&&(userData[LEVEL]=this.star),localStorage.setItem("hal",JSON.stringify(userData))},stageScene.gameOver=function(){var e=new GameOver;stageScene.removeChild(stageScene.retryLabel),this.addChild(e)};for(var e=0;10>e;e++)for(var t=0;10>t;t++){var a=new Box;a.x=e*BOX_SIZE,a.y=t*BOX_SIZE,stageScene.addChild(a)}return stageScene}function createTitleScene(){function e(){document[n]?clearInterval(t.loopTimer):GAME.currentScene===t&&r.startAnim()}var t=new Scene,a=createTitleLabel();t.addChild(a),t.on("enter",function(){r.startAnim()}),t.on("exit",function(){clearInterval(t.loopTimer)}),t.on("touchend",function(){t.removeChild(i),t.addChild(l),t.addChild(s),t.addChild(m),t.addChild(h)});var r=new TitleBackAnim;t.addChild(r);var n,o;document.hidden!==void 0?(n="hidden",o="visibilitychange"):document.mozHidden!==void 0?(n="mozHidden",o="mozvisibilitychange"):document.msHidden!==void 0?(n="msHidden",o="msvisibilitychange"):document.webkitHidden!==void 0&&(n="webkitHidden",o="webkitvisibilitychange"),void 0!==document.addEventListener&&void 0!==n&&document.addEventListener(o,e,!1);var i=createTouchStartLabel();i.on("addedtoscene",function(){this.tl.fadeTo(0,30).fadeTo(1,30).loop()}),t.addChild(i);var l=createGameStartLabel();l.on("touchend",function(){GAME.replaceScene(d)});var s=createTutorialLabel();s.on("touchend",function(){GAME.replaceScene(tutorialScene)});var c=createStageEditScene(),h=createStageEditLabel();h.on("touchend",function(){GAME.replaceScene(c)});var m=createOptionMenuButton(),u=createOptionMenu();m.on("touchend",function(){if(this.menuOpen){try{t.removeChild(u)}catch(e){}this.menuOpen=!1}else t.addChild(u),this.menuOpen=!0});var d=createSelectScene();return d.backToTop=function(){d.initSelect(),GAME.replaceScene(t)},t}function createSelectScene(){var e=new Scene;e.on("touchstart",function(t){e.startY=t.y}),e.on("touchmove",function(t){stageGroup.moveBy(0,t.y-e.startY),e.startY=t.y}),e.on("touchend",function(){var e=-160*Math.floor(stageGroup.childNodes.length/4)+320;stageGroup.y>0?stageGroup.tl.moveTo(0,0,10,SIN_EASEOUT):e>stageGroup.y&&stageGroup.tl.moveTo(0,e,10,SIN_EASEOUT)}),e.on("enter",function(){userData=JSON.parse(localStorage.getItem("hal")),null===userData&&(userData=[]),stageGroup=new StageGroup,e.addChild(stageGroup);for(var t=1.5,a=0,r=0,n=0,o=1.5;STAGES.length>r;r++){var i=0,l=!0,s="stageBox lock";userData.length>r?(i=userData[r],s="stageBox",l=!1):userData.length===r&&(s="stageBox nextStage",l=!1);var c=new StageBox(r,i,l);c._element.className=s,c.x=BOX_SIZE/4+2.5*n*BOX_SIZE,c.y=1.25*o*BOX_SIZE,stageGroup.addChild(c),stageBoxes.push(c),n++,4===n&&(n=0),3===r%4&&(o+=2),a=n,t=o}var h=new ExLabel("STAGE SELECT",640,110);h.setClassName("stageSelectText"),e.addChild(h)}),e.selectedStage=function(e){LEVEL=e,GAME.replaceScene(t),t.initStage()},e.initSelect=function(){for(var e=stageBoxes.length,t=0;e>t;t++)stageGroup.removeChild(stageBoxes[t]);stageBoxes=[]};var t=createStageScene();return t.stageSelect=function(){for(var t=stageBoxes.length,a=0;t>a;a++)stageGroup.removeChild(stageBoxes[a]);stageBoxes=[],GAME.replaceScene(e)},t.retryLabel=createRetryLabelOnGame(),t.retryLabel.on("touchstart",function(){clearTimeout(t.endTimer),e.selectedStage(LEVEL)}),e}function createStageEditScene(){var e=new Scene;boxManager=new BoxManager;for(var t=0;currentStage.length>t;t++)this.removeChild(currentStage[t]),delete currentStage[t];for(var a=0;10>a;a++)for(var r=0;10>r;r++){var n=new EditBox(a,r);n.x=a*BOX_SIZE,n.y=r*BOX_SIZE,e.addChild(n),boxManager.boxArray[a][r]=n}creater=new Creater("blue"),pipeManager=new PipeManager,createSurfaces();var o=new BlockInk("blue");o.x=10,o.y=670,e.addChild(o);var i=new BlockInk("red");i.x=90,i.y=670,e.addChild(i);var l=new BlockInk("green");l.x=170,l.y=670,e.addChild(l);var s=new BlockInk("orange");s.x=250,s.y=670,e.addChild(s);var c=new BlockInk("purple");c.x=330,c.y=670,e.addChild(c);var h=new BlockInk("start");h.x=170,h.y=750,e.addChild(h);var m=new SlanterInk("green");m.x=250,m.y=750,e.addChild(m);var u=new DiffusionerInk;u.x=330,u.y=750,e.addChild(u);var d=new PipeInk("blue");d.x=410,d.y=670,pipeManager.pipeInk=d,e.addChild(d);var p=new GoalInk;p.x=10,p.y=750,e.addChild(p);var y=new StarInk;y.x=90,y.y=750,e.addChild(y);var S=new SendButton(LANGUAGE[COUNTRYCODE].post,54,64);S.x=495,S.y=670,S.setClassName("edit_button"),e.addChild(S);var x=new TestPlayButton(LANGUAGE[COUNTRYCODE].testplay);x.x=567,x.y=670,x.setClassName("edit_button"),e.addChild(x);var E=new RestoreButton(LANGUAGE[COUNTRYCODE].restore);E.x=410,E.y=750,E.setClassName("edit_button"),e.addChild(E);var g=new EraserInk(LANGUAGE[COUNTRYCODE].eraser);return g.x=490,g.y=750,g.width=80,g.setClassName("edit_button"),e.addChild(g),e}function playSound(e){"safari"==enchant.ENV.BROWSER||"mobilesafari"==enchant.ENV.BROWSER?(GAME.assets["sound/"+e+".mp3"].volume=VOLUME,GAME.assets["sound/"+e+".mp3"].clone().play()):(AUDIO_LIST[e].volume=VOLUME,AUDIO_LIST[e].play(),AUDIO_LIST[e]=new Audio(AUDIO_LIST[e].src))}function makeJSON(e){JSON.stringify(e);var t=[],a={x:creater.startPos.x,y:creater.startPos.y,name:"start"};t[0]=a;for(var r={},n={},o={},i=0;10>i;i++)for(var l=0;10>l;l++)if(e[i][l]&&"start"!=e[i][l])if("pipe"==e[i][l].name){var s=pipeManager.pipeEntity,c=e[i][l].color;n={x:s[c].parent.x,y:s[c].parent.y,color:c},o={x:s[c].child.x,y:s[c].child.y,direction:s[c].child.direction};var h={x:n.x,y:n.y,name:"pipe",color:c,pipeStatus:{x:o.x,y:o.y,direction:o.direction}};t.push(h)}else r={x:i,y:l,name:e[i][l]},t.push(r)}function doPost(){var e=document.createElement("input");e.setAttribute("type","hidden")}var GAME,MOVE_PX=4,BOX_SIZE=64,BOX_HALF=BOX_SIZE/2,BEAM_SIZE=32,BEAM_LENGTH=3,LOW_SPECTRUM=MOVE_PX,HIGH_SPECTRUM=24,LEVEL=0,AUDIO_LIST={start:new Audio("sound/start.mp3"),white:new Audio("sound/white.mp3"),goal:new Audio("sound/goal.mp3"),orange:new Audio("sound/orange.mp3"),purple:new Audio("sound/purple.mp3"),green:new Audio("sound/green.mp3"),red:new Audio("sound/red.mp3"),slanter:new Audio("sound/slanter.mp3"),pipe:new Audio("sound/pipe.mp3"),blue:new Audio("sound/blue.mp3"),star:new Audio("sound/star.mp3"),diffusioner:new Audio("sound/diffusioner.mp3")},DIRECTIONS={black:[!0,!0,!0,!0],white:[!0,!0,!0,!0],red:[!0,!0,!0,!0],green:[!0,!0,!0,!0],blue:[!0,!0,!0,!0],orange:[!0,!1,!0,!1],purple:[!1,!0,!1,!0]},TUTODIRECTIONS={start:[!0,!0,!0,!0],black:[!0,!0,!0,!0],white:[!0,!0,!0,!0],red:[!0,!0,!0,!0],green:[!0,!0,!0,!0],blue:[!0,!0,!0,!0],orange:[!0,!1,!0,!1],purple:[!1,!0,!1,!0]},COLORS={black:"#555555",white:"#ecf0f1",blue:"#38B5FE",green:"#36D7B7",red:"#ff6666",purple:"#BF77EC",yellow:"#F4D03F",orange:"#FFA533",pink:"#FFCCFF",pureWhite:"#fff"},BACKGROUND_ARC=null,WHITE_STAR=null,YELLOW_STAR=null,SCORE_STARS=[],DIFFUSIONER=null,SLANTER=null,LINKER=null,ORANGE=null,PURPLE=null,PIPE_RED=null,PIPE_GREEN=null,PIPE_BLUE=null,PIPE_PURPLE=null,PIPE_ORANGE=null,PIPE_RED_OUT=null,PIPE_GREEN_OUT=null,PIPE_BLUE_OUT=null,PIPE_PURPLE_OUT=null,PIPE_ORANGE_OUT=null,PIPE_COLORS=null,currentStage=[],STAGES=[[{x:0,y:4,name:"start"},{x:3,y:4,name:"block",color:"red"},{x:3,y:2,name:"star"},{x:3,y:6,name:"star"},{x:6,y:2,name:"star"},{x:9,y:4,name:"goal"}],[{x:3,y:1,name:"start"},{x:3,y:4,name:"block",color:"green"},{x:0,y:4,name:"star"},{x:3,y:7,name:"star"},{x:6,y:2,name:"star"},{x:9,y:4,name:"goal"}],[{x:0,y:4,name:"start"},{x:3,y:4,name:"block",color:"red"},{x:6,y:4,name:"block",color:"blue"},{x:3,y:2,name:"star"},{x:6,y:2,name:"star"},{x:8,y:2,name:"star"},{x:8,y:7,name:"goal"}],[{x:0,y:1,name:"start"},{x:0,y:4,name:"block",color:"red"},{x:3,y:4,name:"block",color:"blue"},{x:6,y:1,name:"star"},{x:6,y:7,name:"star"},{x:9,y:2,name:"star"},{x:9,y:4,name:"block",color:"red"},{x:9,y:7,name:"goal"}],[{x:0,y:1,name:"start"},{x:3,y:1,name:"block",color:"red"},{x:3,y:4,name:"block",color:"blue"},{x:6,y:4,name:"block",color:"green"},{x:9,y:7,name:"block",color:"green"},{x:4,y:1,name:"star"},{x:6,y:9,name:"star"},{x:3,y:5,name:"star"},{x:9,y:9,name:"goal"}],[{x:0,y:4,name:"start"},{x:2,y:4,name:"block",color:"purple"},{x:5,y:4,name:"block",color:"purple"},{x:6,y:7,name:"block",color:"purple"},{x:9,y:4,name:"star"},{x:6,y:1,name:"star"},{x:3,y:7,name:"star"},{x:9,y:7,name:"goal"}],[{x:0,y:4,name:"start"},{x:9,y:3,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"red"},{x:6,y:2,name:"star"},{x:3,y:3,name:"star"},{x:3,y:4,name:"block",color:"purple"},{x:6,y:4,name:"block",color:"purple"},{x:9,y:5,name:"block",color:"purple"},{x:6,y:5,name:"block",color:"blue"},{x:6,y:6,name:"star"},{x:3,y:5,name:"goal"}],[{x:0,y:4,name:"start"},{x:9,y:1,name:"block",color:"blue"},{x:6,y:1,name:"star"},{x:9,y:0,name:"star"},{x:3,y:4,name:"block",color:"purple"},{x:6,y:4,name:"block",color:"purple"},{x:6,y:7,name:"block",color:"purple"},{x:9,y:7,name:"block",color:"red"},{x:9,y:9,name:"star"},{x:3,y:7,name:"goal"}],[{x:0,y:1,name:"start"},{x:3,y:1,name:"block",color:"purple"},{x:9,y:1,name:"star"},{x:9,y:7,name:"star"},{x:3,y:4,name:"block",color:"blue"},{x:9,y:4,name:"block",color:"red"},{x:3,y:7,name:"block",color:"green"},{x:6,y:4,name:"block",color:"purple"},{x:6,y:7,name:"star"},{x:0,y:7,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"orange"},{x:3,y:6,name:"block",color:"orange"},{x:6,y:3,name:"block",color:"orange"},{x:3,y:0,name:"star"},{x:0,y:3,name:"star"},{x:6,y:0,name:"star"},{x:6,y:6,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"purple"},{x:0,y:3,name:"star"},{x:9,y:6,name:"star"},{x:6,y:9,name:"block",color:"blue"},{x:3,y:6,name:"block",color:"red"},{x:6,y:6,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"green"},{x:3,y:3,name:"block",color:"purple"},{x:3,y:0,name:"star"},{x:9,y:0,name:"goal"}],[{x:2,y:4,name:"start"},{x:3,y:5,name:"block",color:"purple"},{x:4,y:4,name:"block",color:"purple"},{x:6,y:2,name:"block",color:"purple"},{x:6,y:6,name:"block",color:"purple"},{x:3,y:2,name:"block",color:"orange"},{x:5,y:5,name:"block",color:"orange"},{x:7,y:4,name:"block",color:"orange"},{x:7,y:2,name:"star"},{x:4,y:6,name:"star"},{x:0,y:5,name:"star"},{x:5,y:3,name:"goal"}],[{x:0,y:3,name:"start"},{x:5,y:0,name:"star"},{x:9,y:2,name:"star"},{x:3,y:3,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"purple"},{x:9,y:3,name:"block",color:"red"},{x:5,y:6,name:"block",color:"blue"},{x:3,y:6,name:"block",color:"purple"},{x:9,y:4,name:"star"},{x:1,y:6,name:"goal"}],[{x:1,y:3,name:"start"},{x:0,y:4,name:"star"},{x:5,y:1,name:"block",color:"red"},{x:7,y:1,name:"star"},{x:3,y:3,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"purple"},{x:8,y:3,name:"block",color:"red"},{x:5,y:6,name:"block",color:"blue"},{x:3,y:6,name:"block",color:"purple"},{x:0,y:6,name:"block",color:"green"},{x:8,y:9,name:"star"},{x:5,y:9,name:"block",color:"purple"},{x:0,y:9,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"blue"},{x:6,y:9,name:"block",color:"orange"},{x:6,y:6,name:"block",color:"red"},{x:9,y:6,name:"block",color:"orange"},{x:9,y:3,name:"block",color:"orange"},{x:3,y:6,name:"star"},{x:3,y:3,name:"star"},{x:6,y:0,name:"star"},{x:9,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:3,y:0,name:"block",color:"purple"},{x:6,y:0,name:"block",color:"purple"},{x:9,y:0,name:"block",color:"red"},{x:4,y:3,name:"star"},{x:0,y:3,name:"block",color:"blue"},{x:5,y:3,name:"star"},{x:3,y:3,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"purple"},{x:9,y:6,name:"block",color:"green"},{x:0,y:6,name:"block",color:"green"},{x:3,y:6,name:"star"},{x:6,y:6,name:"goal"}],[{x:0,y:4,name:"start"},{x:2,y:4,name:"block",color:"green"},{x:5,y:4,name:"block",color:"green"},{x:5,y:2,name:"block",color:"red"},{x:5,y:6,name:"block",color:"blue"},{x:2,y:1,name:"block",color:"purple"},{x:2,y:7,name:"block",color:"purple"},{x:4,y:7,name:"block",color:"red"},{x:4,y:1,name:"block",color:"blue"},{x:8,y:3,name:"block",color:"purple"},{x:8,y:5,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"blue"},{x:6,y:5,name:"block",color:"red"},{x:3,y:2,name:"star"},{x:3,y:6,name:"star"},{x:3,y:3,name:"star"},{x:3,y:5,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:0,name:"block",color:"purple"},{x:6,y:0,name:"block",color:"purple"},{x:9,y:0,name:"block",color:"purple"},{x:9,y:3,name:"block",color:"blue"},{x:4,y:0,name:"block",color:"blue"},{x:5,y:0,name:"star"},{x:6,y:3,name:"block",color:"purple"},{x:3,y:3,name:"block",color:"purple"},{x:0,y:3,name:"block",color:"purple"},{x:0,y:6,name:"block",color:"red"},{x:3,y:6,name:"block",color:"purple"},{x:4,y:6,name:"star"},{x:5,y:6,name:"star"},{x:6,y:6,name:"block",color:"purple"},{x:9,y:6,name:"block",color:"purple"},{x:9,y:9,name:"block",color:"green"},{x:6,y:9,name:"block",color:"purple"},{x:3,y:9,name:"block",color:"purple"},{x:0,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:0,y:3,name:"block",color:"orange"},{x:0,y:6,name:"block",color:"orange"},{x:0,y:9,name:"block",color:"purple"},{x:3,y:9,name:"block",color:"red"},{x:9,y:6,name:"block",color:"blue"},{x:9,y:9,name:"block",color:"orange"},{x:3,y:6,name:"block",color:"orange"},{x:3,y:3,name:"block",color:"orange"},{x:3,y:1,name:"block",color:"purple"},{x:6,y:1,name:"block",color:"orange"},{x:6,y:3,name:"block",color:"orange"},{x:9,y:1,name:"block",color:"purple"},{x:6,y:8,name:"star"},{x:6,y:0,name:"star"},{x:8,y:6,name:"star"},{x:9,y:3,name:"goal"}],[{x:0,y:4,name:"start"},{x:3,y:4,name:"block",color:"purple"},{x:6,y:4,name:"block",color:"orange"},{x:6,y:1,name:"block",color:"purple"},{x:6,y:7,name:"block",color:"purple"},{x:9,y:1,name:"block",color:"purple"},{x:3,y:7,name:"block",color:"red"},{x:9,y:7,name:"block",color:"orange"},{x:7,y:3,name:"block",color:"blue"},{x:3,y:9,name:"star"},{x:3,y:1,name:"star"},{x:5,y:3,name:"star"},{x:9,y:3,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"blue"},{x:6,y:9,name:"block",color:"orange"},{x:6,y:6,name:"block",color:"red"},{x:9,y:6,name:"block",color:"orange"},{x:9,y:3,name:"block",color:"orange"},{x:0,y:2,name:"block",color:"orange"},{x:9,y:0,name:"block",color:"purple"},{x:3,y:3,name:"block",color:"purple"},{x:3,y:4,name:"block",color:"red"},{x:0,y:3,name:"block",color:"green"},{x:6,y:0,name:"block",color:"blue"},{x:4,y:0,name:"block",color:"purple"},{x:3,y:5,name:"star"},{x:9,y:9,name:"star"},{x:6,y:2,name:"star"},{x:0,y:0,name:"goal"}],[{x:0,y:9,name:"start"},{x:0,y:6,name:"block",color:"purple"},{x:3,y:6,name:"block",color:"orange"},{x:3,y:3,name:"block",color:"purple"},{x:2,y:8,name:"block",color:"blue"},{x:6,y:0,name:"block",color:"purple"},{x:5,y:5,name:"block",color:"blue"},{x:5,y:8,name:"star"},{x:6,y:7,name:"star"},{x:8,y:5,name:"star"},{x:6,y:3,name:"block",color:"orange"},{x:9,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:3,y:0,name:"block",color:"purple"},{x:6,y:0,name:"block",color:"red"},{x:6,y:3,name:"block",color:"purple"},{x:3,y:6,name:"slanter"},{x:1,y:4,name:"star"},{x:5,y:4,name:"star"},{x:1,y:8,name:"star"},{x:5,y:8,name:"goal"}],[{x:0,y:6,name:"start"},{x:3,y:1,name:"block",color:"red"},{x:3,y:4,name:"slanter"},{x:3,y:6,name:"block",color:"orange"},{x:5,y:6,name:"block",color:"orange"},{x:5,y:4,name:"slanter"},{x:5,y:1,name:"block",color:"blue"},{x:0,y:2,name:"star"},{x:7,y:2,name:"star"},{x:7,y:6,name:"star"},{x:8,y:1,name:"goal"}],[{x:1,y:4,name:"start"},{x:3,y:4,name:"block",color:"orange"},{x:3,y:3,name:"block",color:"purple"},{x:3,y:6,name:"block",color:"purple"},{x:6,y:3,name:"block",color:"orange"},{x:5,y:6,name:"block",color:"orange"},{x:2,y:6,name:"slanter"},{x:6,y:6,name:"slanter"},{x:4,y:8,name:"block",color:"orange"},{x:5,y:2,name:"star"},{x:6,y:0,name:"star"},{x:4,y:5,name:"star"},{x:7,y:4,name:"goal"}],[{x:1,y:9,name:"start"},{x:4,y:9,name:"block",color:"orange"},{x:4,y:6,name:"slanter"},{x:3,y:5,name:"slanter"},{x:1,y:3,name:"slanter"},{x:2,y:2,name:"slanter"},{x:4,y:0,name:"slanter"},{x:5,y:1,name:"slanter"},{x:7,y:3,name:"slanter"},{x:8,y:4,name:"slanter"},{x:7,y:5,name:"slanter"},{x:6,y:3,name:"slanter"},{x:0,y:0,name:"star"},{x:9,y:1,name:"star"},{x:9,y:7,name:"star"},{x:5,y:4,name:"goal"}],[{x:0,y:4,name:"start"},{x:2,y:4,name:"block",color:"purple"},{x:5,y:4,name:"slanter"},{x:1,y:2,name:"block",color:"purple"},{x:3,y:0,name:"block",color:"orange"},{x:1,y:6,name:"block",color:"purple"},{x:3,y:8,name:"block",color:"orange"},{x:9,y:2,name:"block",color:"blue"},{x:7,y:0,name:"block",color:"red"},{x:9,y:6,name:"block",color:"green"},{x:7,y:8,name:"block",color:"blue"},{x:7,y:3,name:"block",color:"red"},{x:5,y:8,name:"star"},{x:9,y:3,name:"star"},{x:4,y:6,name:"star"},{x:3,y:3,name:"block",color:"purple"},{x:5,y:3,name:"goal"}],[{x:0,y:5,name:"start"},{x:3,y:3,name:"slanter"},{x:0,y:3,name:"block",color:"blue"},{x:5,y:8,name:"block",color:"green"},{x:8,y:8,name:"block",color:"blue"},{x:8,y:6,name:"block",color:"red"},{x:5,y:6,name:"block",color:"orange"},{x:6,y:4,name:"block",color:"orange"},{x:1,y:4,name:"star"},{x:5,y:3,name:"star"},{x:5,y:1,name:"star"},{x:3,y:6,name:"slanter"},{x:6,y:6,name:"slanter"},{x:6,y:3,name:"slanter"},{x:8,y:4,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"orange"},{x:9,y:6,name:"block",color:"purple"},{x:9,y:1,name:"block",color:"purple"},{x:3,y:6,name:"slanter"},{x:5,y:4,name:"slanter"},{x:3,y:2,name:"slanter"},{x:5,y:0,name:"slanter"},{x:7,y:2,name:"slanter"},{x:6,y:3,name:"star"},{x:6,y:6,name:"star"},{x:6,y:4,name:"star"},{x:7,y:1,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:9,name:"block",color:"orange"},{x:3,y:6,name:"slanter"},{x:2,y:5,name:"slanter"},{x:0,y:3,name:"slanter"},{x:1,y:2,name:"slanter"},{x:3,y:0,name:"slanter"},{x:4,y:1,name:"slanter"},{x:6,y:3,name:"slanter"},{x:7,y:4,name:"slanter"},{x:5,y:6,name:"slanter"},{x:3,y:5,name:"slanter"},{x:7,y:5,name:"block",color:"purple"},{x:5,y:3,name:"block",color:"purple"},{x:5,y:5,name:"block",color:"orange"},{x:3,y:3,name:"block",color:"blue"},{x:1,y:3,name:"star"},{x:3,y:1,name:"star"},{x:7,y:3,name:"star"},{x:4,y:4,name:"goal"}],[{x:0,y:5,name:"start"},{x:3,y:5,name:"block",color:"red"},{x:3,y:2,name:"block",color:"purple"},{x:3,y:8,name:"block",color:"purple"},{x:6,y:2,name:"block",color:"red"},{x:9,y:1,name:"block",color:"red"},{x:8,y:0,name:"block",color:"blue"},{x:9,y:4,name:"block",color:"green"},{x:9,y:6,name:"star"},{x:5,y:8,name:"block",color:"purple"},{x:5,y:0,name:"block",color:"purple"},{x:8,y:3,name:"block",color:"purple"},{x:9,y:0,name:"star"},{x:7,y:8,name:"block",color:"blue"},{x:7,y:1,name:"block",color:"red"},{x:7,y:6,name:"block",color:"green"},{x:6,y:5,name:"star"},{x:9,y:5,name:"goal"}],[{x:1,y:1,name:"start"},{x:6,y:3,name:"block",color:"purple"},{x:4,y:0,name:"block",color:"red"},{x:7,y:0,name:"block",color:"blue"},{x:4,y:3,name:"block",color:"green"},{x:9,y:3,name:"block",color:"red"},{x:6,y:5,name:"block",color:"red"},{x:5,y:5,name:"block",color:"blue"},{x:3,y:1,name:"block",color:"purple"},{x:6,y:1,name:"block",color:"purple"},{x:9,y:4,name:"block",color:"blue"},{x:3,y:5,name:"block",color:"purple"},{x:7,y:4,name:"star"},{x:9,y:7,name:"block",color:"red"},{x:7,y:7,name:"star"},{x:5,y:7,name:"block",color:"blue"},{x:3,y:4,name:"block",color:"green"},{x:9,y:9,name:"block",color:"green"},{x:6,y:9,name:"block",color:"blue"},{x:2,y:9,name:"block",color:"red"},{x:2,y:7,name:"block",color:"green"},{x:9,y:2,name:"star"},{x:0,y:9,name:"goal"}],[{x:1,y:8,name:"start"},{x:3,y:8,name:"block",color:"purple"},{x:5,y:8,name:"block",color:"purple"},{x:8,y:8,name:"block",color:"orange"},{x:8,y:6,name:"block",color:"blue"},{x:5,y:4,name:"diffusioner"},{x:4,y:4,name:"block",color:"red"},{x:4,y:3,name:"slanter"},{x:6,y:4,name:"block",color:"orange"},{x:5,y:3,name:"block",color:"orange"},{x:6,y:3,name:"block",color:"orange"},{x:6,y:5,name:"block",color:"purple"},{x:4,y:5,name:"block",color:"purple"},{x:6,y:1,name:"star"},{x:2,y:1,name:"star"},{x:2,y:5,name:"star"},{x:5,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:2,y:4,name:"diffusioner"},{x:8,y:4,name:"diffusioner"},{x:0,y:3,name:"block",color:"purple"},{x:3,y:4,name:"block",color:"blue"},{x:2,y:3,name:"block",color:"green"},{x:8,y:5,name:"block",color:"orange"},{x:5,y:1,name:"star"},{x:5,y:7,name:"star"},{x:8,y:2,name:"star"},{x:8,y:8,name:"goal"}],[{x:0,y:9,name:"start"},{x:3,y:2,name:"diffusioner"},{x:7,y:2,name:"diffusioner"},{x:7,y:6,name:"diffusioner"},{x:3,y:6,name:"diffusioner"},{x:5,y:4,name:"slanter"},{x:2,y:7,name:"slanter"},{x:8,y:7,name:"slanter"},{x:3,y:3,name:"slanter"},{x:5,y:7,name:"block",color:"orange"},{x:5,y:9,name:"block",color:"orange"},{x:2,y:9,name:"block",color:"purple"},{x:5,y:0,name:"block",color:"purple"},{x:5,y:2,name:"block",color:"red"},{x:1,y:2,name:"block",color:"orange"},{x:1,y:8,name:"star"},{x:9,y:8,name:"star"},{x:1,y:0,name:"star"},{x:7,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:2,y:4,name:"diffusioner"},{x:8,y:4,name:"diffusioner"},{x:0,y:3,name:"block",color:"purple"},{x:3,y:3,name:"block",color:"purple"},{x:2,y:5,name:"block",color:"purple"},{x:3,y:4,name:"block",color:"blue"},{x:2,y:3,name:"block",color:"green"},{x:7,y:3,name:"slanter"},{x:8,y:5,name:"block",color:"orange"},{x:5,y:1,name:"star"},{x:6,y:7,name:"star"},{x:9,y:1,name:"star"},{x:8,y:8,name:"goal"}],[{x:0,y:8,name:"start"},{x:3,y:1,name:"diffusioner"},{x:7,y:1,name:"diffusioner"},{x:7,y:5,name:"diffusioner"},{x:3,y:5,name:"diffusioner"},{x:5,y:3,name:"slanter"},{x:2,y:5,name:"slanter"},{x:5,y:6,name:"block",color:"orange"},{x:7,y:6,name:"block",color:"orange"},{x:5,y:8,name:"block",color:"orange"},{x:4,y:1,name:"block",color:"orange"},{x:2,y:8,name:"block",color:"purple"},{x:8,y:1,name:"block",color:"purple"},{x:3,y:2,name:"block",color:"purple"},{x:3,y:4,name:"block",color:"purple"},{x:7,y:4,name:"block",color:"purple"},{x:2,y:2,name:"block",color:"blue"},{x:6,y:1,name:"block",color:"orange"},{x:2,y:4,name:"block",color:"red"},{x:5,y:1,name:"star"},{x:3,y:3,name:"star"},{x:7,y:3,name:"star"},{x:0,y:0,name:"goal"}],[{x:0,y:8,name:"start"},{x:1,y:6,name:"diffusioner"},{x:3,y:8,name:"slanter"},{x:2,y:5,name:"slanter"},{x:4,y:3,name:"diffusioner"},{x:5,y:2,name:"slanter"},{x:8,y:4,name:"slanter"},{x:3,y:5,name:"block",color:"purple"},{x:5,y:5,name:"block",color:"orange"},{x:5,y:5,name:"block",color:"orange"},{x:7,y:7,name:"block",color:"orange"},{x:5,y:7,name:"slanter"},{x:3,y:9,name:"block",color:"red"},{x:4,y:6,name:"star"},{x:6,y:4,name:"star"},{x:3,y:2,name:"star"},{x:3,y:7,name:"goal"}],[{x:1,y:2,name:"start"},{x:7,y:2,name:"pipe",color:"blue",pipeStatus:{x:4,y:7,direction:"right"}},{x:6,y:7,name:"block",color:"red"},{x:4,y:4,name:"star"},{x:6,y:9,name:"star"},{x:9,y:7,name:"star"},{x:6,y:4,name:"goal"}],[{x:1,y:1,name:"start"},{x:7,y:1,name:"pipe",color:"red",pipeStatus:{x:1,y:8,direction:"right"}},{x:4,y:4,name:"pipe",color:"green",pipeStatus:{x:8,y:6,direction:"left"}},{x:4,y:1,name:"block",color:"red"},{x:5,y:6,name:"block",color:"red"},{x:4,y:8,name:"block",color:"red"},{x:5,y:0,name:"star"},{x:8,y:3,name:"star"},{x:2,y:6,name:"star"},{x:2,y:3,name:"goal"}],[{x:0,y:4,name:"start"},{x:2,y:3,name:"block",color:"red"},{x:2,y:5,name:"block",color:"blue"},{x:5,y:3,name:"block",color:"green"},{x:3,y:4,name:"diffusioner"},{x:4,y:3,name:"star"},{x:4,y:4,name:"star"},{x:4,y:5,name:"star"},{x:8,y:0,name:"goal"}],[{x:0,y:4,name:"start"},{x:4,y:1,name:"pipe",color:"blue",pipeStatus:{x:0,y:5,direction:"right"}},{x:3,y:4,name:"block",color:"red"},{x:6,y:4,name:"block",color:"blue"},{x:9,y:1,name:"block",color:"green"},{x:9,y:5,name:"block",color:"green"},{x:7,y:5,name:"block",color:"purple"},{x:7,y:1,name:"block",color:"red"},{x:6,y:5,name:"star"},{x:4,y:5,name:"star"},{x:7,y:3,name:"star"},{x:1,y:5,name:"goal"}],[{x:1,y:4,name:"start"},{x:3,y:7,name:"pipe",color:"red",pipeStatus:{x:0,y:0,direction:"down"}},{x:3,y:3,name:"pipe",color:"green",pipeStatus:{x:0,y:9,direction:"right"}},{x:6,y:3,name:"pipe",color:"blue",pipeStatus:{x:9,y:0,direction:"left"}},{x:6,y:7,name:"pipe",color:"orange",pipeStatus:{x:9,y:9,direction:"up"}},{x:0,y:3,name:"block",color:"purple"},{x:1,y:7,name:"block",color:"purple"},{x:9,y:6,name:"block",color:"green"},{x:6,y:9,name:"block",color:"orange"},{x:2,y:5,name:"block",color:"blue"},{x:3,y:9,name:"block",color:"red"},{x:9,y:3,name:"block",color:"purple"},{x:5,y:5,name:"star"},{x:2,y:0,name:"star"},{x:6,y:6,name:"star"},{x:6,y:0,name:"goal"}],[{x:0,y:5,name:"start"},{x:0,y:0,name:"pipe",color:"red",pipeStatus:{x:2,y:4,direction:"right"}},{x:3,y:2,name:"pipe",color:"green",pipeStatus:{x:8,y:4,direction:"left"}},{x:0,y:6,name:"block",color:"blue"},{x:3,y:6,name:"block",color:"red"},{x:6,y:6,name:"block",color:"purple"},{x:5,y:7,name:"block",color:"orange"},{x:9,y:3,name:"block",color:"orange"},{x:9,y:6,name:"block",color:"red"},{x:5,y:9,name:"block",color:"blue"},{x:9,y:0,name:"block",color:"green"},{x:6,y:0,name:"block",color:"purple"},{x:5,y:4,name:"slanter"},{x:4,y:4,name:"slanter"},{x:6,y:4,name:"slanter"},{x:5,y:3,name:"slanter"},{x:5,y:5,name:"slanter"},{x:4,y:3,name:"star"},{x:6,y:3,name:"star"},{x:4,y:5,name:"star"},{x:6,y:5,name:"goal"}],[{x:0,y:4,name:"start"},{x:0,y:5,name:"block",color:"red"},{x:2,y:5,name:"block",color:"blue"},{x:2,y:3,name:"block",color:"orange"},{x:2,y:1,name:"block",color:"purple"},{x:1,y:1,name:"slanter"},{x:3,y:7,name:"slanter"},{x:2,y:0,name:"pipe",color:"red",pipeStatus:{x:3,y:8,direction:"right"}},{x:4,y:2,name:"pipe",color:"green",pipeStatus:{x:2,y:8,direction:"right"}},{x:6,y:2,name:"pipe",color:"blue",pipeStatus:{x:3,y:9,direction:"up"}},{x:3,y:3,name:"block",color:"purple"},{x:6,y:3,name:"diffusioner"},{x:4,y:8,name:"block",color:"orange"},{x:5,y:8,name:"slanter"},{x:7,y:6,name:"slanter"},{x:6,y:8,name:"block",color:"orange"},{x:0,y:0,name:"star"},{x:5,y:9,name:"star"},{x:4,y:6,name:"star"},{x:6,y:5,name:"goal"}],[{x:4,y:5,name:"start"},{x:6,y:5,name:"block",color:"blue"},{x:6,y:3,name:"pipe",color:"green",pipeStatus:{x:3,y:6,direction:"right"}},{x:5,y:6,name:"block",color:"purple"},{x:7,y:6,name:"block",color:"red"},{x:7,y:4,name:"block",color:"orange"},{x:7,y:2,name:"block",color:"green"},{x:5,y:1,name:"slanter"},{x:5,y:2,name:"block",color:"purple"},{x:3,y:2,name:"pipe",color:"red",pipeStatus:{x:0,y:9,direction:"right"}},{x:5,y:4,name:"pipe",color:"blue",pipeStatus:{x:0,y:2,direction:"down"}},{x:3,y:9,name:"block",color:"blue"},{x:6,y:9,name:"block",color:"red"},{x:9,y:9,name:"block",color:"green"},{x:9,y:7,name:"block",color:"blue"},{x:9,y:4,name:"block",color:"orange"},{x:8,y:4,name:"block",color:"red"},{x:9,y:1,name:"block",color:"green"},{x:9,y:0,name:"block",color:"blue"},{x:6,y:0,name:"block",color:"red"},{x:3,y:0,name:"block",color:"green"},{x:0,y:0,name:"block",color:"blue"},{x:0,y:4,name:"block",color:"green"},{x:0,y:6,name:"block",color:"red"},{x:3,y:4,name:"star"},{x:3,y:3,name:"star"},{x:3,y:5,name:"star"},{x:0,y:8,name:"goal"}],[{x:5,y:5,name:"start"},{x:5,y:7,name:"slanter"},{x:7,y:5,name:"pipe",color:"red",pipeStatus:{x:3,y:7,direction:"left"}},{x:3,y:5,name:"diffusioner"},{x:5,y:3,name:"block",color:"blue"},{x:3,y:3,name:"slanter"},{x:7,y:6,name:"slanter"},{x:5,y:1,name:"pipe",color:"blue",pipeStatus:{x:7,y:7,direction:"right"}},{x:7,y:3,name:"diffusioner"},{x:9,y:6,name:"star"},{x:9,y:4,name:"block",color:"orange"},{x:4,y:9,name:"pipe",color:"green",pipeStatus:{x:7,y:9,direction:"up"}},{x:9,y:1,name:"block",color:"purple"},{x:1,y:4,name:"block",color:"orange"},{x:7,y:1,name:"block",color:"blue"},{x:4,y:1,name:"slanter"},{x:1,y:7,name:"star"},{x:5,y:8,name:"star"},{x:5,y:0,name:"goal"}],[{x:0,y:0,name:"start"},{x:0,y:3,name:"block",color:"orange"},{x:0,y:6,name:"block",color:"blue"},{x:2,y:6,name:"pipe",color:"red",pipeStatus:{x:3,y:1,direction:"right"}},{x:0,y:8,name:"pipe",color:"blue",pipeStatus:{x:3,y:5,direction:"up"}},{x:3,y:3,name:"block",color:"purple"},{x:5,y:1,name:"block",color:"orange"},{x:5,y:3,name:"diffusioner"},{x:6,y:3,name:"block",color:"purple"},{x:5,y:4,name:"block",color:"orange"},{x:5,y:5,name:"block",color:"purple"},{x:7,y:5,name:"star"},{x:7,y:3,name:"diffusioner"},{x:7,y:2,name:"diffusioner"},{x:7,y:1,name:"star"},{x:2,y:8,name:"star"},{x:2,y:2,name:"pipe",color:"green",pipeStatus:{x:3,y:7,direction:"right"}},{x:8,y:2,name:"block",color:"orange"},{x:8,y:5,name:"block",color:"orange"},{x:5,y:7,name:"block",color:"purple"},{x:7,y:7,name:"goal"}],[{x:0,y:9,name:"start"},{x:0,y:7,name:"block",color:"purple"},{x:2,y:7,name:"block",color:"orange"},{x:2,y:5,name:"block",color:"orange"},{x:2,y:2,name:"diffusioner"},{x:1,y:1,name:"slanter"},{x:3,y:1,name:"slanter"},{x:1,y:3,name:"slanter"},{x:3,y:3,name:"slanter"},{x:5,y:5,name:"block",color:"orange"},{x:5,y:2,name:"diffusioner"},{x:4,y:1,name:"slanter"},{x:6,y:1,name:"slanter"},{x:4,y:3,name:"slanter"},{x:6,y:3,name:"slanter"},{x:8,y:5,name:"block",color:"orange"},{x:8,y:2,name:"diffusioner"},{x:7,y:1,name:"slanter"},{x:9,y:1,name:"slanter"},{x:7,y:3,name:"slanter"},{x:9,y:3,name:"slanter"},{x:8,y:0,name:"pipe",color:"green",pipeStatus:{x:3,y:9,direction:"right"}},{x:2,y:0,name:"pipe",color:"red",pipeStatus:{x:9,y:4,direction:"down"}},{x:9,y:6,name:"block",color:"orange"},{x:8,y:9,name:"star"},{x:6,y:9,name:"block",color:"purple"},{x:9,y:8,name:"star"},{x:5,y:0,name:"star"},{x:9,y:9,name:"goal"}],[{x:3,y:9,name:"start"},{x:3,y:8,name:"block",color:"green"},{x:3,y:7,name:"block",color:"green"},{x:2,y:7,name:"block",color:"green"},{x:2,y:6,name:"block",color:"green"},{x:2,y:5,name:"slanter"},{x:2,y:4,name:"block",color:"green"},{x:2,y:4,name:"block",color:"green"},{x:3,y:4,name:"slanter"},{x:4,y:4,name:"block",color:"green"},{x:2,y:3,name:"slanter"},{x:2,y:2,name:"slanter"},{x:3,y:1,name:"slanter"},{x:4,y:1,name:"block",color:"green"},{x:2,y:0,name:"slanter"},{x:6,y:8,name:"slanter"},{x:6,y:7,name:"slanter"},{x:7,y:7,name:"block",color:"green"},{x:7,y:6,name:"block",color:"green"},{x:7,y:5,name:"slanter"},{x:7,y:4,name:"block",color:"green"},{x:7,y:4,name:"block",color:"green"},{x:6,y:4,name:"block",color:"green"},{x:5,y:4,name:"slanter"},{x:7,y:2,name:"slanter"},{x:6,y:1,name:"slanter"},{x:5,y:1,name:"slanter"},{x:7,y:0,name:"slanter"},{x:4,y:7,name:"pipe",color:"green",pipeStatus:{x:1,y:4,direction:"down"}},{x:5,y:7,name:"pipe",color:"green",pipeStatus:{x:8,y:4,direction:"down"}},{x:1,y:5,name:"pipe",color:"red",pipeStatus:{x:8,y:6,direction:"down"}},{x:8,y:5,name:"pipe",color:"blue",pipeStatus:{x:1,y:6,direction:"down"}},{x:6,y:9,name:"star"},{x:3,y:2,name:"star"},{x:6,y:2,name:"star"},{x:5,y:5,name:"goal"}]],TUTOSTAGES=[[{x:1,y:4,name:"tutoBlock",color:"start"},{x:4,y:4,name:"tutoBlock",color:"blue"},{x:7,y:4,name:"tutoGoal",color:"green"}],[{x:1,y:4,name:"tutoBlock",color:"start"},{x:4,y:4,name:"tutoBlock",color:"blue"},{x:7,y:7,name:"tutoGoal",color:"green"}],[{x:0,y:4,name:"tutoBlock",color:"start"},{x:4,y:4,name:"tutoBlock",color:"blue"},{x:7,y:7,name:"tutoGoal",color:"green"}]],tutoCurrentStage=[],COUNTRYCODE=browserLanguage(),PIPE_COLOR_ARRAY=["blue","red","green"],VOLUME=1,creater,pipeManager,boxManager,userData,stageBoxes=[],stageGroup,effectLevel=1,LANGUAGE={ja:{title:"Touch<br /><span>Bloomy</span>",touchStart:"画面をタッチ",optionTitle:"エフェクト",optionEffect:["控えめ","普通","ど派手"],optionDeleteData:"セーブデータを削除",optionDeleteConf:"本当に削除しますか？",optionDeleteComp:"セーブデータを削除しました",optionAllStage:"全ステージを解放(大会用)",optionAllStageUnlock:"全てのステージで遊べるようになりました！",gameStart:"ゲーム開始",gameOver:"Game Over",gameRetry:"リトライ",howToPlay:"遊び方",startTutorial:"今からこのゲームのチュートリアルを始めます",sirotama:"ゲーム開始時このオブジェクトが四散します",aotama:"破片が他のオブジェクトに当たると誘爆します",prevGoal:"黄色いゴールオブジェクトに当てればクリアです",tutoClear:"このようにゴールオブジェクトを<br/>壊せばクリアです",nextLosePattern:"それでは、<br/>次は負けパターンを見てみましょう",losePattern:"負けパターンを始めます",endChain:"このままでは連鎖が途切れてしまいます",loseMsg:"これであなたの負けです",yourMission:"あなたは一つオブジェクトを置いて<br/>ゴールまで導く事が出来ます",letsWin:"さあ次はクリアしましょう",tutoThirdStartMsg:"画面をタップしてオブジェクトを置き,<br/>ゴールオブジェクトまで連鎖させましょう",tutoClearMsg:"ゲームクリアです!",tutoClearMsg2:"本番のステージでは<br/>オブジェクトを置くまでに時間制限があります",tutoClearMsg3:"それでは、ゲームをお楽しみ下さい",backToTop:"TOPへ戻る",volumeOption:"音量",stageEdit:"ステージを作る",post:"投稿",testplay:"試す",pipeColorButton:"色を変える",pipeDirectionUpper:"上に発射",pipeDirectionLefter:"左に発射",pipeDirectionRighter:"右に発射",pipeDirectionDowner:"下に発射",postStartNoneError:"スタートが置かれていないステージは投稿できません",postGoalNoneError:"ゴールが置かれていないステージは投稿できません",postPipeError:"ワープオブジェクトは対となる出口が設定されていないと投稿できません",postStarManyError:"星が３つ置いてないステージは投稿できません",restore:"戻す",eraser:"消しゴム",enterPipeError:"ワープオブジェクトは対となる出口が設定されていないと投稿できません",enterStartError:"スタートが置かれていないステージは実行できません",sameColorParentError:"既に置いてある色のワープオブジェクトは置く事が出来ません"},en:{title:"Touch<br /><span>Bloomy</span>",touchStart:"Touch Screen",optionTitle:"Effect",optionEffect:["Low","Normal","HIGH"],optionDeleteData:"Delete Save Data",optionDeleteConf:"Are you sure you want to delete?",optionDeleteComp:"Save Data was deleted",optionAllStage:"All Stage unlock (For html5jcup)",optionAllStageUnlock:"Stage of all has been unlocked!",gameStart:"Start Game",gameOver:"Game Over",gameRetry:"Retry",howToPlay:"How to play",startTutorial:"Let's start tutorial'",sirotama:"First, This Object is broken",aotama:"When Snipets touch another object,the object is broken",prevGoal:"This is Goal Object,and breaking this is Stage Clear",tutoClear:"It's Clear",nextLosePattern:"OK? <br/>Next Lose pattern!",losePattern:"This is lose pattern",endChain:"This case,chaining come to an end",loseMsg:"You lose",yourMission:"Your Mission:All break and Chain to Goal",letsWin:"Next Let's Win!",tutoThirdStartMsg:"You can put one Circle to Chain to Goal",tutoClearMsg:"You did it!",tutoClearMsg2:"If this is real game,It have a time limit",tutoClearMsg3:"Enjoy your game!",backToTop:"Back to Top",volumeOption:"SoundVolume",stageEdit:"Edit Stage",post:"Post your Stage!",testplay:"Test play",pipeColorButton:"Change Color",pipeDirectionUpper:"turn up shoot",pipeDirectionLefter:"turn left shoot",pipeDirectionRighter:"turn right shoot",pipeDirectionDowner:"turn down shoot",postStartNoneError:"You should put Start Object!",postGoalNoneError:"You should put Goal Object!",postPipeError:"Please check Warp Object's exit",postStarManyError:"You should put three Stars!",restore:"Restore",eraser:"Eraser",enterPipeError:"Please check Warp Object's exit",enterStartError:"You should put Start Object!",sameColorParentError:"Cannot put same color Warp Object!"}},tutorialScene=null;
enchant(),window.onload=function(){GAME=new Game(640,960),GAME.preload("sound/white.mp3","sound/goal.mp3","sound/start.mp3","sound/orange.mp3","sound/purple.mp3","sound/green.mp3","sound/red.mp3","sound/slanter.mp3","sound/pipe.mp3","sound/blue.mp3","sound/star.mp3","sound/diffusioner.mp3"),GAME.fps=30,GAME.onload=function(){GAME.rootScene.backgroundColor="white",createSurfaces();var e=createTitleScene();initTutorialScene(),GAME.pushScene(e)},GAME.start()};var TitleBackAnim=Class.create(Group,{initialize:function(){Group.call(this),this.count=3,this.next=0,this.blocks=[new Block("red"),new Block("blue"),new Block("green")],this.positions=[{x:1,y:1},{x:8,y:1},{x:8,y:8},{x:1,y:8}]},onaddedtoscene:function(){for(var e=this,t=0;this.blocks.length>t;t++){var a=this.blocks[t];a.x=this.positions[t].x*BOX_SIZE,a.y=this.positions[t].y*BOX_SIZE,this.parentNode.addChild(a),a.run=function(){if(this.parentNode){var t=this,a=new HitArc(this.color);a.x=this.x-128,a.y=this.y-128,this.parentNode.addChild(a),e.next++,3===e.next&&(e.next=0);for(var r in this.beamStatus){var n={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,color:this.color,parentBlock:this,beamLength:BEAM_LENGTH};this.parentNode.addChild(new Beam(this.beamStatus[r],n))}t.tl.moveTo(e.positions[e.count].x*BOX_SIZE,e.positions[e.count].y*BOX_SIZE,30),e.count++,4===e.count&&(e.count=0)}}}},startAnim:function(){var e=this;this.parentNode.loopTimer=setInterval(function(){e.blocks[e.next].run()},2500)}}),StageGroup=Class.create(Group,{initialize:function(){Group.call(this),this._element=document.createElement("div")},onaddedtoscene:function(){var e=this,t=createBacktoTopLabel();t.on("touchend",function(){e.parentNode.backToTop();for(var t=e.parentNode.childNodes.length,a=0;t>a;a++)e.parentNode.removeChild(e.childNodes[t-a-1])}),this.parentNode.addChild(t);var a=createPlayerStatus(userData);this.parentNode.addChild(a)}}),StageBox=Class.create(Sprite,{initialize:function(e,t,a){Sprite.call(this,2*BOX_SIZE,2*BOX_SIZE),this._element=document.createElement("div"),this._element.innerHTML=e+1,this.image=SCORE_STARS[t],this.level=e,this.moved=!1,this.isLock=a},ontouchstart:function(e){this.startEvent=e,this.moved=!1},ontouchmove:function(e){(Math.abs(this.startEvent.x-e.x)>10||Math.abs(this.startEvent.y-e.y)>10)&&(this.moved=!0)},ontouchend:function(){this.moved||this.isLock||GAME.currentScene.selectedStage(this.level)}}),Box=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="box",this.moved=!1},ontouchstart:function(e){this.startEvent=e,this.moved=!1,this._element.className="box touched"},ontouchmove:function(e){(Math.abs(this.startEvent.x-e.x)>10||Math.abs(this.startEvent.y-e.y)>10)&&(this.moved=!0)},ontouchend:function(){if(this._element.className="box",this.parentNode.canTap&&!this.moved){this.parentNode.canTap=!1;var e=new Block("white");e.x=this.x,e.y=this.y,currentStage.push(e),this.parentNode.addChild(e)}}}),HitArc=Class.create(Sprite,{initialize:function(e){Sprite.call(this,320,320),this.scaleX=.1,this.scaleY=.1;var t=new Surface(320,320);t.context.beginPath(),t.context.fillStyle=COLORS[e],t.context.arc(160,160,160,0,2*Math.PI,!0),t.context.fill(),this.image=t},onaddedtoscene:function(){var e=this;this.tl.scaleTo(1.5*effectLevel*effectLevel,1.5*effectLevel*effectLevel,20).delay(20*(effectLevel-1)).fadeTo(0,10*effectLevel).then(function(){GAME.currentScene.removeChild(e)})}}),Timer=Class.create(Label,{initialize:function(){Label.call(this),this.timer=20,this.text=this.timer,this.font="400px Bitter",this.color=COLORS.blue,this.width=640,this.height=640,this.originX=320,this.originY=320,this.opacity=.4,this.textAlign="center"},onaddedtoscene:function(){this.tl.scaleTo(.1,.1,600)},onenterframe:function(){0===this.age%30&&(this.text=--this.timer,5===this.timer?this.color=COLORS.yellow:3===this.timer&&(this.color=COLORS.red),this.timer>0&&!this.parentNode.canTap?(this.parentNode.addChild(this.parentNode.retryLabel),currentStage[0].run(),this.parentNode.removeChild(this),currentStage.splice(0,1)):0>=this.timer&&(this.parentNode.addChild(this.parentNode.retryLabel),this.parentNode.canTap=!1,currentStage[0].run(),this.parentNode.removeChild(this),currentStage.splice(0,1)))}}),Result=Class.create(Group,{initialize:function(){function e(){t.removeChild(t.clearLabel),t.removeChild(t.nextStage);for(var e=0;t.resultStars.length>e;e++)t.removeChild(t.resultStars[e]);t.parentNode.removeChild(t.prevStage),t.parentNode.removeChild(t.nextStage),t.parentNode.removeChild(t.stageSelect),t.parentNode.removeChild(t.retry),t.parentNode.removeChild(t)}Group.call(this);var t=this;this._element=document.createElement("div"),this.clearLabel=new ExLabel("Stage "+(LEVEL+1)+" Clear !",640,80),this.clearLabel.setClassName("clearText"),this.clearLabel.opacity=0,this.clearLabel.x=0,this.clearLabel.y=100,this.addChild(this.clearLabel),this.resultStars=[],this.resultStars[0]=new Star,this.resultStars[0].x=160,this.resultStars[0].y=320,this.resultStars[1]=new Star,this.resultStars[1].x=288,this.resultStars[1].y=288,this.resultStars[2]=new Star,this.resultStars[2].x=416,this.resultStars[2].y=320,this.resultStars.forEach(function(e){e.onaddedtoscene=null,e.scaleX=.8,e.scaleY=.8,e.opacity=0,t.addChild(e)}),this.nextStage=new Block("black"),this.nextStage._element.className="black forResultBlock",this.nextStage._element.innerHTML='<i class="icon-pageforward">',this.nextStage.x=448,this.nextStage.y=480,this.nextStage.addEventListener("touchend",function(){var a=new HitArc("black");a.x=t.nextStage.x-128,a.y=t.nextStage.y-128,t.parentNode.addChild(a),LEVEL++,t.parentNode.initStage(),e()}),this.prevStage=new Block("black"),this.prevStage._element.className="black forResultBlock",this.prevStage._element.innerHTML='<i class="icon-pageback">',this.prevStage.x=128,this.prevStage.y=480,this.prevStage.addEventListener("touchend",function(){var a=new HitArc("black");a.x=t.prevStage.x-128,a.y=t.prevStage.y-128,t.parentNode.addChild(a),LEVEL--,t.parentNode.initStage(),e()}),this.stageSelect=new Block("black"),this.stageSelect._element.className="black forResultBlock",this.stageSelect._element.innerHTML='<i class="icon-th">',this.stageSelect.x=288,this.stageSelect.y=432,this.stageSelect.addEventListener("touchend",function(){t.parentNode.removeChild(BACKGROUND_ARC),e(),GAME.currentScene.stageSelect()}),this.retry=new Block("black"),this.retry._element.className="black forResultBlock",this.retry._element.innerHTML='<i class="icon-repeat">',this.retry.x=288,this.retry.y=528,this.retry.addEventListener("touchend",function(){var a=new HitArc("black");a.x=t.retry.x-128,a.y=t.retry.y-128,t.parentNode.addChild(a),t.parentNode.initStage(),e()})},onaddedtoscene:function(){var e=this,t=0;this.clearLabel.tl.delay(10).fadeTo(1,10);for(var a=0;this.parentNode.star>a;a++)this.resultStars[a].tl.delay(25).fadeTo(1,10).delay(15).delay(15*a).scaleTo(1.3,1.3,10).and().rotateTo(144,10).then(function(){e.resultStars[t++].image=YELLOW_STAR,playSound("star")});this.tl.delay(50+15*a).then(function(){LEVEL&&(e.parentNode.addChild(e.prevStage),e.prevStage.tl.scaleTo(0,0,0).then(function(){e.prevStage._element.className="black changeBu"}).scaleTo(1,1,15,BOUNCE_EASEOUT)),LEVEL!==STAGES.length-1&&(e.parentNode.addChild(e.nextStage),e.nextStage.tl.scaleTo(0,0,0).then(function(){e.nextStage._element.className="black changeBu"}).scaleTo(1,1,15,BOUNCE_EASEOUT)),e.parentNode.addChild(e.stageSelect),e.stageSelect.tl.scaleTo(0,0,0).then(function(){e.stageSelect._element.className="black"}).scaleTo(1,1,15,BOUNCE_EASEOUT),e.parentNode.addChild(e.retry),e.retry.tl.scaleTo(0,0,0).then(function(){e.retry._element.className="black"}).scaleTo(1,1,15,BOUNCE_EASEOUT)})}}),GameOver=Class.create(Group,{initialize:function(){Group.call(this);var e=this;this._element=document.createElement("div"),this.gameOverLabel=new ExLabel(LANGUAGE[COUNTRYCODE].gameOver,640,100),this.gameOverLabel.setClassName("gameOverText"),this.gameOverLabel.x=0,this.gameOverLabel.y=-80,this.addChild(this.gameOverLabel),this.again=new Block("black"),this.again._element.className="black",this.again._element.innerHTML='<i class="icon-repeat">',this.again.x=352,this.again.y=480,this.addChild(this.again),this.again.addEventListener("touchend",function(){var t=new HitArc("black");t.x=e.again.x-128,t.y=e.again.y-128,e.parentNode.addChild(t),e.parentNode.stars.forEach(function(t){t.run=function(){},e.parentNode.removeChild(t)}),e.parentNode.initStage(),e.removeChild(e.gameOverLabel),e.removeChild(e.again),e.removeChild(e.stageSelect),e.parentNode.removeChild(e)}),this.stageSelect=new Block("black"),this.stageSelect._element.className="black",this.stageSelect._element.innerHTML='<i class="icon-th">',this.stageSelect.x=224,this.stageSelect.y=480,this.addChild(this.stageSelect),this.stageSelect.addEventListener("touchend",function(){e.parentNode.removeChild(BACKGROUND_ARC),e.parentNode.stars.forEach(function(t){t.run=function(){},e.parentNode.removeChild(t)}),e.removeChild(e.gameOverLabel),e.removeChild(e.again),e.removeChild(e.stageSelect),e.parentNode.removeChild(e),GAME.currentScene.stageSelect(),delete e})},onaddedtoscene:function(){this.parentNode.removeChild(this.parentNode.retryLabel),this.gameOverLabel.tl.moveTo(0,230,30,BOUNCE_EASEOUT)}}),ExLabel=Class.create(Sprite,{initialize:function(e,t,a){var r=t||640,n=a||64;Sprite.call(this,r,n),this._element=document.createElement("div"),this._element.innerHTML=e},setClassName:function(e){this._element.className=e}}),Beam=Class.create(Sprite,{initialize:function(e,t){Sprite.call(this,BEAM_SIZE,BEAM_SIZE),this._element=document.createElement("div"),this._element.className="beam",this.direction=e,this.initX=t.x,this.initY=t.y,this.x=t.x,this.y=t.y,this.currentStage=currentStage,this.parentBlock=t.parentBlock,this.beamLength=t.beamLength*BOX_SIZE,this.COLORS=COLORS},onenterframe:function(){for(var e=this.currentStage.length,t=BOX_HALF+12,a=0;e>a;a++)if(this.currentStage[a]){if(this.within(this.currentStage[a],this.currentStage[a].distance||t)&&this.currentStage[a]!==this.parentBlock&&!this.parentNode.cleared)return this.currentStage[a].run(),delete this.currentStage[a],this.currentStage.splice(a,1),GAME.currentScene.removeChild(this),void 0}else GAME.currentScene.removeChild(this);Math.abs(this.initX-this.x)<this.beamLength&&Math.abs(this.initY-this.y)<this.beamLength?(this.x+=this.direction.moveX,this.y+=this.direction.moveY):(this.opacity-=.1,0>this.opacity&&GAME.currentScene.removeChild(this))}}),Block=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=e,this.color=e,"orange"===this.color?this.image=ORANGE:"purple"===this.color&&(this.image=PURPLE),this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},run:function(){if(clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500),effectLevel>0){var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e)}var t=0;for(var a in this.beamStatus){if(DIRECTIONS[this.color][t]){var r={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this,beamLength:BEAM_LENGTH};this.parentNode.addChild(new Beam(this.beamStatus[a],r))}t++}playSound(this.color),this.parentNode.removeChild(this)}}),CountBlock=Class.create(Sprite,{initialize:function(e,t){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=e+" count",this._element.innerHTML=t,this.count=t,this.color=e,this.currentStage=currentStage,this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500);var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e);for(var t in this.beamStatus){var a={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this};this.parentNode.addChild(new Beam(this.beamStatus[t],a))}this.count>1?(this._element.innerHTML=--this.count,this.currentStage.push(this)):this.parentNode.removeChild(this)}}),Start=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="start",this.backgroundColor=COLORS.white,this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},run:function(){var e=new HitArc("white");e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e);var t=0;for(var a in this.beamStatus){if(DIRECTIONS.white[t]){var r={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,color:"white",parentBlock:this,beamLength:BEAM_LENGTH};this.parentNode.addChild(new Beam(this.beamStatus[a],r))}t++}playSound("start"),this.parentNode.removeChild(this)}}),Goal=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="goal",this.scaleX=.8,this.scaleY=.8,this.distance=1,this.tl.scaleTo(.6,.6,30,CUBIC_EASEIN).scaleTo(.8,.8,30,CUBIC_EASEOUT).loop()},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.cleared=!0,this.parentNode.removeChild(this.parentNode.retryLabel),playSound("goal");var e=this;this.parentNode.stars.forEach(function(t){t.run=function(){},e.parentNode.removeChild(t)}),this.tl.clear().scaleTo(30,30,30).then(function(){currentStage.forEach(function(t){e.parentNode.removeChild(t)}),e.parentNode.removeChild(BACKGROUND_ARC)}).delay(30).fadeTo(0,15).then(function(){e.parentNode.showResult(),e.parentNode.removeChild(e)})}}),Star=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this.image=WHITE_STAR,this.hited=!1},onaddedtoscene:function(){this.parentNode.stars.push(this)},run:function(){var e=this;this.hited=!0,this.tl.scaleTo(.5,.5,7).scaleTo(1,1,2).then(function(){e.tl.clear(),e.tl.delay(5).rotateBy(72,40,EXPO_EASEOUT)}),this.image=YELLOW_STAR,playSound("star"),this.parentNode.star++}}),Diffusioner=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="diffusioner",this.image=DIFFUSIONER;var e=2*MOVE_PX;this.beamStatus={top:{moveX:0,moveY:-e},topRight:{moveX:e,moveY:-e},right:{moveX:e,moveY:0},rightDown:{moveX:e,moveY:e},down:{moveX:0,moveY:e},downLeft:{moveX:-e,moveY:e},left:{moveX:-e,moveY:0},leftTop:{moveX:-e,moveY:-e}},this.color="red"},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500);var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e);var t=0;for(var a in this.beamStatus){var r={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this,beamLength:1};this.parentNode.addChild(new Beam(this.beamStatus[a],r)),t++}playSound("diffusioner"),this.parentNode.removeChild(this)}}),Slanter=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="slanter",this.image=SLANTER,this.rotation=45,this.beamStatus={topRight:{moveX:MOVE_PX,moveY:-MOVE_PX},rightDown:{moveX:MOVE_PX,moveY:MOVE_PX},downLeft:{moveX:-MOVE_PX,moveY:MOVE_PX},leftTop:{moveX:-MOVE_PX,moveY:-MOVE_PX}},this.color="green"},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500);var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,this.parentNode.addChild(e);var t=0;for(var a in this.beamStatus){var r={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this,beamLength:2};this.parentNode.addChild(new Beam(this.beamStatus[a],r)),t++}playSound("slanter"),this.parentNode.removeChild(this)}}),Linker=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="linker",LINKER=new Surface(BOX_SIZE,BOX_SIZE);var t=LINKER.context;t.fillStyle=COLORS[e],t.strokeStyle=COLORS.white,t.lineWidth=3,t.beginPath(),drawStar(BOX_SIZE/2,BOX_SIZE/2,3,BOX_SIZE/3,BOX_SIZE/3,t),t.fill(),t.stroke(),t.closePath(),this.image=LINKER,this.color=e,this.currentStage=currentStage},run:function(){for(var e=this.currentStage.length,t=[],a=0;e>a;a++)this.currentStage[a].color===this.color&&this!==this.currentStage[a]&&(this.currentStage[a].run(),t.push(a));for(var a=0;t>a;a++)this.currentStage.splice(t[a],1);this.parentNode.removeChild(this)}}),Pipe=Class.create(Sprite,{initialize:function(e,t){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="pipe",this.image=PIPE_COLORS[e].pipe,this.pipeStatus=t,this.color=e,this.beamStatus={up:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},onaddedtoscene:function(){this.pipeOut=new Sprite(BOX_SIZE,BOX_SIZE),this.pipeOut._element=document.createElement("div"),this.pipeOut._element.className="pipeOut "+this.pipeStatus.direction,this.pipeOut.image=PIPE_COLORS[this.color].pipeOut,this.pipeOut.x=this.pipeStatus.x*BOX_SIZE,this.pipeOut.y=this.pipeStatus.y*BOX_SIZE,this.parentNode.addChild(this.pipeOut)},onremovedfromscene:function(){GAME.currentScene.removeChild(this.pipeOut)},run:function(){clearTimeout(this.parentNode.endTimer),this.parentNode.endTimer=setTimeout(function(){GAME.currentScene.gameOver()},3500);var e=new HitArc(this.color);e.x=this.pipeOut.x-128,e.y=this.pipeOut.y-128,this.parentNode.addChild(e);var t={x:this.pipeOut.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.pipeOut.y+BOX_SIZE/2-BEAM_SIZE/2,color:"white",parentBlock:this.pipeOut,beamLength:BEAM_LENGTH};this.parentNode.addChild(new Beam(this.beamStatus[this.pipeStatus.direction],t)),playSound("pipe"),GAME.currentScene.removeChild(this.pipeOut),GAME.currentScene.removeChild(this)}}),TUTORIALBEAM=[],ARROWARRAY=[],tutoSecondScene=null,gameOverLabel=new ExLabel(LANGUAGE[COUNTRYCODE].gameOver,640,100);gameOverLabel.setClassName("gameOverText"),gameOverLabel.x=0,gameOverLabel.y=-80,gameOverLabel.tl.moveTo(0,230,30,BOUNCE_EASEOUT);var thirdStartMsg=new ExLabel(LANGUAGE[COUNTRYCODE].tutoThirdStartMsg);thirdStartMsg.x=100,thirdStartMsg.y=160,thirdStartMsg.setClassName("tuto_black_msg");var TutoBlock=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=e,this.color=e,this.arccolor="start"==this.color?"white":this.color,this.arrowFlg=!0,this.lastFlg=!1,this.thirdLastFlg=!1,this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},run:function(){var e=null,t=new HitArc(this.arccolor);t.x=this.x-128,t.y=this.y-128,this.parentNode.addChild(t);var a=0;this.parentNode.removeChild(thirdStartMsg);for(var r in this.beamStatus){if(TUTODIRECTIONS[this.color][a]){var n={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,color:this.color,parentBlock:this},r=new TutoBeam(this.beamStatus[r],n);this.parentNode.addChild(r),TUTORIALBEAM.push(r)}a++}if("start"==this.color?playSound("start"):"blue"==this.color?playSound("blue"):"white"==this.color&&playSound("white"),this.lastFlg){var o=this.parentNode;this.parentNode.tl.delay(70).then(function(){o.addChild(gameOverLabel)});var i=createLoseMsg();gameOverLabel.tl.delay(100).then(function(){o.removeChild(gameOverLabel),o.addChild(i)}),i.tl.delay(40).then(function(){i.x=160,i._element.innerHTML=LANGUAGE[COUNTRYCODE].yourMission}),i.tl.delay(100).then(function(){i._element.innerHTML=LANGUAGE[COUNTRYCODE].letsWin}),e=new Scene;var l=createTitleScene();e.backToTop=function(){GAME.replaceScene(l)};var s=createBacktoTopLabel();s.on("touchend",function(){this.parentNode.backToTop(),initTutorialScene()}),e.addChild(s),tutoCurrentStage=[],i.tl.delay(120).then(function(){var t=0;TUTOSTAGES[1].forEach(function(a){var r=StageBuilder(a);r.x=a.x*BOX_SIZE,r.y=a.y*BOX_SIZE,1==t&&(r.arrowFlg=!1),"tutoGoal"==a.name&&(r.nextEndFlg=!0),tutoCurrentStage.push(r),e.addChild(r),t++});var a=createPointerArrow();ARROWARRAY.push(a),e.addChild(a),e.addChild(thirdStartMsg),this.parentNode.removeChild(this),GAME.replaceScene(e)})}this.parentNode.removeChild(this)}}),TutoGoal=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="goal",this.backgroundColor="#F4D03F",this.color="yellow",this.scaleX=.8,this.scaleY=.8,this.arrowFlg=!0,this.nextEndFlg=!1,this.tl.scaleTo(.6,.6,30,CUBIC_EASEIN).scaleTo(.8,.8,30,CUBIC_EASEOUT).loop()},run:function(){this.tl.scaleTo(.6,.6,30,CUBIC_EASEIN).scaleTo(.8,.8,30,CUBIC_EASEOUT).unloop();var e=this;if(!(tutoCurrentStage.length>1))if(clearTimeout(this.parentNode.endTimer),this.parentNode.cleared=!0,playSound("goal"),this.nextEndFlg){var t=createEndLabel();GAME.currentScene.addChild(t),this.tl.clear().scaleTo(30,30,30).then(function(){}).delay(30).then(function(){t.setClassName("tuto_black_msg"),t._element.innerHTML=LANGUAGE[COUNTRYCODE].tutoClearMsg2}).delay(100).then(function(){t._element.innerHTML=LANGUAGE[COUNTRYCODE].tutoClearMsg3}).delay(40).then(function(){}).delay(100).then(function(){var t=createTitleScene();e.parentNode.removeChild(this),GAME.replaceScene(t),initTutorialScene()})}else{tutoSecondScene=null;var a=null,r=null;this.tl.clear().scaleTo(30,30,30).delay(30).then(function(){a=new ExLabel(LANGUAGE[COUNTRYCODE].tutoClear),a.x=120,a.y=220,a.width=500,a.height=200,a.setClassName("TutoMessaFirst"),tutorialScene.addChild(a),r=new ExLabel(LANGUAGE[COUNTRYCODE].nextLosePattern),r.x=120,r.y=220,r.width=500,r.height=200,r.setClassName("TutoMessaFirst"),e.tl.delay(60).then(function(){tutorialScene.removeChild(a),tutorialScene.addChild(r)}),tutoSecondScene=new Scene;var t=createTitleScene(),n=createBacktoTopLabel();tutoSecondScene.backToTop=function(){GAME.replaceScene(t)},tutoSecondScene.addChild(n);var o=0;tutoCurrentStage=[],TUTOSTAGES[1].forEach(function(e){var t=StageBuilder(e);t.x=e.x*BOX_SIZE,t.y=e.y*BOX_SIZE,o==TUTOSTAGES[1].length-2&&(t.lastFlg=!0),tutoSecondScene.addChild(t),tutoCurrentStage.push(t),o++});var i=createLosePatternText();tutoSecondScene.addChild(i),tutoSecondScene.loseAotamaFlg=!0,n.on("touchend",function(){tutoSecondScene.backToTop(),initTutorialScene()}),e.tl.delay(100).then(function(){tutorialScene.removeChild(e),GAME.replaceScene(tutoSecondScene),i.tl.delay(100).then(function(){tutoCurrentStage[0].run(),tutoCurrentStage.splice(0,1),tutoSecondScene.removeChild(i)})})})}}}),TutoBeam=Class.create(Sprite,{initialize:function(e,t){Sprite.call(this,BEAM_SIZE,BEAM_SIZE),this._element=document.createElement("div"),this._element.className="beam",this.backgroundColor="#F4D03F",this.direction=e,this.initX=t.x,this.initY=t.y,this.x=t.x,this.y=t.y,this.color=t.color,this.moveFlg=!0,this.makeArrowFlg=!1,this.aotamaFlg=!0,this.tutoCurrentStage=tutoCurrentStage,this.parentBlock=t.parentBlock,this.beamLength=BEAM_LENGTH*BOX_SIZE,this.COLORS=COLORS},onenterframe:function(){this.tutoCurrentStage.length,thatCurrentStage=this.tutoCurrentStage;for(var e=0;thatCurrentStage.length>e;e++)if(this.within(this.tutoCurrentStage[e],this.tutoCurrentStage[e].width-13)&&this.tutoCurrentStage[e]!==this.parentBlock){var t=this.tutoCurrentStage[e],a=e;if(!this.makeArrowFlg)if(t.arrowFlg){var r=this;this.moveFlg=!1;var n=createPointerArrow2(r.x,r.y);if(this.parentNode.addChild(n),this.parentNode.aotamaEndFlg){var o=createPrevGoalLabel();this.parentNode.addChild(o)}else if(this.parentNode.loseAotamaFlg){var i=createEndChainLabel();this.parentNode.addChild(i),this.parentNode.endChainEndFlg=!0}else{var l=createAotamaLabel();this.parentNode.addChild(l),this.parentNode.aotamaEndFlg=!0}n.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT),n.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT),n.tl.scaleTo(.9,.9,20,CUBIC_EASEIN).scaleTo(1,1,10,CUBIC_EASEOUT).then(function(){this.parentNode.removeChild(i),this.parentNode.removeChild(o),this.parentNode.removeChild(l),this.parentNode.removeChild(n),r.parentNode.removeChild(r),t.run(),this.moveFlg=!0,r.tutoCurrentStage.splice(a,1)}),this.makeArrowFlg=!0}else this.parentNode.removeChild(r),t.run(),this.tutoCurrentStage.splice(e,1)}this.moveFlg&&(Math.abs(this.initX-this.x)<this.beamLength&&Math.abs(this.initY-this.y)<this.beamLength?(this.x+=this.direction.moveX,this.y+=this.direction.moveY):(this.opacity-=.1,0>this.opacity&&this.parentNode.removeChild(this)))}}),TutoBox=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="box",this.scene=e},ontouchend:function(){var e=new Block("white");e.x=this.x,e.y=this.y,tutoCurrentStage.push(e),this.scene.addChild(e)}}),PointerArrow=Class.create(Sprite,{initialize:function(){Sprite.call(this)},erase:function(){this.parentNode.removeChild(this)},ontouchend:function(){var e=new TutoBlock("white");e.x=448,e.y=256,tutoCurrentStage.push(e),this.scene.addChild(e),tutoCurrentStage[2].arrowFlg=!1,tutoCurrentStage[3].arrowFlg=!1,tutoCurrentStage[0].run(),tutoCurrentStage.splice(0,1),ARROWARRAY[0].erase(),ARROWARRAY.splice(0,1)}}),VolumeSlider=Class.create(Sprite,{initialize:function(e,t){var a=e||640,r=t||64;Sprite.call(this,a,r),this.x=118,this.y=330,this._element=document.createElement("div"),this._element.innerHTML='<input type="range" max="1.0" step="0.1"/>',this._element.className="volumeSlider"},ontouchend:function(){VOLUME=this._element.childNodes[0].value}}),EditObj=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this.xId=-1,this.yId=-1,this.objName=null},run:function(){this.bloomArc(),this.beamFire(),this.playMySound(),GAME.currentScene.removeChild(this)},ontouchstart:function(){"eraser"==creater.penColor&&GAME.currentScene.removeChild(this)},onremovedfromscene:function(){creater.stages[this.xId][this.yId]=null,boxManager.boxArray[this.xId][this.yId].putedObjFlg=!1,creater.noneCollisionStages[this.xId][this.yId]=this,creater.currentStage[this.xId][this.yId]=null},beamFire:function(){var e=0;for(var t in this.beamStatus){var a={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this,beamLength:1};GAME.currentScene.addChild(new EditBeam(this.beamStatus[t],a)),e++}},bloomArc:function(){var e=new HitArc(this.color);e.x=this.x-128,e.y=this.y-128,GAME.currentScene.addChild(e)},onaddedtoscene:function(){boxManager.boxArray[this.xId][this.yId].putedObjFlg=!0,this.registJSON(),creater.currentStage[this.xId][this.yId]=this},playMySound:function(){this.objName&&playSound(this.objName)},registJSON:function(){creater.stages[this.xId][this.yId]=this.objName}}),EditBox=Class.create(Box,{initialize:function(e,t){Box.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=9==t?"box edit_underline":"box",this.moved=!1,this.xId=e,this.yId=t,this.startObjFlg=!1,this.putedObjFlg=!1,this.pipeNextAlreadyFlg=!1},putStart:function(){if(!creater.putStartFlg){var e=new EditStart;return creater.putStartFlg=!0,this.startObjFlg=!0,creater.startObj=void 0,creater.startObj=e,creater.stages[this.xId][this.yId]="start",creater.startPos={x:this.xId,y:this.yId},e}},putSlanter:function(){var e=new EditSlanter(this.xId,this.yId);return e},putDiffusioner:function(){var e=new EditDiffusioner;return e},putParentPipe:function(){var e=creater.pipeColor,t=new EditPipe(e);return t},itaratePipeInk:function(e){var t=null;switch(e){case"blue":t="red";break;case"red":t="green";break;case"green":t="blue"}GAME.currentScene.removeChild(pipeManager.pipeInk),creater.pipeColor=t,pipeManager.pipeInk=void 0,pipeManager.pipeInk=new PipeInk(t),GAME.currentScene.addChild(pipeManager.pipeInk)},getNextColor:function(e){for(var t=["blue","red","green"],a=t.length,r=0;a>r;r++)if(e==t[r]){if(r+1>a)return;return t[r+1]}alert("pipe Color Error. color is not exist")},rotateCreaterPipeColor:function(e){var t=null;if(null!=pipeManager.pipeEntity[e].child.x)switch(e){case"blue":t="green",creater.pipeColor="green";break;case"red":t="blue",creater.pipeColor="blue";break;case"green":t="red",creater.pipeColor="red"}else switch(e){case"blue":t="red",creater.pipeColor="red";break;case"red":t="green",creater.pipeColor="green";break;case"green":t="blue",creater.pipeColor="blue"}return t},putChildPipe:function(){var e=creater.pipeColor,t=new EditChildPipe(e);return t.xId=this.xId,t.yId=this.yId,pipeManager.pipeStatus[e]="noneDirection",creater.penColor="blue",t},replacePipeInk:function(e){GAME.currentScene.removeChild(pipeManager.pipeInk),pipeManager.pipeInk=void 0,pipeManager.pipeInk=new PipeInk(e),GAME.currentScene.addChild(pipeManager.pipeInk)},putGoal:function(){if(!creater.goalFlg){var e=new EditGoal;return e}},putStar:function(){var e=new EditStar;return e},ontouchstart:function(e){if(!this.putedObjFlg){this.startEvent=e,this.moved=!1,this._element.className="box touched";var t=creater.penColor,a=null;if("eraser"!=t){if("start"==t){if(creater.putStartFlg)return;a=this.putStart(),creater.putStartFlg=!0}else if("slanter"==t)a=this.putSlanter();else if("diffusioner"==t)a=this.putDiffusioner();else if("parentPipe"==t){var r=pipeManager.getPipeParentPutedFlg(creater.pipeColor);if(r)return alert(LANGUAGE[COUNTRYCODE].sameColorParentError),creater.pipeColor=null,void 0;a=this.putParentPipe()}else if("childPipe"==t)a=this.putChildPipe();else if("goal"==t)a=this.putGoal();else if("star"==t){if(creater.starMany>=3)return;a=this.putStar()}else a=new EditBlock(t);a.x=this.x,a.y=this.y,a.xId=this.xId,a.yId=this.yId,this.parentNode.addChild(a)}}},ontouchmove:function(e){(Math.abs(this.startEvent.x-e.x)>10||Math.abs(this.startEvent.y-e.y)>10)&&(this.moved=!0)},ontouchend:function(){if(this._element.className="box",this.parentNode.canTap&&!this.moved){this.parentNode.canTap=!1;var e=new Block("white");e.x=this.x,e.y=this.y,currentStage.push(e),this.parentNode.addChild(e)}}}),BlockInk=Class.create(Block,{initialize:function(e){Block.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=e,this.color=e,"orange"===this.color?this.image=ORANGE:"purple"===this.color&&(this.image=PURPLE)},ontouchstart:function(){creater.penColor=this.color}}),Creater=function(e){this.penColor=e||"white",this.pipeColor="blue",this.stages=Array(10);for(var t=this,a=0;10>a;a++)t.stages[a]=Array(10);this.putStartFlg=!1,this.startObj=null,this.copyStartObj=null,this.putStartFlg=!1,this.goalFlg=null,this.starMany=0,this.startPos={},this.currentStage=Array(10);for(var r=0;10>r;r++)this.currentStage[r]=Array(10);this.noneCollisionStages=Array(10);for(var r=0;10>r;r++)this.noneCollisionStages[r]=Array(10);this.copyStage=[]},TestPlayButton=Class.create(ExLabel,{initialize:function(e,t,a){ExLabel.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.innerHTML=e},ontouchstart:function(){for(pipeColor in pipeManager.pipeStatus)if("parentPut"==pipeManager.pipeStatus[pipeColor]||"noneDirection"==pipeManager.pipeStatus[pipeColor])return alert(LANGUAGE[COUNTRYCODE].enterPipeError),void 0;return creater.putStartFlg?(creater.startObj.run(),void 0):(alert(LANGUAGE[COUNTRYCODE].enterStartError),void 0)},setClassName:function(e){this._element.className=e}}),EditStart=Class.create(Start,{initialize:function(){Start.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="start",this.backgroundColor=COLORS.white,this.xId=-1,this.yId=-1,this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}
},run:function(){var e=new HitArc("white");e.x=this.x-128,e.y=this.y-128,GAME.currentScene.addChild(e);var t=0;for(var a in this.beamStatus){if(DIRECTIONS.white[t]){var r={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,color:"white",parentBlock:this,beamLength:BEAM_LENGTH};GAME.currentScene.addChild(new EditBeam(this.beamStatus[a],r))}t++}playSound("start"),GAME.currentScene.removeChild(this)},onaddedtoscene:function(){this.registJSON(),creater.putStartFlg=!0,boxManager.boxArray[this.xId][this.yId].putedObjFlg=!0,creater.startObj=this},onremovedfromscene:function(){creater.putStartFlg=!1,boxManager.boxArray[this.xId][this.yId].putedObjFlg=!1},registJSON:function(){creater.stages[this.xId][this.yId]=this.objName}}),EditBeam=Class.create(Beam,{initialize:function(e,t){Beam.call(this,BEAM_SIZE,BEAM_SIZE),this._element=document.createElement("div"),this._element.className="beam",this.direction=e,this.initX=t.x,this.initY=t.y,this.x=t.x,this.y=t.y,this.currentStage=currentStage,this.parentBlock=t.parentBlock,this.beamLength=t.beamLength*BOX_SIZE,this.COLORS=COLORS},onenterframe:function(){for(var e=BOX_HALF+12,t=0;10>t;t++)for(var a=0;10>a;a++)creater.currentStage[t][a]&&this.within(creater.currentStage[t][a],e)&&creater.currentStage[t][a]!==this.parentBlock&&(creater.currentStage[t][a].run(),GAME.currentScene.removeChild(this));Math.abs(this.initX-this.x)<this.beamLength&&Math.abs(this.initY-this.y)<this.beamLength?(this.x+=this.direction.moveX,this.y+=this.direction.moveY):(this.opacity-=.1,0>this.opacity&&GAME.currentScene.removeChild(this))}}),EditBlock=Class.create(EditObj,{initialize:function(e){EditObj.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className=e,this.color=e,this.objName=this.color,this.xId=-1,this.yId=-1,"orange"===this.color?this.image=ORANGE:"purple"===this.color&&(this.image=PURPLE),this.beamStatus={top:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},beamFire:function(){var e=0;for(var t in this.beamStatus){if(DIRECTIONS[this.color][e]){var a={x:this.x+BOX_SIZE/2-BEAM_SIZE/2,y:this.y+BOX_SIZE/2-BEAM_SIZE/2,parentBlock:this,beamLength:BEAM_LENGTH};this.parentNode.addChild(new EditBeam(this.beamStatus[t],a))}e++}}}),EditSlanter=Class.create(EditObj,{initialize:function(){EditObj.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="slanter",this.image=SLANTER,this.rotation=45,this.objName="slanter",this.xId=-1,this.yId=-1,this.beamStatus={topRight:{moveX:MOVE_PX,moveY:-MOVE_PX},rightDown:{moveX:MOVE_PX,moveY:MOVE_PX},downLeft:{moveX:-MOVE_PX,moveY:MOVE_PX},leftTop:{moveX:-MOVE_PX,moveY:-MOVE_PX}},this.color="green"}}),SlanterInk=Class.create(Slanter,{initialize:function(){Slanter.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="slanter",this.image=SLANTER,this.rotation=45,this.color="green"},ontouchstart:function(){creater.penColor="slanter"}}),DiffusionerInk=Class.create(Diffusioner,{initialize:function(){Diffusioner.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="diffusioner",this.image=DIFFUSIONER,this.color="red"},ontouchstart:function(){creater.penColor="diffusioner"}}),EditDiffusioner=Class.create(EditObj,{initialize:function(){EditObj.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="diffusioner",this.image=DIFFUSIONER,this.objName="diffusioner";var e=2*MOVE_PX;this.xId=-1,this.yId=-1,this.beamStatus={top:{moveX:0,moveY:-e},topRight:{moveX:e,moveY:-e},right:{moveX:e,moveY:0},rightDown:{moveX:e,moveY:e},down:{moveX:0,moveY:e},downLeft:{moveX:-e,moveY:e},left:{moveX:-e,moveY:0},leftTop:{moveX:-e,moveY:-e}},this.color="red"}}),PipeInk=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="pipe",this.image=PIPE_COLORS[e].pipe,this.pipeStatus=null,this.color=e,this.x=410,this.y=670},onaddedtoscene:function(){},onremovedfromscene:function(){GAME.currentScene.removeChild(this.pipeOut)},ontouchstart:function(){creater.penColor="parentPipe",creater.pipeColor=this.color}}),EditPipe=Class.create(EditObj,{initialize:function(e){EditObj.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="pipe",this.image=PIPE_COLORS[e].pipe,this.color=e,this.xId=-1,this.yId=-1,this.beamStatus={up:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},bloomArc:function(e){var t=new HitArc(this.color);t.x=e.x-128,t.y=e.y-128,GAME.currentScene.addChild(t)},getChildPipe:function(){var e=null;switch(this.color){case"blue":e=pipeManager.childPipe.blue;break;case"red":e=pipeManager.childPipe.red;break;case"green":e=pipeManager.childPipe.green}return e},initPipeStatusEtc:function(){pipeManager.pipeStatus[this.color]="nothing",pipeManager.initPipeEntityColor(this.color)},beamFire:function(e){var t={x:e.x+BOX_SIZE/2-BEAM_SIZE/2,y:e.y+BOX_SIZE/2-BEAM_SIZE/2,color:"white",parentBlock:e,beamLength:BEAM_LENGTH};GAME.currentScene.addChild(new EditBeam(this.beamStatus[e.direction],t))},run:function(){var e=this.getChildPipe();this.bloomArc(e),this.initPipeStatusEtc(),this.beamFire(e),playSound("pipe"),GAME.currentScene.removeChild(e),GAME.currentScene.removeChild(this)},ontouchstart:function(){"eraser"==creater.penColor&&GAME.currentScene.removeChild(this)},onremovedfromscene:function(){creater.stages[this.xId][this.yId]=null,boxManager.boxArray[this.xId][this.yId].putedObjFlg=!1,creater.noneCollisionStages[this.xId][this.yId]=this,creater.currentStage[this.xId][this.yId]=null,pipeManager.pipeEntity[this.color].parent.x=null,pipeManager.pipeEntity[this.color].parent.y=null,pipeManager.pipeStatus[this.color]="nothing",null!=pipeManager.childPipe[this.color]&&GAME.currentScene.removeChild(pipeManager.childPipe[this.color]),this.replacePipeInk()},replacePipeInk:function(){GAME.currentScene.removeChild(pipeManager.pipeInk),pipeManager.pipeInk=void 0,pipeManager.pipeInk=new PipeInk(this.color),GAME.currentScene.addChild(pipeManager.pipeInk)},onaddedtoscene:function(){pipeManager.pipeStatus[this.color]="parentPut",creater.penColor="childPipe",boxManager.boxArray[this.xId][this.yId].putedObjFlg=!0,pipeManager.pipeEntity[this.color].parent.x=this.xId,pipeManager.pipeEntity[this.color].parent.y=this.yId,pipeManager.pipeStatus[this.color]="parentPut",this.registJSON(),creater.currentStage[this.xId][this.yId]=this,pipeManager.adaptPipeStatus(),pipeManager.adaptPipeInk()},registJSON:function(){creater.stages[this.xId][this.yId]={name:"pipe",color:this.color}}}),EditChildPipe=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="pipeOut ",this.image=PIPE_COLORS[e].pipeOut,this.color=e,this.direction="right",this.directionArrow={up:null,right:null,left:null,down:null},this.xId=-1,this.yId=-1,this.restoreFlg=!1,this.beamStatus={up:{moveX:0,moveY:-MOVE_PX},right:{moveX:MOVE_PX,moveY:0},down:{moveX:0,moveY:MOVE_PX},left:{moveX:-MOVE_PX,moveY:0}}},onaddedtoscene:function(){("childPut"==pipeManager.pipeStatus[this.color]||"noneDirection"==pipeManager.pipeStatus[this.color])&&GAME.currentScene.removeChild(pipeManager.childPipe[this.color]),this.restoreFlg||(this.directionArrow.up=new PipeDirectionArrow("",this.color),this.directionArrow.up.x=this.x+20,this.directionArrow.up.y=this.y-30,this.directionArrow.up.direction="up",this.directionArrow.up.setClassName("icon-arrow-up edit_direction_arrow"),GAME.currentScene.addChild(this.directionArrow.up),this.directionArrow.left=new PipeDirectionArrow("",this.color),this.directionArrow.left.x=this.x-26,this.directionArrow.left.y=this.y+15,this.directionArrow.left.direction="left",this.directionArrow.left.setClassName("icon-arrow-left edit_direction_arrow"),GAME.currentScene.addChild(this.directionArrow.left),this.directionArrow.right=new PipeDirectionArrow("",this.color),this.directionArrow.right.x=this.x+65,this.directionArrow.right.y=this.y+15,this.directionArrow.right.direction="right",this.directionArrow.right.setClassName("icon-arrow-right edit_direction_arrow"),GAME.currentScene.addChild(this.directionArrow.right),this.directionArrow.down=new PipeDirectionArrow("",this.color),this.directionArrow.down.x=this.x+20,this.directionArrow.down.y=this.y+60,this.directionArrow.down.direction="down",this.directionArrow.down.setClassName("icon-arrow-down edit_direction_arrow"),GAME.currentScene.addChild(this.directionArrow.down)),pipeManager.pipeEntity[this.color].child.x=this.xId,pipeManager.pipeEntity[this.color].child.y=this.yId,pipeManager.pipeEntity[this.color].child.direction=this.direction,pipeManager.childPipe[this.color]=void 0,pipeManager.childPipe[this.color]=this,pipeManager.adaptPipeStatus(),pipeManager.adaptPipeInk()},ontouchstart:function(){if("eraser"==creater.penColor){var e=this.color;creater.stages[this.xId][this.yId]=null,pipeManager.childPipe[e]=null,GAME.currentScene.removeChild(pipeManager.pipeInk),pipeManager.pipeInk=void 0,pipeManager.pipeInk=new ChildPipeInk(this.color),GAME.currentScene.removeChild(this),GAME.currentScene.addChild(pipeManager.pipeInk)}},onremovedfromscene:function(){boxManager.boxArray[this.xId][this.yId].putedObjFlg=!1,creater.stages[this.xId][this.yId]=null,creater.noneCollisionStages[this.xId][this.yId]=this,pipeManager.pipeStatus[this.color]=pipeManager.pipeEntity[this.color].parent.x?"parentPut":"nothing",pipeManager.pipeEntity[this.color].child.x=null,pipeManager.pipeEntity[this.color].child.y=null,pipeManager.pipeEntity[this.color].child.direction=null,pipeManager.childPipe[this.color]=null}}),PipeColorButton=Class.create(ExLabel,{initialize:function(e,t,a){var r=t||640,n=a||64;ExLabel.call(this,r,n),this._element=document.createElement("div"),this._element.innerHTML=e},setClassName:function(e){this._element.className=e}}),PipeManager=function(){this.pipeStatus={blue:"nothing",red:"nothing",green:"nothing"},this.pipeInk=null,this.pipeEntity={blue:{parent:{x:null,y:null},child:{x:null,y:null,direction:null}},red:{parent:{x:null,y:null},child:{x:null,y:null,direction:null}},green:{parent:{x:null,y:null},child:{x:null,y:null,direction:null}}},this.initPipeEntityColor=function(e){this.pipeEntity[e].parent.x=null,this.pipeEntity[e].parent.y=null,this.pipeEntity[e].child.y=null,this.pipeEntity[e].child.x=null,this.pipeEntity[e].child.direction=null},this.getUnusedColor=function(){for(var e=PIPE_COLOR_ARRAY.length,t=0;e>t;t++)if("nothing"==this.pipeStatus[PIPE_COLOR_ARRAY[t]])return PIPE_COLOR_ARRAY[t];return!1},this.childPipe={blue:null,red:null,green:null},this.getPipeErrorFlg=function(e){for(pipeColor in this.pipeStatus)if(pipeColor==e&&("parentPut"==this.pipeStatus[pipeColor]||"noneDirection"==this.pipeStatus[pipeColor]))return!0;return!1},this.getPipeParentPutedFlg=function(e){for(pipeColor in this.pipeStatus)if(pipeColor==e&&("parentPut"==this.pipeStatus[pipeColor]||"noneDirection"==this.pipeStatus[pipeColor]||"childPut"==this.pipeStatus[pipeColor]))return!0;return!1},this.getPipeAnyError=function(){for(pipeColor in this.pipeStatus)if("parentPut"==this.pipeStatus[pipeColor]||"noneDirection"==this.pipeStatus[pipeColor])return!0;return!1},this.adaptPipeStatus=function(){for(var e=PIPE_COLOR_ARRAY.length,t=0;e>t;t++)null!=this.pipeEntity[PIPE_COLOR_ARRAY[t]].parent.x?null!=this.pipeEntity[PIPE_COLOR_ARRAY[t]].child.direction?this.pipeStatus[PIPE_COLOR_ARRAY[t]]="childPut":null!=this.pipeEntity[PIPE_COLOR_ARRAY[t]].child.x&&null==this.pipeEntity[PIPE_COLOR_ARRAY[t]].child.direction&&(this.pipeStatus[PIPE_COLOR_ARRAY[t]]="noneDirection"):this.pipeStatus[PIPE_COLOR_ARRAY[t]]="nothing";null!=this.pipeEntity.blue.parent.x},this.adaptPipeInk=function(){for(var e=PIPE_COLOR_ARRAY.length,t=[],a=0;e>a;a++)"childPut"!=pipeManager.pipeStatus[PIPE_COLOR_ARRAY[a]]&&t.push(PIPE_COLOR_ARRAY[a]);var r=t.length;if(0!=r)for(var n=0;r>n;n++){if("parentPut"==pipeManager.pipeStatus[t[n]]){GAME.currentScene.removeChild(this.pipeInk),this.pipeInk=void 0;var o=new ChildPipeInk(t[n]);this.pipeInk=o,GAME.currentScene.addChild(o);break}if("nothing"==pipeManager.pipeStatus[t[n]]){GAME.currentScene.removeChild(this.pipeInk),this.pipeInk=void 0;var i=new PipeInk(t[n]);GAME.currentScene.addChild(i),this.pipeInk=i}}}},PipeDirectionArrow=Class.create(ExLabel,{initialize:function(e,t){var a=640,r=64;ExLabel.call(this,a,r),this._element=document.createElement("div"),this._element.innerHTML=e,this.color=t,this.direction=null},setClassName:function(e){this._element.className=e},ontouchend:function(){var e;switch(this.color){case"blue":e=pipeManager.childPipe.blue;break;case"red":e=pipeManager.childPipe.red;break;case"green":e=pipeManager.childPipe.green}e.direction=this.direction,e._element.className="pipeOut "+this.direction,creater.stages[e.xId][e.yId]={name:"pipeOut",direction:""+this.direction},pipeManager.pipeStatus[this.color]="childPut",pipeManager.pipeEntity[this.color].child.direction=""+this.direction,GAME.currentScene.removeChild(e.directionArrow.up),GAME.currentScene.removeChild(e.directionArrow.left),GAME.currentScene.removeChild(e.directionArrow.right),GAME.currentScene.removeChild(e.directionArrow.down)}}),ChildPipeInk=Class.create(Sprite,{initialize:function(e){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this.image=PIPE_COLORS[e].pipeOut,this.color=e,this._element.className="pipeOut right",this.x=410,this.y=670},onremovedfromscene:function(){},ontouchstart:function(){creater.penColor="childPipe",creater.pipeColor=this.color}}),EditGoal=Class.create(EditObj,{initialize:function(){EditObj.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="goal",this.objName="goal",this.scaleX=.8,this.scaleY=.8,this.distance=1,this.xId=-1,this.yId=-1,this.tl.scaleTo(.6,.6,30,CUBIC_EASEIN).scaleTo(.8,.8,30,CUBIC_EASEOUT).loop()},run:function(){this.playMySound(),this.tl.clear(),GAME.currentScene.removeChild(this)},onremovedfromscene:function(){creater.stages[this.xId][this.yId]=null,boxManager.boxArray[this.xId][this.yId].putedObjFlg=!1,creater.noneCollisionStages[this.xId][this.yId]=this,creater.goalFlg=!1,creater.currentStage[this.xId][this.yId]=null},onaddedtoscene:function(){boxManager.boxArray[this.xId][this.yId].putedObjFlg=!0,this.registJSON(),creater.currentStage[this.xId][this.yId]=this,creater.goalFlg=!0}}),GoalInk=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.className="goal"},ontouchstart:function(){creater.penColor="goal"}}),StarInk=Class.create(Sprite,{initialize:function(){Sprite.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this.image=WHITE_STAR},ontouchstart:function(){creater.penColor="star"}}),EditStar=Class.create(EditObj,{initialize:function(){EditObj.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this.image=WHITE_STAR,this.hited=!1,this.objName="star",this.xId=-1,this.yId=-1},run:function(){var e=this;this.hited=!0,this.tl.scaleTo(.5,.5,7).scaleTo(1,1,2).then(function(){e.tl.clear(),e.tl.delay(5).rotateBy(72,40,EXPO_EASEOUT)}),this.image=YELLOW_STAR,this.playMySound()},onremovedfromscene:function(){creater.stages[this.xId][this.yId]=null,boxManager.boxArray[this.xId][this.yId].putedObjFlg=!1,creater.noneCollisionStages[this.xId][this.yId]=this,creater.currentStage[this.xId][this.yId]=null,creater.starMany--},onaddedtoscene:function(){creater.starMany++,boxManager.boxArray[this.xId][this.yId].putedObjFlg=!0,this.registJSON(),creater.currentStage[this.xId][this.yId]=this,creater.starMany>3&&GAME.currentScene.removeChild(this)}}),SendButton=Class.create(Sprite,{initialize:function(e,t,a){var r=t||640,n=a||64;Sprite.call(this,r,n),this._element=document.createElement("div"),this._element.innerHTML=e},setClassName:function(e){this._element.className=e},ontouchend:function(){return null==creater.startObj?(alert(LANGUAGE[COUNTRYCODE].postStartNoneError),void 0):null==creater.goalFlg?(alert(LANGUAGE[COUNTRYCODE].postGoalNoneError),void 0):3>creater.starMany?(alert(LANGUAGE[COUNTRYCODE].postStarManyError),void 0):pipeManager.getPipeAnyError()?(alert(LANGUAGE[COUNTRYCODE].postPipeError),void 0):(makeJSON(creater.stages),void 0)}}),RestoreButton=Class.create(ExLabel,{initialize:function(e,t,a){ExLabel.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.innerHTML=e},ontouchstart:function(){var e=creater.noneCollisionStages.concat();if(null!=e){null!=creater.startObj&&(GAME.currentScene.addChild(creater.startObj),creater.putStartFlg=!0),e.length;for(var t=0;10>t;t++)for(var a=0;10>a;a++)if(!boxManager.boxArray[t][a].putedObjFlg&&e[t][a])if("pipe"==e[t][a]._element.className){var r=e[t][a].color;if("childPut"==pipeManager.pipeStatus[r]||"parentPut"==pipeManager.pipeStatus[r]||"noneDirection"==pipeManager.pipeStatus[r])continue;if("childPut"!=pipeManager.pipeStatus){pipeManager.pipeStatus[r]="parentPut";var n=e[t][a].color}this.addCreatersStages(e[t][a]),GAME.currentScene.addChild(e[t][a])}else-1!=e[t][a]._element.className.indexOf("pipeOut")?(e[t][a].restoreFlg=!0,pipeManager.pipeStatus[n]="childPut",this.addCreatersStages(e[t][a]),GAME.currentScene.addChild(e[t][a])):(this.addCreatersStages(e[t][a]),GAME.currentScene.addChild(e[t][a]));pipeManager.adaptPipeStatus();var o=pipeManager.getUnusedColor();o&&(GAME.currentScene.removeChild(pipeManager.pipeInk),pipeManager.pipeInk=void 0,pipeManager.pipeInk=new PipeInk(o),GAME.currentScene.addChild(pipeManager.pipeInk));for(var i=["blue","red","green"],l=0;3>l;l++)pipeManager.pipeEntity[i[l]].parent.x||GAME.currentScene.removeChild(pipeManager.childPipe[i[l]]);pipeManager.adaptPipeStatus(),pipeManager.adaptPipeInk()}},setClassName:function(e){this._element.className=e},addCreatersStages:function(e){var t=e._element.className;creater.stages[e.xId][e.yId]="start"==t?"start":"slanter"==t?"slanter":"diffusioner"==t?"diffusioner":"goal"==t?"goal":"star"==t?"star":"pipe"==t?{name:"pipe",color:""+e.color}:-1!=t.indexOf("pipeOut")?{name:"pipeOut",direction:""+e.direction}:e.color}}),EraserInk=Class.create(ExLabel,{initialize:function(e,t,a){ExLabel.call(this,BOX_SIZE,BOX_SIZE),this._element=document.createElement("div"),this._element.innerHTML=e},ontouchstart:function(){creater.penColor="eraser",creater.copyStage=void 0,creater.copyStage=creater.currentStage.concat()}}),BoxManager=function(){this.boxArray=Array(10);for(var e=0;10>e;e++)this.boxArray[e]=Array(10)};